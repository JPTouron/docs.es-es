---
ms.openlocfilehash: bd656478a55856e676853e57f3e7386ea0aa0211
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 07/01/2020
ms.locfileid: "85614827"
---
### <a name="currentculture-is-not-preserved-across-wpf-dispatcher-operations"></a><span data-ttu-id="5487d-101">CurrentCulture no se conserva entre operaciones del distribuidor de WPF</span><span class="sxs-lookup"><span data-stu-id="5487d-101">CurrentCulture is not preserved across WPF Dispatcher operations</span></span>

#### <a name="details"></a><span data-ttu-id="5487d-102">Detalles</span><span class="sxs-lookup"><span data-stu-id="5487d-102">Details</span></span>

<span data-ttu-id="5487d-103">A partir de .NET Framework 4.6, los cambios efectuados en <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> o <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> dentro de un <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> se perderán al final de la operación de ese distribuidor.</span><span class="sxs-lookup"><span data-stu-id="5487d-103">Beginning in the .NET Framework 4.6, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made within a <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> will be lost at the end of that dispatcher operation.</span></span> <span data-ttu-id="5487d-104">De igual forma, es posible que los cambios en <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> o <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> realizados fuera de una operación de distribuidor no surtan efecto cuando que se ejecuta esa operación. En términos prácticos, esto significa que es posible que los cambios en <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> y <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> no fluyan entre las devoluciones de llamada de la interfaz de usuario de WPF y otro código de una aplicación de WPF. Esto se debe a un cambio en <xref:System.Threading.ExecutionContext?displayProperty=fullName> que hace que <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> y <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> se almacenen en el contexto de ejecución a partir de las aplicaciones destinadas a .NET Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="5487d-104">Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made outside of a Dispatcher operation may not be reflected when that operation executes.Practically speaking, this means that <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> changes may not flow between WPF UI callbacks and other code in a WPF application.This is due to a change in <xref:System.Threading.ExecutionContext?displayProperty=fullName> that causes <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> to be stored in the execution context beginning with apps targeting the .NET Framework 4.6.</span></span> <span data-ttu-id="5487d-105">Las operaciones de distribuidor de WPF almacenan el contexto de ejecución usado para iniciar la operación y restaurar el contexto anterior cuando la operación se complete.</span><span class="sxs-lookup"><span data-stu-id="5487d-105">WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed.</span></span> <span data-ttu-id="5487d-106">Dado que <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> y <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> ahora forman parte de este contexto, los cambios efectuados en ellas como parte de una operación de distribuidor no persisten fuera de la operación.</span><span class="sxs-lookup"><span data-stu-id="5487d-106">Because <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="5487d-107">Sugerencia</span><span class="sxs-lookup"><span data-stu-id="5487d-107">Suggestion</span></span>

<span data-ttu-id="5487d-108">Las aplicaciones afectadas por este cambio pueden solucionarlo si se almacenan los elementos <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> o <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> deseados en un campo y se protegen todos los cuerpos de las operaciones de distribuidor (incluidos los controladores de devolución de llamadas de eventos de interfaz de usuario) en los que se establezcan los elementos <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> y <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> correctos.</span><span class="sxs-lookup"><span data-stu-id="5487d-108">Apps affected by this change may work around it by storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> in a field and checking in all Dispatcher operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are set.</span></span> <span data-ttu-id="5487d-109">Además, como el cambio de ExecutionContext subyacente a este cambio de WPF solo afecta a las aplicaciones destinadas a .NET Framework 4.6 o una versión más reciente, es posible evitar esta interrupción estableciendo como destino .NET Framework 4.5.2. Las aplicaciones destinadas a .NET Framework 4.6 o una versión posterior también pueden solucionarlo si se establece el modificador de compatibilidad siguiente:</span><span class="sxs-lookup"><span data-stu-id="5487d-109">Alternatively, because the ExecutionContext change underlying this WPF change only affects apps targeting the .NET Framework 4.6 or newer, this break can be avoided by targeting the .NET Framework 4.5.2.Apps that target .NET Framework 4.6 or later can also work around this by setting the following compatibility switch:</span></span>

<pre><code class="lang-csharp">AppContext.SetSwitch(&quot;Switch.System.Globalization.NoAsyncCurrentCulture&quot;, true);&#13;&#10;</code></pre>

<span data-ttu-id="5487d-110">WPF ha solucionado este problema en .NET Framework 4.6.2.</span><span class="sxs-lookup"><span data-stu-id="5487d-110">This issue has been fixed by WPF in .NET Framework 4.6.2.</span></span> <span data-ttu-id="5487d-111">También se ha corregido en .NET Framework 4.6, 4.6.1 a través de [KB 3139549](https://support.microsoft.com/kb/3139549).</span><span class="sxs-lookup"><span data-stu-id="5487d-111">It has also been fixed in .NET Frameworks 4.6, 4.6.1 through [KB 3139549](https://support.microsoft.com/kb/3139549).</span></span> <span data-ttu-id="5487d-112">Las aplicaciones destinadas a .NET Framework 4.6 o una versión posterior obtendrán automáticamente el comportamiento correcto en las aplicaciones de WPF: <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName>) se conservará entre las operaciones del distribuidor.</span><span class="sxs-lookup"><span data-stu-id="5487d-112">Applications targeting .NET Framework 4.6 or later will automatically get the right behavior in WPF applications - <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName>) would be preserved across Dispatcher operations.</span></span>

| <span data-ttu-id="5487d-113">NOMBRE</span><span class="sxs-lookup"><span data-stu-id="5487d-113">Name</span></span>    | <span data-ttu-id="5487d-114">Valor</span><span class="sxs-lookup"><span data-stu-id="5487d-114">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="5487d-115">Ámbito</span><span class="sxs-lookup"><span data-stu-id="5487d-115">Scope</span></span>   | <span data-ttu-id="5487d-116">Secundaria</span><span class="sxs-lookup"><span data-stu-id="5487d-116">Minor</span></span>       |
| <span data-ttu-id="5487d-117">Versión</span><span class="sxs-lookup"><span data-stu-id="5487d-117">Version</span></span> | <span data-ttu-id="5487d-118">4.6</span><span class="sxs-lookup"><span data-stu-id="5487d-118">4.6</span></span>         |
| <span data-ttu-id="5487d-119">Tipo</span><span class="sxs-lookup"><span data-stu-id="5487d-119">Type</span></span>    | <span data-ttu-id="5487d-120">Redestinación</span><span class="sxs-lookup"><span data-stu-id="5487d-120">Retargeting</span></span> |
