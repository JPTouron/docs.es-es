---
title: Guía de seguridad de BinaryFormatter
description: En este artículo se describen los riesgos de seguridad inherentes al tipo BinaryFormatter y las recomendaciones para que lo usen los diferentes serializadores.
ms.date: 07/11/2020
ms.author: levib
author: GrabYourPitchforks
ms.openlocfilehash: 2c76a81650e5b83677f6c4df64770bd1ef5f775e
ms.sourcegitcommit: cbb19e56d48cf88375d35d0c27554d4722761e0d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "88607935"
---
# <a name="binaryformatter-security-guide"></a><span data-ttu-id="78857-103">Guía de seguridad de BinaryFormatter</span><span class="sxs-lookup"><span data-stu-id="78857-103">BinaryFormatter security guide</span></span>

<span data-ttu-id="78857-104">Este artículo se aplica a la implementaciones de .NET siguientes:</span><span class="sxs-lookup"><span data-stu-id="78857-104">This article applies to the following .NET implementations:</span></span>

* <span data-ttu-id="78857-105">.NET Framework (todas las versiones)</span><span class="sxs-lookup"><span data-stu-id="78857-105">.NET Framework all versions</span></span>
* <span data-ttu-id="78857-106">.NET Core 2.1 a 3.1</span><span class="sxs-lookup"><span data-stu-id="78857-106">.NET Core 2.1 - 3.1</span></span>
* <span data-ttu-id="78857-107">.NET 5.0 y versiones posteriores</span><span class="sxs-lookup"><span data-stu-id="78857-107">.NET 5.0 and later</span></span>

## <a name="background"></a><span data-ttu-id="78857-108">Fondo</span><span class="sxs-lookup"><span data-stu-id="78857-108">Background</span></span>

> [!WARNING]
> <span data-ttu-id="78857-109">El tipo <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> es peligroso y ***no*** se recomienda para el procesamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="78857-109">The <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> type is dangerous and is ***not*** recommended for data processing.</span></span> <span data-ttu-id="78857-110">Las aplicaciones deben dejar de usar `BinaryFormatter` lo antes posible, aunque crean que los datos que procesan son de confianza.</span><span class="sxs-lookup"><span data-stu-id="78857-110">Applications should stop using `BinaryFormatter` as soon as possible, even if they believe the data they're processing to be trustworthy.</span></span> <span data-ttu-id="78857-111">`BinaryFormatter` no es seguro y no se puede convertir en seguro.</span><span class="sxs-lookup"><span data-stu-id="78857-111">`BinaryFormatter` is insecure and can't be made secure.</span></span>

<span data-ttu-id="78857-112">Este artículo también se aplica a los tipos siguientes:</span><span class="sxs-lookup"><span data-stu-id="78857-112">This article also applies to the following types:</span></span>

* <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>
* <xref:System.Runtime.Serialization.NetDataContractSerializer>
* <xref:System.Web.UI.LosFormatter>
* <xref:System.Web.UI.ObjectStateFormatter>

<span data-ttu-id="78857-113">Las vulnerabilidades de deserialización son una categoría de amenazas donde las cargas de solicitud se procesan sin seguridad.</span><span class="sxs-lookup"><span data-stu-id="78857-113">Deserialization vulnerabilities are a threat category where request payloads are processed insecurely.</span></span> <span data-ttu-id="78857-114">Un atacante que aprovecha correctamente estas vulnerabilidades en una aplicación puede provocar ataques por denegación de servicio (DoS), la divulgación de información o la ejecución remota de código dentro de la aplicación de destino.</span><span class="sxs-lookup"><span data-stu-id="78857-114">An attacker who successfully leverages these vulnerabilities against an app can cause denial of service (DoS), information disclosure, or remote code execution inside the target app.</span></span> <span data-ttu-id="78857-115">Esta categoría de riesgo se engloba dentro de [OWASP Top 10](https://owasp.org/www-project-top-ten/).</span><span class="sxs-lookup"><span data-stu-id="78857-115">This risk category consistently makes the [OWASP Top 10](https://owasp.org/www-project-top-ten/).</span></span> <span data-ttu-id="78857-116">Los destinos incluyen aplicaciones escritas en [diversos lenguajes](https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data), incluidos C/C++, Java y C#.</span><span class="sxs-lookup"><span data-stu-id="78857-116">Targets include apps written in [a variety of languages](https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data), including C/C++, Java, and C#.</span></span>

<span data-ttu-id="78857-117">En .NET, el mayor destino de riesgo son las aplicaciones que usan el tipo <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> para deserializar datos.</span><span class="sxs-lookup"><span data-stu-id="78857-117">In .NET, the biggest risk target is apps that use the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> type to deserialize data.</span></span> <span data-ttu-id="78857-118">`BinaryFormatter` se utiliza ampliamente en todo el ecosistema de .NET debido a su eficacia y facilidad de uso.</span><span class="sxs-lookup"><span data-stu-id="78857-118">`BinaryFormatter` is widely used throughout the .NET ecosystem because of its power and its ease of use.</span></span> <span data-ttu-id="78857-119">Pero esta misma eficacia ofrece a los atacantes la posibilidad de influir en el flujo de control dentro de la aplicación de destino.</span><span class="sxs-lookup"><span data-stu-id="78857-119">However, this same power gives attackers the ability to influence control flow within the target app.</span></span> <span data-ttu-id="78857-120">Los ataques correctos pueden dar lugar a que el atacante pueda ejecutar código en el contexto del proceso de destino.</span><span class="sxs-lookup"><span data-stu-id="78857-120">Successful attacks can result in the attacker being able to run code within the context of the target process.</span></span>

<span data-ttu-id="78857-121">Como analogía más simple, imagine que la llamada a `BinaryFormatter.Deserialize` sobre una carga es equivalente a interpretar esa carga como un archivo ejecutable independiente e iniciarlo.</span><span class="sxs-lookup"><span data-stu-id="78857-121">As a simpler analogy, assume that calling `BinaryFormatter.Deserialize` over a payload is the equivalent of interpreting that payload as a standalone executable and launching it.</span></span>

## <a name="binaryformatter-security-vulnerabilities"></a><span data-ttu-id="78857-122">Vulnerabilidades de seguridad de BinaryFormatter</span><span class="sxs-lookup"><span data-stu-id="78857-122">BinaryFormatter security vulnerabilities</span></span>

> [!WARNING]
> <span data-ttu-id="78857-123">El método `BinaryFormatter.Deserialize` __nunca__ es seguro cuando se usa con una entrada que no es de confianza.</span><span class="sxs-lookup"><span data-stu-id="78857-123">The `BinaryFormatter.Deserialize` method is __never__ safe when used with untrusted input.</span></span> <span data-ttu-id="78857-124">Se recomienda encarecidamente que los consumidores consideren el uso de una de las alternativas que se describen más adelante en este artículo.</span><span class="sxs-lookup"><span data-stu-id="78857-124">We strongly recommend that consumers instead consider using one of the alternatives outlined later in this article.</span></span>

<span data-ttu-id="78857-125">`BinaryFormatter` se implementó antes de que las vulnerabilidades de deserialización fueran una categoría de amenaza bien entendida.</span><span class="sxs-lookup"><span data-stu-id="78857-125">`BinaryFormatter` was implemented before deserialization vulnerabilities were a well-understood threat category.</span></span> <span data-ttu-id="78857-126">Como resultado, el código no sigue los procedimientos recomendados modernos.</span><span class="sxs-lookup"><span data-stu-id="78857-126">As a result, the code does not follow modern best practices.</span></span> <span data-ttu-id="78857-127">El método `Deserialize` se puede usar como un vector para que los atacantes realicen ataques DoS contra aplicaciones de consumo.</span><span class="sxs-lookup"><span data-stu-id="78857-127">The `Deserialize` method can be used as a vector for attackers to perform DoS attacks against consuming apps.</span></span> <span data-ttu-id="78857-128">Es posible que estos ataques hagan que la aplicación deje de responder o que se produzca una terminación inesperada del proceso.</span><span class="sxs-lookup"><span data-stu-id="78857-128">These attacks might render the app unresponsive or result in unexpected process termination.</span></span> <span data-ttu-id="78857-129">Esta categoría de ataque no se puede mitigar con `SerializationBinder` o con cualquier otro modificador de configuración `BinaryFormatter`.</span><span class="sxs-lookup"><span data-stu-id="78857-129">This category of attack cannot be mitigated with a `SerializationBinder` or any other `BinaryFormatter` configuration switch.</span></span> <span data-ttu-id="78857-130">.NET considera que este comportamiento es ***por definición*** y no emitirá una actualización de código para modificarlo.</span><span class="sxs-lookup"><span data-stu-id="78857-130">.NET considers this behavior to be ***by design*** and won't issue a code update to modify the behavior.</span></span>

<span data-ttu-id="78857-131">`BinaryFormatter.Deserialize` puede ser vulnerable a otras categorías de ataque, como la divulgación de información o la ejecución remota de código.</span><span class="sxs-lookup"><span data-stu-id="78857-131">`BinaryFormatter.Deserialize` may be vulnerable to other attack categories, such as information disclosure or remote code execution.</span></span> <span data-ttu-id="78857-132">El uso de características como un elemento <xref:System.Runtime.Serialization.SerializationBinder> personalizado puede ser insuficiente para mitigar estos riesgos de forma correcta.</span><span class="sxs-lookup"><span data-stu-id="78857-132">Utilizing features such as a custom <xref:System.Runtime.Serialization.SerializationBinder> may be insufficient to properly mitigate these risks.</span></span> <span data-ttu-id="78857-133">Existe la posibilidad de que se detecte una vulnerabilidad nueva para la que .NET no pueda publicar de forma práctica una actualización de seguridad.</span><span class="sxs-lookup"><span data-stu-id="78857-133">The possibility exists that a novel vulnerability will be discovered for which .NET cannot practically publish a security update.</span></span> <span data-ttu-id="78857-134">Los consumidores deben evaluar sus escenarios individuales y considerar su posible exposición a estos riesgos.</span><span class="sxs-lookup"><span data-stu-id="78857-134">Consumers should assess their individual scenarios and consider their potential exposure to these risks.</span></span>

<span data-ttu-id="78857-135">Se recomienda que los consumidores de `BinaryFormatter` realicen valoraciones de riesgo individuales en sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="78857-135">We recommend that `BinaryFormatter` consumers perform individual risk assessments on their apps.</span></span> <span data-ttu-id="78857-136">Es responsabilidad exclusiva del consumidor determinar si se usa `BinaryFormatter`.</span><span class="sxs-lookup"><span data-stu-id="78857-136">It is the consumer's sole responsibility to determine whether to utilize `BinaryFormatter`.</span></span> <span data-ttu-id="78857-137">Los consumidores deben evaluar el riesgo de los requisitos de seguridad, técnicos, de reputación, legales y normativos del uso de `BinaryFormatter`.</span><span class="sxs-lookup"><span data-stu-id="78857-137">Consumers should risk assess the security, technical, reputation, legal, and regulatory requirements of using `BinaryFormatter`.</span></span>

## <a name="preferred-alternatives"></a><span data-ttu-id="78857-138">Alternativas preferidas</span><span class="sxs-lookup"><span data-stu-id="78857-138">Preferred alternatives</span></span>

<span data-ttu-id="78857-139">.NET ofrece varios serializadores integrados que pueden administrar de forma segura los datos que no son de confianza:</span><span class="sxs-lookup"><span data-stu-id="78857-139">.NET offers several in-box serializers that can handle untrusted data safely:</span></span>

* <span data-ttu-id="78857-140"><xref:System.Xml.Serialization.XmlSerializer> y <xref:System.Runtime.Serialization.DataContractSerializer> para serializar gráficos de objetos en y desde XML.</span><span class="sxs-lookup"><span data-stu-id="78857-140"><xref:System.Xml.Serialization.XmlSerializer> and <xref:System.Runtime.Serialization.DataContractSerializer> to serialize object graphs into and from XML.</span></span> <span data-ttu-id="78857-141">No se debe confundir `DataContractSerializer` con <xref:System.Runtime.Serialization.NetDataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="78857-141">Do not confuse `DataContractSerializer` with  <xref:System.Runtime.Serialization.NetDataContractSerializer>.</span></span>
* <span data-ttu-id="78857-142"><xref:System.IO.BinaryReader> y <xref:System.IO.BinaryWriter> para XML y JSON.</span><span class="sxs-lookup"><span data-stu-id="78857-142"><xref:System.IO.BinaryReader> and <xref:System.IO.BinaryWriter> for XML and JSON.</span></span>
* <span data-ttu-id="78857-143">Las API de <xref:System.Text.Json> para serializar gráficos de objetos en JSON.</span><span class="sxs-lookup"><span data-stu-id="78857-143">The <xref:System.Text.Json> APIs to serialize object graphs into JSON.</span></span>

## <a name="dangerous-alternatives"></a><span data-ttu-id="78857-144">Alternativas peligrosas</span><span class="sxs-lookup"><span data-stu-id="78857-144">Dangerous alternatives</span></span>

<span data-ttu-id="78857-145">Evite los siguientes serializadores:</span><span class="sxs-lookup"><span data-stu-id="78857-145">Avoid the following serializers:</span></span>

* <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>
* <xref:System.Web.UI.LosFormatter>
* <xref:System.Runtime.Serialization.NetDataContractSerializer>
* <xref:System.Web.UI.ObjectStateFormatter>

<span data-ttu-id="78857-146">Los serializadores anteriores realizan una deserialización polimórfica sin restricciones y son peligrosos, como `BinaryFormatter`.</span><span class="sxs-lookup"><span data-stu-id="78857-146">The preceding serializers all perform unrestricted polymorphic deserialization and are dangerous, just like `BinaryFormatter`.</span></span>

## <a name="the-risks-of-assuming-data-to-be-trustworthy"></a><span data-ttu-id="78857-147">Riesgos de asumir que los datos son de confianza</span><span class="sxs-lookup"><span data-stu-id="78857-147">The risks of assuming data to be trustworthy</span></span>

<span data-ttu-id="78857-148">Con frecuencia, un desarrollador de aplicaciones podría creer que solo procesa entradas de confianza.</span><span class="sxs-lookup"><span data-stu-id="78857-148">Frequently, an app developer might believe that they are processing only trusted input.</span></span> <span data-ttu-id="78857-149">El caso de la entrada segura es cierto en algunas circunstancias poco frecuentes.</span><span class="sxs-lookup"><span data-stu-id="78857-149">The safe input case is true in some rare circumstances.</span></span> <span data-ttu-id="78857-150">Pero es mucho más común que una carga cruce un límite de confianza sin que el desarrollador sea consciente de ello.</span><span class="sxs-lookup"><span data-stu-id="78857-150">But it's much more common that a payload crosses a trust boundary without the developer realizing it.</span></span>

<span data-ttu-id="78857-151">__Le recomendamos que use un servidor local__ en el que los empleados usan un cliente de escritorio desde sus estaciones de trabajo para interactuar con el servicio.</span><span class="sxs-lookup"><span data-stu-id="78857-151">__Consider an on-prem server__ where employees use a desktop client from their workstations to interact with the service.</span></span> <span data-ttu-id="78857-152">Este escenario se podría considerar ingenuamente como una configuración "segura" en la que es aceptable usar `BinaryFormatter`.</span><span class="sxs-lookup"><span data-stu-id="78857-152">This scenario might be seen naïvely as a "safe" setup where utilizing `BinaryFormatter` is acceptable.</span></span> <span data-ttu-id="78857-153">Pero este escenario presenta un vector de malware que obtiene acceso al equipo de un único empleado para poder propagarse por toda la empresa.</span><span class="sxs-lookup"><span data-stu-id="78857-153">However, this scenario presents a vector for malware that gains access to a single employee's machine to be able to spread throughout the enterprise.</span></span> <span data-ttu-id="78857-154">Ese malware puede aprovechar el uso de `BinaryFormatter` de la empresa para después moverse lateralmente desde la estación de trabajo del empleado hasta el servidor de back-end.</span><span class="sxs-lookup"><span data-stu-id="78857-154">That malware can leverage the enterprise's use of `BinaryFormatter` to move laterally from the employee's workstation to the backend server.</span></span> <span data-ttu-id="78857-155">Luego, puede extraer datos confidenciales de la empresa,</span><span class="sxs-lookup"><span data-stu-id="78857-155">It can then exfiltrate the company's sensitive data.</span></span> <span data-ttu-id="78857-156">como secretos comerciales o datos de clientes.</span><span class="sxs-lookup"><span data-stu-id="78857-156">Such data could include trade secrets or customer data.</span></span>

<span data-ttu-id="78857-157">__Considere también una aplicación que use `BinaryFormatter` para conservar el estado de guardado.__</span><span class="sxs-lookup"><span data-stu-id="78857-157">__Consider also an app that uses `BinaryFormatter` to persist save state.__</span></span> <span data-ttu-id="78857-158">Esto podría parecer inicialmente un escenario seguro, ya que la lectura y escritura de datos en una unidad de disco duro propia representa una amenaza menor.</span><span class="sxs-lookup"><span data-stu-id="78857-158">This might at first seem to be a safe scenario, as reading and writing data on your own hard drive represents a minor threat.</span></span> <span data-ttu-id="78857-159">Pero es habitual compartir documentos por correo electrónico o Internet, y la mayoría de los usuarios finales no perciben que abrir estos archivos descargados sea un comportamiento arriesgado.</span><span class="sxs-lookup"><span data-stu-id="78857-159">However, sharing documents across email or the internet is common, and most end users wouldn't perceive opening these downloaded files as risky behavior.</span></span>

<span data-ttu-id="78857-160">Este escenario se puede aprovechar con un efecto malintencionado.</span><span class="sxs-lookup"><span data-stu-id="78857-160">This scenario can be leveraged to nefarious effect.</span></span> <span data-ttu-id="78857-161">Si la aplicación es un juego, los usuarios que comparten archivos de guardado se ponen en riesgo sin saberlo.</span><span class="sxs-lookup"><span data-stu-id="78857-161">If the app is a game, users who share save files unknowingly place themselves at risk.</span></span> <span data-ttu-id="78857-162">Los propios desarrolladores también pueden ser el objetivo.</span><span class="sxs-lookup"><span data-stu-id="78857-162">The developers themselves can also be targeted.</span></span> <span data-ttu-id="78857-163">El atacante podría enviar un correo electrónico al soporte técnico de los desarrolladores, adjuntar un archivo de datos malintencionado y pedir al personal de soporte técnico que lo abra.</span><span class="sxs-lookup"><span data-stu-id="78857-163">The attacker might email the developers' tech support, attaching a malicious data file and asking the support staff to open it.</span></span> <span data-ttu-id="78857-164">Este tipo de ataque podría servir al atacante para adentrarse en la empresa.</span><span class="sxs-lookup"><span data-stu-id="78857-164">This kind of attack could give the attacker a foothold in the enterprise.</span></span>

<span data-ttu-id="78857-165">Otro escenario es cuando el archivo de datos se encuentra en el almacenamiento en la nube y se sincroniza de forma automática entre los equipos del usuario.</span><span class="sxs-lookup"><span data-stu-id="78857-165">Another scenario is where the data file is stored in cloud storage and automatically synced between the user's machines.</span></span> <span data-ttu-id="78857-166">Un atacante que consiga obtener acceso a la cuenta de almacenamiento en la nube puede envenenar el archivo de datos.</span><span class="sxs-lookup"><span data-stu-id="78857-166">An attacker who is able to gain access to the cloud storage account can poison the data file.</span></span> <span data-ttu-id="78857-167">Este archivo de datos se sincronizará automáticamente con los equipos del usuario.</span><span class="sxs-lookup"><span data-stu-id="78857-167">This data file will be automatically synced to the user's machines.</span></span> <span data-ttu-id="78857-168">La próxima vez que el usuario abra el archivo de datos, se ejecutará la carga del atacante.</span><span class="sxs-lookup"><span data-stu-id="78857-168">The next time the user opens the data file, the attacker's payload runs.</span></span> <span data-ttu-id="78857-169">Por tanto, el atacante puede aprovechar un riesgo de la cuenta de almacenamiento en la nube para obtener permisos de ejecución de código completos.</span><span class="sxs-lookup"><span data-stu-id="78857-169">Thus the attacker can leverage a cloud storage account compromise to gain full code execution permissions.</span></span>

<span data-ttu-id="78857-170">__Considere una aplicación que pase de un modelo de instalación de escritorio a un modelo de primero en la nube.__</span><span class="sxs-lookup"><span data-stu-id="78857-170">__Consider an app that moves from a desktop-install model to a cloud-first model.__</span></span> <span data-ttu-id="78857-171">Este escenario incluye aplicaciones que se mueven desde una aplicación de escritorio o un modelo de cliente enriquecido a un modelo basado en web.</span><span class="sxs-lookup"><span data-stu-id="78857-171">This scenario includes apps that move from a desktop app or rich client model into a web-based model.</span></span> <span data-ttu-id="78857-172">Los modelos de amenazas descritos para la aplicación de escritorio no se aplican necesariamente al servicio basado en la nube.</span><span class="sxs-lookup"><span data-stu-id="78857-172">Any threat models drawn for the desktop app aren't necessarily applicable to the cloud-based service.</span></span> <span data-ttu-id="78857-173">Es posible que en el modelo de amenazas de la aplicación de escritorio se descarte una amenaza concreta como "no interesante para que el cliente se ataque a sí mismo".</span><span class="sxs-lookup"><span data-stu-id="78857-173">The threat model for the desktop app might dismiss a given threat as "not interesting for the client to attack itself."</span></span> <span data-ttu-id="78857-174">Pero esa misma amenaza podría resultar interesante cuando considera que un usuario remoto (el cliente) ataca al propio servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="78857-174">But that same threat might become interesting when it considers a remote user (the client) attacking the cloud service itself.</span></span>

> [!NOTE]
> <span data-ttu-id="78857-175">En términos generales, la intención de la serialización es transmitir un objeto dentro o fuera de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="78857-175">In general terms, the intent of serialization is to transmit an object into or out of an app.</span></span> <span data-ttu-id="78857-176">Un ejercicio de modelado de amenazas casi siempre marca este tipo de transferencia de datos como el cruce de un límite de confianza.</span><span class="sxs-lookup"><span data-stu-id="78857-176">A threat modeling exercise almost always marks this kind of data transfer as crossing a trust boundary.</span></span>

## <a name="further-resources"></a><span data-ttu-id="78857-177">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="78857-177">Further resources</span></span>

* <span data-ttu-id="78857-178">[YSoSerial.Net](https://github.com/pwntester/ysoserial.net) para investigar cómo los adversarios atacan las aplicaciones que usan `BinaryFormatter`.</span><span class="sxs-lookup"><span data-stu-id="78857-178">[YSoSerial.Net](https://github.com/pwntester/ysoserial.net) for research into how adversaries attack apps that utilize `BinaryFormatter`.</span></span>
* <span data-ttu-id="78857-179">Información general sobre vulnerabilidades de deserialización:</span><span class="sxs-lookup"><span data-stu-id="78857-179">General background on deserialization vulnerabilities:</span></span>
  * [<span data-ttu-id="78857-180">OWASP Top 10: A8:2017 - Deserialización no segura</span><span class="sxs-lookup"><span data-stu-id="78857-180">OWASP Top 10 - A8:2017-Insecure Deserialization</span></span>](https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A8-Insecure_Deserialization)
  * [<span data-ttu-id="78857-181">CWE-502: Deserialización de datos que no son de confianza</span><span class="sxs-lookup"><span data-stu-id="78857-181">CWE-502: Deserialization of Untrusted Data</span></span>](https://cwe.mitre.org/data/definitions/502.html)
