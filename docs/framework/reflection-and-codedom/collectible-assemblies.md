---
title: Ensamblados recopilables para la generación dinámica de tipos
description: Empiece a usar ensamblados recopilables para la generación dinámica de tipos en .NET. Lea sobre la duración y las restricciones de los ensamblados recopilables.
ms.date: 08/29/2017
helpviewer_keywords:
- reflection, dynamic assembly
- assemblies, collectible
- collectible assemblies, retrieving
ms.openlocfilehash: 4981b93dbd49a6da96740bebed0f2ed7b89036c8
ms.sourcegitcommit: cf5a800a33de64d0aad6d115ffcc935f32375164
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 07/20/2020
ms.locfileid: "86475130"
---
# <a name="collectible-assemblies-for-dynamic-type-generation"></a><span data-ttu-id="352d8-104">Ensamblados recopilables para la generación dinámica de tipos</span><span class="sxs-lookup"><span data-stu-id="352d8-104">Collectible assemblies for dynamic type generation</span></span>

<span data-ttu-id="352d8-105">Los *ensamblados recopilables* son ensamblados dinámicos que se pueden descargar sin descargar el dominio de aplicación en el que se crearon.</span><span class="sxs-lookup"><span data-stu-id="352d8-105">*Collectible assemblies* are dynamic assemblies that can be unloaded without unloading the application domain in which they were created.</span></span> <span data-ttu-id="352d8-106">Se puede reclamar toda la memoria administrada y sin administrar usada por un ensamblado recopilable y los tipos que contiene.</span><span class="sxs-lookup"><span data-stu-id="352d8-106">All managed and unmanaged memory used by a collectible assembly and the types it contains can be reclaimed.</span></span> <span data-ttu-id="352d8-107">La información como el nombre de ensamblado se quita de las tablas internas.</span><span class="sxs-lookup"><span data-stu-id="352d8-107">Information such as the assembly name is removed from internal tables.</span></span>

<span data-ttu-id="352d8-108">Para habilitar la descarga, use la marca <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> cuando cree un ensamblado dinámico.</span><span class="sxs-lookup"><span data-stu-id="352d8-108">To enable unloading, use the <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> flag when you create a dynamic assembly.</span></span> <span data-ttu-id="352d8-109">El ensamblado es transitorio (es decir, no se puede guardar) y está sujeto a las limitaciones descritas en la sección [Restricciones de los ensamblados recopilables](#restrictions-on-collectible-assemblies).</span><span class="sxs-lookup"><span data-stu-id="352d8-109">The assembly is transient (that is, it cannot be saved) and is subject to limitations described in the [Restrictions on Collectible Assemblies](#restrictions-on-collectible-assemblies) section.</span></span> <span data-ttu-id="352d8-110">Common Language Runtime (CLR) descarga automáticamente un ensamblado recopilable cuando se liberan todos los objetos asociados al ensamblado.</span><span class="sxs-lookup"><span data-stu-id="352d8-110">The common language runtime (CLR) unloads a collectible assembly automatically when you release all objects associated with the assembly.</span></span> <span data-ttu-id="352d8-111">En todos los demás aspectos, los ensamblados recopilables se crean y se usan de la misma manera que los demás ensamblados dinámicos.</span><span class="sxs-lookup"><span data-stu-id="352d8-111">In all other respects, collectible assemblies are created and used in the same way as other dynamic assemblies.</span></span>

## <a name="lifetime-of-collectible-assemblies"></a><span data-ttu-id="352d8-112">Duración de los ensamblados recopilables</span><span class="sxs-lookup"><span data-stu-id="352d8-112">Lifetime of collectible assemblies</span></span>

<span data-ttu-id="352d8-113">La duración de un ensamblado recopilable se controla mediante referencias a los tipos que contiene y los objetos que se crean a partir de esos tipos.</span><span class="sxs-lookup"><span data-stu-id="352d8-113">The lifetime of a collectible assembly is controlled by the existence of references to the types it contains and the objects that are created from those types.</span></span> <span data-ttu-id="352d8-114">Common Language Runtime no descarga un ensamblado siempre que existan uno o varios de los siguientes (`T` es cualquier tipo definido en el ensamblado):</span><span class="sxs-lookup"><span data-stu-id="352d8-114">The common language runtime does not unload an assembly as long as one or more of the following exist (`T` is any type that is defined in the assembly):</span></span>

- <span data-ttu-id="352d8-115">Instancia de `T`.</span><span class="sxs-lookup"><span data-stu-id="352d8-115">An instance of `T`.</span></span>

- <span data-ttu-id="352d8-116">Una instancia de una matriz de `T`.</span><span class="sxs-lookup"><span data-stu-id="352d8-116">An instance of an array of `T`.</span></span>

- <span data-ttu-id="352d8-117">Una instancia de un tipo genérico que tenga `T` como uno de sus argumentos de tipo.</span><span class="sxs-lookup"><span data-stu-id="352d8-117">An instance of a generic type that has `T` as one of its type arguments.</span></span> <span data-ttu-id="352d8-118">Esto incluye las recopilaciones genéricas de `T`, aun cuando esa recopilación esté vacía.</span><span class="sxs-lookup"><span data-stu-id="352d8-118">This includes generic collections of `T`, even if that collection is empty.</span></span>

- <span data-ttu-id="352d8-119">Una instancia de <xref:System.Type> o <xref:System.Reflection.Emit.TypeBuilder> que represente a `T`.</span><span class="sxs-lookup"><span data-stu-id="352d8-119">An instance of <xref:System.Type> or <xref:System.Reflection.Emit.TypeBuilder> that represents `T`.</span></span>

   > [!IMPORTANT]
   > <span data-ttu-id="352d8-120">Debe liberar todos los objetos que representen a partes del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="352d8-120">You must release all objects that represent parts of the assembly.</span></span> <span data-ttu-id="352d8-121">El elemento <xref:System.Reflection.Emit.ModuleBuilder> que define `T` mantiene una referencia a <xref:System.Reflection.Emit.TypeBuilder> y el objeto <xref:System.Reflection.Emit.AssemblyBuilder> mantiene una referencia a <xref:System.Reflection.Emit.ModuleBuilder>, así que las referencias a estos objetos deben liberarse.</span><span class="sxs-lookup"><span data-stu-id="352d8-121">The <xref:System.Reflection.Emit.ModuleBuilder> that defines `T` keeps a reference to the <xref:System.Reflection.Emit.TypeBuilder>, and the <xref:System.Reflection.Emit.AssemblyBuilder> object keeps a reference to the <xref:System.Reflection.Emit.ModuleBuilder>, so references to these objects must be released.</span></span> <span data-ttu-id="352d8-122">Incluso la existencia de un elemento <xref:System.Reflection.Emit.LocalBuilder> o <xref:System.Reflection.Emit.ILGenerator> usado en la construcción de `T` evita la descarga.</span><span class="sxs-lookup"><span data-stu-id="352d8-122">Even the existence of a <xref:System.Reflection.Emit.LocalBuilder> or an <xref:System.Reflection.Emit.ILGenerator> used in the construction of `T` prevents unloading.</span></span>

- <span data-ttu-id="352d8-123">Una referencia estática a `T` por parte de otro tipo `T1` definido de forma dinámica que siga siendo accesible mediante la ejecución de código.</span><span class="sxs-lookup"><span data-stu-id="352d8-123">A static reference to `T` by another dynamically defined type `T1` that is still reachable by executing code.</span></span> <span data-ttu-id="352d8-124">Por ejemplo, `T1` puede derivar de `T`, o `T` puede ser el tipo de un parámetro en un método de `T1`.</span><span class="sxs-lookup"><span data-stu-id="352d8-124">For example, `T1` might derive from `T`, or `T` might be the type of a parameter in a method of `T1`.</span></span>

- <span data-ttu-id="352d8-125">**ByRef** a un campo estático que pertenece a `T`.</span><span class="sxs-lookup"><span data-stu-id="352d8-125">A **ByRef** to a static field that belongs to `T`.</span></span>

- <span data-ttu-id="352d8-126"><xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle> o <xref:System.RuntimeMethodHandle> que hace referencia a `T` o a un componente de `T`.</span><span class="sxs-lookup"><span data-stu-id="352d8-126">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, or <xref:System.RuntimeMethodHandle> that refers to `T` or to a component of `T`.</span></span>

- <span data-ttu-id="352d8-127">Una instancia de cualquier objeto de reflexión que se pudiera usar de forma directa o indirecta para acceder al objeto <xref:System.Type> que representa `T`.</span><span class="sxs-lookup"><span data-stu-id="352d8-127">An instance of any reflection object that could be used indirectly or directly to access the <xref:System.Type> object that represents `T`.</span></span> <span data-ttu-id="352d8-128">Por ejemplo, el objeto <xref:System.Type> para `T` puede obtenerse a partir de un tipo de matriz cuyo tipo de elemento es `T` o de un tipo genérico que tiene `T` como argumento de tipo.</span><span class="sxs-lookup"><span data-stu-id="352d8-128">For example, the <xref:System.Type> object for `T` can be obtained from an array type whose element type is `T`, or from a generic type that has `T` as a type argument.</span></span>

- <span data-ttu-id="352d8-129">Un método `M` en la pila de llamadas de cualquier subproceso, donde `M` es un método de `T` o un método de nivel de módulo definido en el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="352d8-129">A method `M` on the call stack of any thread, where `M` is a method of `T` or a module-level method that is defined in the assembly.</span></span>

- <span data-ttu-id="352d8-130">Un delegado a un método estático definido en un módulo del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="352d8-130">A delegate to a static method that is defined in a module of the assembly.</span></span>

<span data-ttu-id="352d8-131">Si solo existe un elemento de esta lista para un solo tipo o un método del ensamblado, el runtime no puede descargar el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="352d8-131">If only one item from this list exists for only one type or one method in the assembly, the runtime cannot unload the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="352d8-132">El runtime no descarga realmente el ensamblado hasta que se han ejecutado los finalizadores de todos los elementos de la lista.</span><span class="sxs-lookup"><span data-stu-id="352d8-132">The runtime does not actually unload the assembly until finalizers have run for all items in the list.</span></span>

<span data-ttu-id="352d8-133">Para realizar el seguimiento de la duración, se considera que en el ensamblado que contiene la definición del tipo genérico o en un ensamblado que contiene la definición de uno de sus argumentos de tipo se ha definido un tipo genérico construido `List<int>` (en C#) o `List(Of Integer)` (en Visual Basic) creado y usado en la generación de un ensamblado recopilable.</span><span class="sxs-lookup"><span data-stu-id="352d8-133">For purposes of tracking lifetime, a constructed generic type such as `List<int>` (in C#) or `List(Of Integer)` (in Visual Basic) that is created and used in the generation of a collectible assembly is considered to have been defined either in the assembly that contains the generic type definition or in an assembly that contains the definition of one of its type arguments.</span></span> <span data-ttu-id="352d8-134">El ensamblado exacto que se usa es un detalle de implementación y está sujeto a cambios.</span><span class="sxs-lookup"><span data-stu-id="352d8-134">The exact assembly that is used is an implementation detail and subject to change.</span></span>

## <a name="restrictions-on-collectible-assemblies"></a><span data-ttu-id="352d8-135">Restricciones de los ensamblados recopilables</span><span class="sxs-lookup"><span data-stu-id="352d8-135">Restrictions on collectible assemblies</span></span>

<span data-ttu-id="352d8-136">Las siguientes restricciones se aplican a los ensamblados recopilables:</span><span class="sxs-lookup"><span data-stu-id="352d8-136">The following restrictions apply to collectible assemblies:</span></span>

- <span data-ttu-id="352d8-137">**Referencias estáticas** Los tipos de un ensamblado dinámico normal no pueden tener referencias estáticas a los tipos definidos en un ensamblado recopilable.</span><span class="sxs-lookup"><span data-stu-id="352d8-137">**Static references** Types in an ordinary dynamic assembly cannot have static references to types that are defined in a collectible assembly.</span></span> <span data-ttu-id="352d8-138">Por ejemplo, si define un tipo normal que hereda de un tipo de un ensamblado recopilable, se produce una excepción <xref:System.NotSupportedException>.</span><span class="sxs-lookup"><span data-stu-id="352d8-138">For example, if you define an ordinary type that inherits from a type in a collectible assembly, a <xref:System.NotSupportedException> exception is thrown.</span></span> <span data-ttu-id="352d8-139">Un tipo de un ensamblado recopilable puede tener referencias estáticas a un tipo de otro ensamblado recopilable, pero esto amplía la duración del ensamblado al que se hace referencia a la duración del ensamblado que hace referencia.</span><span class="sxs-lookup"><span data-stu-id="352d8-139">A type in a collectible assembly can have static references to a type in another collectible assembly, but this extends the lifetime of the referenced assembly to the lifetime of the referencing assembly.</span></span>

- <span data-ttu-id="352d8-140">**Interoperabilidad COM** No se pueden definir interfaces COM dentro de un ensamblado recopilable, ni ninguna instancia de tipos de un ensamblado recopilable se puede convertir en objetos COM.</span><span class="sxs-lookup"><span data-stu-id="352d8-140">**COM interop** No COM interfaces can be defined within a collectible assembly, and no instances of types within a collectible assembly can be converted into COM objects.</span></span> <span data-ttu-id="352d8-141">Un tipo de un ensamblado recopilable no puede actuar como contenedor CCW ni contenedor RCW.</span><span class="sxs-lookup"><span data-stu-id="352d8-141">A type in a collectible assembly cannot serve as a COM callable wrapper (CCW) or runtime callable wrapper (RCW).</span></span> <span data-ttu-id="352d8-142">Pero los tipos de los ensamblados recopilables pueden usar objetos que implementen interfaces COM.</span><span class="sxs-lookup"><span data-stu-id="352d8-142">However, types in collectible assemblies can use objects that implement COM interfaces.</span></span>

- <span data-ttu-id="352d8-143">**Invocación de plataforma** Los métodos que tienen el atributo <xref:System.Runtime.InteropServices.DllImportAttribute> no se compilan cuando se declaran en un ensamblado recopilable.</span><span class="sxs-lookup"><span data-stu-id="352d8-143">**Platform invoke** Methods that have the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute will not compile when they are declared in a collectible assembly.</span></span> <span data-ttu-id="352d8-144">La instrucción <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> no se puede usar en la implementación de un tipo de un ensamblado recopilable, y estos tipos no se pueden serializar en código no administrado.</span><span class="sxs-lookup"><span data-stu-id="352d8-144">The <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> instruction cannot be used in the implementation of a type in a collectible assembly, and such types cannot be marshaled to unmanaged code.</span></span> <span data-ttu-id="352d8-145">Pero se puede llamar al código nativo mediante el uso de un punto de entrada declarado en un ensamblado no recopilable.</span><span class="sxs-lookup"><span data-stu-id="352d8-145">However, you can call into native code by using an entry point that is declared in a non-collectible assembly.</span></span>

- <span data-ttu-id="352d8-146">**Serialización** No se pueden serializar los objetos (en particular, los delegados) definidos en ensamblados recopilables.</span><span class="sxs-lookup"><span data-stu-id="352d8-146">**Marshaling** Objects (in particular, delegates) that are defined in collectible assemblies cannot be marshaled.</span></span> <span data-ttu-id="352d8-147">Se trata de una restricción para todos los tipos transitorios emitidos.</span><span class="sxs-lookup"><span data-stu-id="352d8-147">This is a restriction on all transient emitted types.</span></span>

- <span data-ttu-id="352d8-148">**Carga de ensamblados** La emisión de la reflexión es el único mecanismo admitido para cargar ensamblados recopilables.</span><span class="sxs-lookup"><span data-stu-id="352d8-148">**Assembly loading** Reflection emit is the only mechanism that is supported for loading collectible assemblies.</span></span> <span data-ttu-id="352d8-149">Los ensamblados cargados mediante cualquier otra forma de carga de ensamblados no se pueden descargar.</span><span class="sxs-lookup"><span data-stu-id="352d8-149">Assemblies that are loaded by using any other form of assembly loading cannot be unloaded.</span></span>

- <span data-ttu-id="352d8-150">**Objetos enlazados por contexto** No se admiten las variables estáticas de contexto.</span><span class="sxs-lookup"><span data-stu-id="352d8-150">**Context-bound objects** Context-static variables are not supported.</span></span> <span data-ttu-id="352d8-151">Los tipos de un ensamblado recopilable no pueden extender <xref:System.ContextBoundObject>.</span><span class="sxs-lookup"><span data-stu-id="352d8-151">Types in a collectible assembly cannot extend <xref:System.ContextBoundObject>.</span></span> <span data-ttu-id="352d8-152">Pero el código de los ensamblados recopilables puede usar objetos enlazados a un contexto definidos en otro lugar.</span><span class="sxs-lookup"><span data-stu-id="352d8-152">However, code in collectible assemblies can use context-bound objects that are defined elsewhere.</span></span>

- <span data-ttu-id="352d8-153">**Datos estáticos de subproceso** No se admiten las variables estáticas de subproceso.</span><span class="sxs-lookup"><span data-stu-id="352d8-153">**Thread-static data** Thread-static variables are not supported.</span></span>

## <a name="see-also"></a><span data-ttu-id="352d8-154">Vea también</span><span class="sxs-lookup"><span data-stu-id="352d8-154">See also</span></span>

- [<span data-ttu-id="352d8-155">Emitir métodos y ensamblados dinámicos</span><span class="sxs-lookup"><span data-stu-id="352d8-155">Emitting Dynamic Methods and Assemblies</span></span>](emitting-dynamic-methods-and-assemblies.md)
