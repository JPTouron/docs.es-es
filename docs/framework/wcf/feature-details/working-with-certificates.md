---
title: Trabajar con certificados
description: Obtenga información sobre las características de los certificados digitales X. 509 y cómo usarlos en WCF. Los recursos de este artículo pueden explicar aún más estos conceptos.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- certificates [WCF]
ms.assetid: 6ffb8682-8f07-4a45-afbb-8d2487e9dbc3
ms.openlocfilehash: 8090e84b33e2a6f442d387c7012e6ccdc2900dd1
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/23/2020
ms.locfileid: "85246407"
---
# <a name="working-with-certificates"></a><span data-ttu-id="b13c8-104">Trabajar con certificados</span><span class="sxs-lookup"><span data-stu-id="b13c8-104">Working with Certificates</span></span>

<span data-ttu-id="b13c8-105">Para programar la seguridad de Windows Communication Foundation (WCF), los certificados digitales de X.509 se usan normalmente para autenticar clientes y servidores, cifrar y firmar mensajes digitalmente.</span><span class="sxs-lookup"><span data-stu-id="b13c8-105">To program Windows Communication Foundation (WCF) security, X.509 digital certificates are commonly used to authenticate clients and servers, encrypt, and digitally sign messages.</span></span> <span data-ttu-id="b13c8-106">En este tema se explican brevemente las características de los certificados digitales X.509 y cómo usarlos en WCF, y se incluyen vínculos a los temas en los que se explican estos conceptos en mayor profundidad o en los que se muestra cómo llevar a cabo tareas comunes mediante WCF y los certificados.</span><span class="sxs-lookup"><span data-stu-id="b13c8-106">This topic briefly explains X.509 digital certificate features and how to use them in WCF, and includes links to topics that explain these concepts further or that show how to accomplish common tasks using WCF and certificates.</span></span>

<span data-ttu-id="b13c8-107">En resumen, un certificado digital forma una parte de una *infraestructura de clave pública* (PKI), que es un sistema de certificados digitales, entidades de certificación y otras autoridades de registro que comprueban y autentican la validez de cada parte implicada en una transacción electrónica a través del uso de criptografía de claves públicas.</span><span class="sxs-lookup"><span data-stu-id="b13c8-107">In brief, a digital certificate is a part of a *public key infrastructure* (PKI), which is a system of digital certificates, certificate authorities, and other registration authorities that verify and authenticate the validity of each party involved in an electronic transaction through the use of public key cryptography.</span></span> <span data-ttu-id="b13c8-108">Una entidad de certificación emite certificados y cada certificado tiene un conjunto de campos que contienen datos, como el *asunto* (la entidad a la que se emite el certificado), las fechas de validez (cuándo es válido el certificado), el emisor (la entidad que emitió el certificado) y una clave pública.</span><span class="sxs-lookup"><span data-stu-id="b13c8-108">A certification authority issues certificates and each certificate has a set of fields that contain data, such as *subject* (the entity to which the certificate is issued), validity dates (when the certificate is valid), issuer (the entity that issued the certificate), and a public key.</span></span> <span data-ttu-id="b13c8-109">En WCF, cada una de estas propiedades se procesa como una <xref:System.IdentityModel.Claims.Claim>, y cada notificación se divide en dos tipos: identidad y derecho.</span><span class="sxs-lookup"><span data-stu-id="b13c8-109">In WCF, each of these properties is processed as a <xref:System.IdentityModel.Claims.Claim>, and each claim is further divided into two types: identity and right.</span></span> <span data-ttu-id="b13c8-110">Para obtener más información sobre los certificados X.509, vea [X.509 Public Key Certificates](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates) (Certificados X.509 de clave pública).</span><span class="sxs-lookup"><span data-stu-id="b13c8-110">For more information about X.509 certificates see [X.509 Public Key Certificates](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates).</span></span> <span data-ttu-id="b13c8-111">Para obtener más información sobre las notificaciones y la autorización en WCF, vea [Administración de notificaciones y autorización con el modelo de identidad](managing-claims-and-authorization-with-the-identity-model.md).</span><span class="sxs-lookup"><span data-stu-id="b13c8-111">For more information about Claims and Authorization in WCF see [Managing Claims and Authorization with the Identity Model](managing-claims-and-authorization-with-the-identity-model.md).</span></span> <span data-ttu-id="b13c8-112">Para obtener más información acerca de la implementación de una PKI, consulte [PKI de empresa con Windows Server 2012 R2 Active Directory servicios de servidor de certificados](https://docs.microsoft.com/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span><span class="sxs-lookup"><span data-stu-id="b13c8-112">For more information about implementing a PKI, see [Enterprise PKI with Windows Server 2012 R2 Active Directory Certificate Services](https://docs.microsoft.com/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span></span>

<span data-ttu-id="b13c8-113">La función principal de un certificado es la de autenticar la identidad del propietario del certificado ante los demás.</span><span class="sxs-lookup"><span data-stu-id="b13c8-113">The primary function of a certificate is to authenticate the identity of the owner of the certificate to others.</span></span> <span data-ttu-id="b13c8-114">Un certificado contiene la *clave pública* del propietario, mientras que el propietario conserva la clave privada.</span><span class="sxs-lookup"><span data-stu-id="b13c8-114">A certificate contains the *public key* of the owner, while the owner retains the private key.</span></span> <span data-ttu-id="b13c8-115">La clave pública se puede usar para cifrar los mensajes enviados al propietario del certificado.</span><span class="sxs-lookup"><span data-stu-id="b13c8-115">The public key can be used to encrypt messages sent to the owner of the certificate.</span></span> <span data-ttu-id="b13c8-116">Solo el propietario tiene acceso a la clave privada, por lo que únicamente él puede descifrar esos mensajes.</span><span class="sxs-lookup"><span data-stu-id="b13c8-116">Only the owner has access to the private key, so only the owner can decrypt those messages.</span></span>

<span data-ttu-id="b13c8-117">Los certificados los debe emitir una entidad de certificación, que suele ser un emisor de certificados de terceros.</span><span class="sxs-lookup"><span data-stu-id="b13c8-117">Certificates must be issued by a certification authority, which is often a third-party  issuer of certificates.</span></span> <span data-ttu-id="b13c8-118">En un dominio de Windows, se incluye una entidad de certificación que se puede usar para emitir los certificados a los equipos del dominio.</span><span class="sxs-lookup"><span data-stu-id="b13c8-118">On a Windows domain, a certification authority is included that can be used to issue certificates to computers on the domain.</span></span>

## <a name="viewing-certificates"></a><span data-ttu-id="b13c8-119">Visualización de certificados</span><span class="sxs-lookup"><span data-stu-id="b13c8-119">Viewing Certificates</span></span>

<span data-ttu-id="b13c8-120">Para trabajar con certificados, a menudo es necesario verlos y examinar sus propiedades.</span><span class="sxs-lookup"><span data-stu-id="b13c8-120">To work with certificates, it is often necessary to view them and examine their properties.</span></span> <span data-ttu-id="b13c8-121">Esto se hace con facilidad con la herramienta de complemento Microsoft Management Console (MMC).</span><span class="sxs-lookup"><span data-stu-id="b13c8-121">This is easily done with the Microsoft Management Console (MMC) snap-in tool.</span></span> <span data-ttu-id="b13c8-122">Para más información, consulte [Visualización de certificados con el complemento MMC](how-to-view-certificates-with-the-mmc-snap-in.md).</span><span class="sxs-lookup"><span data-stu-id="b13c8-122">For more information, see [How to: View Certificates with the MMC Snap-in](how-to-view-certificates-with-the-mmc-snap-in.md).</span></span>

## <a name="certificate-stores"></a><span data-ttu-id="b13c8-123">Almacenes de certificados</span><span class="sxs-lookup"><span data-stu-id="b13c8-123">Certificate Stores</span></span>

<span data-ttu-id="b13c8-124">Los certificados se encuentran en almacenes.</span><span class="sxs-lookup"><span data-stu-id="b13c8-124">Certificates are found in stores.</span></span> <span data-ttu-id="b13c8-125">Existen dos ubicaciones de almacenamiento principales que se dividen en subalmacenes.</span><span class="sxs-lookup"><span data-stu-id="b13c8-125">Two major store locations exist that are further divided into sub-stores.</span></span> <span data-ttu-id="b13c8-126">Si es el administrador en un equipo, puede ver ambos almacenes principales utilizando la herramienta de complemento MMC.</span><span class="sxs-lookup"><span data-stu-id="b13c8-126">If you are the administrator on a computer, you can view both major stores by using the MMC snap-in tool.</span></span> <span data-ttu-id="b13c8-127">Los usuarios que no sean administradores solo pueden ver el almacén del usuario actual.</span><span class="sxs-lookup"><span data-stu-id="b13c8-127">Non-administrators can view only the current user store.</span></span>

- <span data-ttu-id="b13c8-128">**El almacén del equipo local**.</span><span class="sxs-lookup"><span data-stu-id="b13c8-128">**The local machine store**.</span></span> <span data-ttu-id="b13c8-129">Contiene los certificados a los que tienen acceso los procesos de la máquina, como ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b13c8-129">This contains the certificates accessed by machine processes, such as ASP.NET.</span></span> <span data-ttu-id="b13c8-130">Utilice esta ubicación para almacenar certificados que autentiquen el servidor a los clientes.</span><span class="sxs-lookup"><span data-stu-id="b13c8-130">Use this location to store certificates that authenticate the server to clients.</span></span>

- <span data-ttu-id="b13c8-131">**El almacén del usuario actual**.</span><span class="sxs-lookup"><span data-stu-id="b13c8-131">**The current user store**.</span></span> <span data-ttu-id="b13c8-132">Las aplicaciones interactivas colocan aquí, por lo general, certificados para el usuario actual del equipo.</span><span class="sxs-lookup"><span data-stu-id="b13c8-132">Interactive applications typically place certificates here for the computer's current user.</span></span> <span data-ttu-id="b13c8-133">Si está creando una aplicación cliente, es aquí donde normalmente colocará los certificados que autentiquen un usuario a un servicio.</span><span class="sxs-lookup"><span data-stu-id="b13c8-133">If you are creating a client application, this is where you typically place certificates that authenticate a user to a service.</span></span>

<span data-ttu-id="b13c8-134">Estos dos almacenes se dividen en subalmacenes.</span><span class="sxs-lookup"><span data-stu-id="b13c8-134">These two stores are further divided into sub-stores.</span></span> <span data-ttu-id="b13c8-135">Entre los más importantes de estos cuando se programa con WCF se incluyen:</span><span class="sxs-lookup"><span data-stu-id="b13c8-135">The most important of these when programming with WCF include:</span></span>

- <span data-ttu-id="b13c8-136">**Entidades de certificación raíz de confianza**.</span><span class="sxs-lookup"><span data-stu-id="b13c8-136">**Trusted Root Certification Authorities**.</span></span> <span data-ttu-id="b13c8-137">Puede usar los certificados en este almacén para crear una cadena de certificados, que se pueden trazar hacia atrás hasta un certificado de la entidad de certificación en este almacén.</span><span class="sxs-lookup"><span data-stu-id="b13c8-137">You can use the certificates in this store to create a chain of certificates, which can be traced back to a certification authority certificate in this store.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="b13c8-138">El equipo local confía implícitamente en cualquier certificado ubicado en este almacén, aún cuando el certificado no proceda de una entidad de certificación de otro fabricante de confianza.</span><span class="sxs-lookup"><span data-stu-id="b13c8-138">The local computer implicitly trusts any certificate placed in this store, even if the certificate does not come from a trusted third-party certification authority.</span></span> <span data-ttu-id="b13c8-139">Por esta razón, no coloque ningún certificado en este almacén a menos que confíe plenamente en el emisor y comprenda las consecuencias.</span><span class="sxs-lookup"><span data-stu-id="b13c8-139">For this reason, do not place any certificate into this store unless you fully trust the issuer and understand the consequences.</span></span>

- <span data-ttu-id="b13c8-140">**Personal**.</span><span class="sxs-lookup"><span data-stu-id="b13c8-140">**Personal**.</span></span> <span data-ttu-id="b13c8-141">Este almacén se utiliza para los certificados asociados a un usuario de un equipo.</span><span class="sxs-lookup"><span data-stu-id="b13c8-141">This store is used for certificates associated with a user of a computer.</span></span> <span data-ttu-id="b13c8-142">Normalmente este almacén se usa para los certificados emitidos por uno de los certificados de la entidad de certificación situado en el almacén de las Entidades emisoras de certificados raíz de confianza.</span><span class="sxs-lookup"><span data-stu-id="b13c8-142">Typically this store is used for certificates issued by one of the certification authority certificates found in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="b13c8-143">O bien, una aplicación puede confiar en un certificado que se encuentre aquí y que sea de emisión propia.</span><span class="sxs-lookup"><span data-stu-id="b13c8-143">Alternatively, a certificate found here may be self-issued and trusted by an application.</span></span>

<span data-ttu-id="b13c8-144">Para obtener más información sobre los almacenes de certificados, vea [Almacenes de certificados](/windows/desktop/secauthn/certificate-stores).</span><span class="sxs-lookup"><span data-stu-id="b13c8-144">For more information about certificate stores, see [Certificate Stores](/windows/desktop/secauthn/certificate-stores).</span></span>

### <a name="selecting-a-store"></a><span data-ttu-id="b13c8-145">Selección de un almacén</span><span class="sxs-lookup"><span data-stu-id="b13c8-145">Selecting a Store</span></span>

<span data-ttu-id="b13c8-146">Seleccionar dónde almacenar un certificado depende de cómo y cuándo se ejecute el cliente o el servicio.</span><span class="sxs-lookup"><span data-stu-id="b13c8-146">Selecting where to store a certificate depends how and when the service or client runs.</span></span> <span data-ttu-id="b13c8-147">Se aplican las siguientes reglas generales:</span><span class="sxs-lookup"><span data-stu-id="b13c8-147">The following general rules apply:</span></span>

- <span data-ttu-id="b13c8-148">Si el servicio WCF se hospeda en un servicio Windows, use el almacén del **equipo local**.</span><span class="sxs-lookup"><span data-stu-id="b13c8-148">If the WCF service is hosted in a Windows service use the **local machine** store.</span></span> <span data-ttu-id="b13c8-149">Observe que es necesario tener privilegios de administrador para instalar certificados en el almacén de la máquina local.</span><span class="sxs-lookup"><span data-stu-id="b13c8-149">Note that administrator privileges are required to install certificates into the local machine store.</span></span>

- <span data-ttu-id="b13c8-150">Si el servicio o cliente es una aplicación que se ejecuta bajo una cuenta de usuario, use el almacén del **usuario actual**.</span><span class="sxs-lookup"><span data-stu-id="b13c8-150">If the service or client is an application that runs under a user account, then use the **current user** store.</span></span>

### <a name="accessing-stores"></a><span data-ttu-id="b13c8-151">Obtención de acceso a almacenes</span><span class="sxs-lookup"><span data-stu-id="b13c8-151">Accessing Stores</span></span>

<span data-ttu-id="b13c8-152">Los almacenes son protegidos por las listas de control de acceso (ACL), como las carpetas de un equipo.</span><span class="sxs-lookup"><span data-stu-id="b13c8-152">Stores are protected by access control lists (ACLs), just like folders on a computer.</span></span> <span data-ttu-id="b13c8-153">Al crear un servicio hospedado por Internet Information Services (IIS), el proceso ASP.NET se ejecuta en la cuenta ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b13c8-153">When creating a service hosted by Internet Information Services (IIS), the ASP.NET process runs under the ASP.NET account.</span></span> <span data-ttu-id="b13c8-154">Esa cuenta debe tener acceso al almacén que contiene los certificados que utiliza un servicio.</span><span class="sxs-lookup"><span data-stu-id="b13c8-154">That account must have access to the store that contains the certificates a service uses.</span></span> <span data-ttu-id="b13c8-155">Cada uno de los almacenes principales se encuentra protegido mediante una lista de acceso predeterminada, pero se pueden modificar las listas.</span><span class="sxs-lookup"><span data-stu-id="b13c8-155">Each of the major stores is protected with a default access list, but the lists can be modified.</span></span> <span data-ttu-id="b13c8-156">Si crea un rol independiente para obtener acceso a un almacén, debe garantizar el permiso de acceso a ese rol.</span><span class="sxs-lookup"><span data-stu-id="b13c8-156">If you create a separate role to access a store, you must grant that role access permission.</span></span> <span data-ttu-id="b13c8-157">Para obtener información sobre cómo modificar la lista de acceso con la herramienta WinHttpCertConfig.exe, vea [Cómo: Crear certificados temporales que puedan utilizarse durante las operaciones de desarrollo](how-to-create-temporary-certificates-for-use-during-development.md).</span><span class="sxs-lookup"><span data-stu-id="b13c8-157">To learn how to modify the access list using the WinHttpCertConfig.exe tool, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="chain-trust-and-certificate-authorities"></a><span data-ttu-id="b13c8-158">Confianza de cadena y entidades de certificación</span><span class="sxs-lookup"><span data-stu-id="b13c8-158">Chain Trust and Certificate Authorities</span></span>

<span data-ttu-id="b13c8-159">Los certificados se crean en una jerarquía en la que cada certificado individual se vincula a la CA que emite el certificado.</span><span class="sxs-lookup"><span data-stu-id="b13c8-159">Certificates are created in a hierarchy where each individual certificate is linked to the CA that issued the certificate.</span></span> <span data-ttu-id="b13c8-160">Este vínculo va al certificado de la CA.</span><span class="sxs-lookup"><span data-stu-id="b13c8-160">This link is to the CA’s certificate.</span></span> <span data-ttu-id="b13c8-161">A continuación, el certificado de la CA se vincula a la CA que emitió el certificado de la CA original.</span><span class="sxs-lookup"><span data-stu-id="b13c8-161">The CA’s certificate then links to the CA that issued the original CA’s certificate.</span></span> <span data-ttu-id="b13c8-162">Este proceso se repite hasta que se llegue al certificado de la CA raíz.</span><span class="sxs-lookup"><span data-stu-id="b13c8-162">This process is repeated up until the Root CA’s certificate is reached.</span></span> <span data-ttu-id="b13c8-163">Se confía intrínsecamente en el certificado de la CA raíz.</span><span class="sxs-lookup"><span data-stu-id="b13c8-163">The Root CA’s certificate is inherently trusted.</span></span>

<span data-ttu-id="b13c8-164">Los certificados digitales se usan para autenticar una entidad confiando en esta jerarquía, que también se denomina *cadena de confianza*.</span><span class="sxs-lookup"><span data-stu-id="b13c8-164">Digital certificates are used to authenticate an entity by relying on this hierarchy, also called a *chain of trust*.</span></span> <span data-ttu-id="b13c8-165">Para ver la cadena de cualquier certificado mediante el complemento MMC, haga doble clic en cualquier certificado y, a continuación, haga clic en la pestaña **ruta de acceso del certificado** . Para obtener más información acerca de la importación de cadenas de certificados para una entidad de certificación, consulte [Cómo: especificar la cadena de certificados de la entidad de certificación utilizada para comprobar las firmas](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="b13c8-165">You can view any certificate's chain using the MMC snap-in by double-clicking any certificate, then clicking the **Certificate Path** tab. For more information about importing certificate chains for a Certification authority, see [How to: Specify the Certificate Authority Certificate Chain Used to Verify Signatures](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span></span>

> [!NOTE]
> <span data-ttu-id="b13c8-166">A cualquier emisor se le puede designar una entidad emisora raíz de confianza colocando el certificado del emisor en el almacén de certificados de la entidad emisora raíz de confianza.</span><span class="sxs-lookup"><span data-stu-id="b13c8-166">Any issuer can be designated a trusted root authority by placing the issuer's certificate in the trusted root authority certificate store.</span></span>

### <a name="disabling-chain-trust"></a><span data-ttu-id="b13c8-167">Deshabilitación de la confianza de cadena</span><span class="sxs-lookup"><span data-stu-id="b13c8-167">Disabling Chain Trust</span></span>

<span data-ttu-id="b13c8-168">Al crear un nuevo servicio, puede que esté utilizando un certificado que no ha emitido un certificado raíz de confianza, o puede que el propio certificado emisor no esté en el almacén Entidades de certificación raíz de confianza.</span><span class="sxs-lookup"><span data-stu-id="b13c8-168">When creating a new service, you may be using a certificate that is not issued by a trusted root certificate, or the issuing certificate itself may not be in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="b13c8-169">Solo con fines de desarrollo, puede deshabilitar temporalmente el mecanismo que comprueba la cadena de confianza de un certificado.</span><span class="sxs-lookup"><span data-stu-id="b13c8-169">For development purposes only, you can temporarily disable the mechanism that checks the chain of trust for a certificate.</span></span> <span data-ttu-id="b13c8-170">Para hacerlo, establezca la propiedad `CertificateValidationMode` en `PeerTrust` o `PeerOrChainTrust`.</span><span class="sxs-lookup"><span data-stu-id="b13c8-170">To do this, set the `CertificateValidationMode` property to either `PeerTrust` or `PeerOrChainTrust`.</span></span> <span data-ttu-id="b13c8-171">Ambos modos especifican que el certificado puede autoemitirse (confianza de mismo nivel) o formar parte de una cadena de confianza.</span><span class="sxs-lookup"><span data-stu-id="b13c8-171">Either mode specifies that the certificate can either be self-issued (peer trust) or part of a chain of trust.</span></span> <span data-ttu-id="b13c8-172">Puede establecer la propiedad en cualquiera de las clases siguientes.</span><span class="sxs-lookup"><span data-stu-id="b13c8-172">You can set the property on any of the following classes.</span></span>

|<span data-ttu-id="b13c8-173">Clase</span><span class="sxs-lookup"><span data-stu-id="b13c8-173">Class</span></span>|<span data-ttu-id="b13c8-174">Propiedad.</span><span class="sxs-lookup"><span data-stu-id="b13c8-174">Property</span></span>|
|-----------|--------------|
|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential>|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A?displayProperty=nameWithType>|

<span data-ttu-id="b13c8-175">También puede establecer la propiedad mediante configuración.</span><span class="sxs-lookup"><span data-stu-id="b13c8-175">You can also set the property using configuration.</span></span> <span data-ttu-id="b13c8-176">Los siguientes elementos se utilizan para especificar el modo de validación:</span><span class="sxs-lookup"><span data-stu-id="b13c8-176">The following elements are used to specify the validation mode:</span></span>

- [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md)

- [\<peerAuthentication>](../../configure-apps/file-schema/wcf/peerauthentication-element.md)

- [\<messageSenderAuthentication>](../../configure-apps/file-schema/wcf/messagesenderauthentication-element.md)

## <a name="custom-authentication"></a><span data-ttu-id="b13c8-177">Autenticación personalizada</span><span class="sxs-lookup"><span data-stu-id="b13c8-177">Custom Authentication</span></span>

<span data-ttu-id="b13c8-178">La propiedad `CertificateValidationMode` también le permite personalizar cómo se autentican los certificados.</span><span class="sxs-lookup"><span data-stu-id="b13c8-178">The `CertificateValidationMode` property also enables you to customize how certificates are authenticated.</span></span> <span data-ttu-id="b13c8-179">De manera predeterminada, el nivel se establece en `ChainTrust`.</span><span class="sxs-lookup"><span data-stu-id="b13c8-179">By default, the level is set to `ChainTrust`.</span></span> <span data-ttu-id="b13c8-180">Para utilizar el valor <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom>, también debe establecer el atributo `CustomCertificateValidatorType` en un ensamblado y tipo utilizado para validar el certificado.</span><span class="sxs-lookup"><span data-stu-id="b13c8-180">To use the <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> value, you must also set the `CustomCertificateValidatorType` attribute to an assembly and type used to validate the certificate.</span></span> <span data-ttu-id="b13c8-181">Para crear un validador personalizado, debe heredar a partir de la clase <xref:System.IdentityModel.Selectors.X509CertificateValidator> abstracta.</span><span class="sxs-lookup"><span data-stu-id="b13c8-181">To create a custom validator, you must inherit from the abstract <xref:System.IdentityModel.Selectors.X509CertificateValidator> class.</span></span>

<span data-ttu-id="b13c8-182">Al crear un autenticador personalizado, el método más importante para invalidar es el método <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A>.</span><span class="sxs-lookup"><span data-stu-id="b13c8-182">When creating a custom authenticator, the most important method to override is the <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A> method.</span></span> <span data-ttu-id="b13c8-183">Para obtener un ejemplo de autenticación personalizada, vea el ejemplo [Validador de certificado X.509](../samples/x-509-certificate-validator.md).</span><span class="sxs-lookup"><span data-stu-id="b13c8-183">For an example of custom authentication, see the [X.509 Certificate Validator](../samples/x-509-certificate-validator.md) sample.</span></span> <span data-ttu-id="b13c8-184">Para obtener más información, vea [Credencial personalizada y validación de la credencial](../extending/custom-credential-and-credential-validation.md).</span><span class="sxs-lookup"><span data-stu-id="b13c8-184">For more information, see [Custom Credential and Credential Validation](../extending/custom-credential-and-credential-validation.md).</span></span>

## <a name="using-the-powershell-new-selfsignedcertificate-cmdlet-to-build-a-certificate-chain"></a><span data-ttu-id="b13c8-185">Uso del cmdlet New-SelfSignedCertificate de PowerShell para crear una cadena de certificados</span><span class="sxs-lookup"><span data-stu-id="b13c8-185">Using the PowerShell New-SelfSignedCertificate Cmdlet to Build a Certificate Chain</span></span>

<span data-ttu-id="b13c8-186">El cmdlet New-SelfSignedCertificate de PowerShell crea certificados X. 509 y pares de clave privada y clave pública.</span><span class="sxs-lookup"><span data-stu-id="b13c8-186">The PowerShell New-SelfSignedCertificate cmdlet creates X.509 certificates and private key/public key pairs.</span></span> <span data-ttu-id="b13c8-187">Puede guardar la clave privada en el disco y, a continuación, usarla para emitir y firmar nuevos certificados, simulando así una jerarquía de certificados encadenados.</span><span class="sxs-lookup"><span data-stu-id="b13c8-187">You can save the private key to disk and then use it to issue and sign new certificates, thus simulating a hierarchy of chained certificates.</span></span> <span data-ttu-id="b13c8-188">El cmdlet está diseñado para usarse solo como ayuda al desarrollar servicios y nunca se debe usar para crear certificados para la implementación real.</span><span class="sxs-lookup"><span data-stu-id="b13c8-188">The cmdlet is intended for use only as an aid when developing services and should never be used to create certificates for actual deployment.</span></span> <span data-ttu-id="b13c8-189">Al desarrollar un servicio WCF, use los pasos siguientes para crear una cadena de confianza con el cmdlet New-SelfSignedCertificate.</span><span class="sxs-lookup"><span data-stu-id="b13c8-189">When developing a WCF service, use the following steps to build a chain of trust with the New-SelfSignedCertificate cmdlet.</span></span>

#### <a name="to-build-a-chain-of-trust-with-the-new-selfsignedcertificate-cmdlet"></a><span data-ttu-id="b13c8-190">Para compilar una cadena de confianza con el cmdlet New-SelfSignedCertificate</span><span class="sxs-lookup"><span data-stu-id="b13c8-190">To build a chain of trust with the New-SelfSignedCertificate cmdlet</span></span>

1. <span data-ttu-id="b13c8-191">Cree un certificado de entidad de certificación raíz (autofirmado) temporal con el cmdlet New-SelfSignedCertificate.</span><span class="sxs-lookup"><span data-stu-id="b13c8-191">Create a temporary root authority (self-signed) certificate using the New-SelfSignedCertificate cmdlet.</span></span> <span data-ttu-id="b13c8-192">Guarde la clave privada en el disco.</span><span class="sxs-lookup"><span data-stu-id="b13c8-192">Save the private key to the disk.</span></span>

2. <span data-ttu-id="b13c8-193">Utilice el nuevo certificado para emitir otro certificado que contenga la clave pública.</span><span class="sxs-lookup"><span data-stu-id="b13c8-193">Use the new certificate to issue another certificate that contains the public key.</span></span>

3. <span data-ttu-id="b13c8-194">Importe el certificado de la entidad emisora raíz en el almacén Entidades emisoras de certificados raíz de confianza.</span><span class="sxs-lookup"><span data-stu-id="b13c8-194">Import the root authority certificate into the Trusted Root Certification Authorities store.</span></span>

4. <span data-ttu-id="b13c8-195">Para obtener instrucciones paso a paso, vea [Cómo: Crear certificados temporales que puedan utilizarse durante las operaciones de desarrollo](how-to-create-temporary-certificates-for-use-during-development.md).</span><span class="sxs-lookup"><span data-stu-id="b13c8-195">For step-by-step instructions, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="which-certificate-to-use"></a><span data-ttu-id="b13c8-196">¿Qué certificado utilizar?</span><span class="sxs-lookup"><span data-stu-id="b13c8-196">Which Certificate to Use?</span></span>

<span data-ttu-id="b13c8-197">Las preguntas más comunes sobre certificados son qué certificados utilizar y por qué.</span><span class="sxs-lookup"><span data-stu-id="b13c8-197">Common questions about certificates are which certificate to use, and why.</span></span> <span data-ttu-id="b13c8-198">La respuesta depende de si está programando un cliente o servicio.</span><span class="sxs-lookup"><span data-stu-id="b13c8-198">The answer depends on whether you are programming a client or service.</span></span> <span data-ttu-id="b13c8-199">La siguiente información proporciona una directriz general y no es una respuesta exhaustiva a estas preguntas.</span><span class="sxs-lookup"><span data-stu-id="b13c8-199">The following information provides a general guideline and is not an exhaustive answer to these questions.</span></span>

### <a name="service-certificates"></a><span data-ttu-id="b13c8-200">Certificados de servicio</span><span class="sxs-lookup"><span data-stu-id="b13c8-200">Service Certificates</span></span>

<span data-ttu-id="b13c8-201">Los certificados de servicio tienen la tarea principal de autenticar el servidor a los clientes.</span><span class="sxs-lookup"><span data-stu-id="b13c8-201">Service certificates have the primary task of authenticating the server to clients.</span></span> <span data-ttu-id="b13c8-202">Una de las comprobaciones iniciales cuando un cliente autentica un servidor es comparar el valor del campo **Asunto** con el Identificador uniforme de recursos (URI) que se usa para ponerse en contacto con el servicio: el DNS de ambos debe coincidir.</span><span class="sxs-lookup"><span data-stu-id="b13c8-202">One of the initial checks when a client authenticates a server is to compare the value of the **Subject** field to the Uniform Resource Identifier (URI) used to contact the service: the DNS of both must match.</span></span> <span data-ttu-id="b13c8-203">Por ejemplo, si el URI del servicio es `http://www.contoso.com/endpoint/` , el campo **asunto** también debe contener el valor `www.contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="b13c8-203">For example, if the URI of the service is `http://www.contoso.com/endpoint/` then the **Subject** field must also contain the value `www.contoso.com`.</span></span>

<span data-ttu-id="b13c8-204">Observe que el campo puede contener varios valores, cada uno prefijado con una inicialización que indique el valor.</span><span class="sxs-lookup"><span data-stu-id="b13c8-204">Note that the field can contain several values, each prefixed with an initialization to indicate the value.</span></span> <span data-ttu-id="b13c8-205">Normalmente, la inicialización es "CN" para el nombre común, por ejemplo, `CN = www.contoso.com` .</span><span class="sxs-lookup"><span data-stu-id="b13c8-205">Most commonly, the initialization is "CN" for common name, for example, `CN = www.contoso.com`.</span></span> <span data-ttu-id="b13c8-206">También es posible que el campo **Asunto** esté en blanco, en cuyo caso el campo **Nombre alternativo del firmante** puede contener el valor **Nombre DNS**.</span><span class="sxs-lookup"><span data-stu-id="b13c8-206">It is also possible for the **Subject** field to be blank, in which case the **Subject Alternative Name** field can contain the **DNS Name** value.</span></span>

<span data-ttu-id="b13c8-207">También tenga en cuenta que el valor del campo **Propósitos planteados** del certificado debería incluir un valor adecuado, como "Autenticación del Servidor" o "Autenticación del cliente".</span><span class="sxs-lookup"><span data-stu-id="b13c8-207">Also note the value of the **Intended Purposes** field of the certificate should include an appropriate value, such as "Server Authentication" or "Client Authentication".</span></span>

### <a name="client-certificates"></a><span data-ttu-id="b13c8-208">Certificados de cliente</span><span class="sxs-lookup"><span data-stu-id="b13c8-208">Client Certificates</span></span>

<span data-ttu-id="b13c8-209">Los certificados de cliente no son emitidos, por regla general, por una autoridad de certificación de otro fabricante.</span><span class="sxs-lookup"><span data-stu-id="b13c8-209">Client certificates are not typically issued by a third-party certification authority.</span></span> <span data-ttu-id="b13c8-210">En su lugar, el almacén Personal de la ubicación del usuario actual contiene normalmente certificados colocados ahí por una entidad emisora raíz, con un propósito planteado de "Autenticación de cliente."</span><span class="sxs-lookup"><span data-stu-id="b13c8-210">Instead, the Personal store of the current user location typically contains certificates placed there by a root authority, with an intended purpose of "Client Authentication".</span></span> <span data-ttu-id="b13c8-211">El cliente puede usar este tipo de certificado cuando se requiere autenticación mutua.</span><span class="sxs-lookup"><span data-stu-id="b13c8-211">The client can use such a certificate when mutual authentication is required.</span></span>

## <a name="online-revocation-and-offline-revocation"></a><span data-ttu-id="b13c8-212">Revocación en línea y sin conexión</span><span class="sxs-lookup"><span data-stu-id="b13c8-212">Online Revocation and Offline Revocation</span></span>

### <a name="certificate-validity"></a><span data-ttu-id="b13c8-213">Validez del certificado</span><span class="sxs-lookup"><span data-stu-id="b13c8-213">Certificate Validity</span></span>

<span data-ttu-id="b13c8-214">Cada certificado es válido solo durante un período determinado de tiempo, llamado *período de validez*.</span><span class="sxs-lookup"><span data-stu-id="b13c8-214">Every certificate is valid only for a given period of time, called the *validity period*.</span></span> <span data-ttu-id="b13c8-215">Los campos **Válido desde** y **Válido hasta** de un certificado X.509 definen el período de validez.</span><span class="sxs-lookup"><span data-stu-id="b13c8-215">The validity period is defined by the **Valid from** and **Valid to** fields of an X.509 certificate.</span></span> <span data-ttu-id="b13c8-216">Durante la autenticación, el certificado se comprueba para determinar si el certificado todavía está dentro del período de validez.</span><span class="sxs-lookup"><span data-stu-id="b13c8-216">During authentication, the certificate is checked to determine whether the certificate is still within the validity period.</span></span>

### <a name="certificate-revocation-list"></a><span data-ttu-id="b13c8-217">Lista de revocación de certificados</span><span class="sxs-lookup"><span data-stu-id="b13c8-217">Certificate Revocation List</span></span>

<span data-ttu-id="b13c8-218">En cualquier momento, durante el período de validez, la entidad de certificación puede revocar un certificado.</span><span class="sxs-lookup"><span data-stu-id="b13c8-218">At any time during the validity period, the certification authority can revoke a certificate.</span></span> <span data-ttu-id="b13c8-219">Esto puede producirse por muchas razones, como que la clave privada del certificado esté en peligro.</span><span class="sxs-lookup"><span data-stu-id="b13c8-219">This can occur for many reasons, such as a compromise of the private key of the certificate.</span></span>

<span data-ttu-id="b13c8-220">Cuando esto sucede, cualquier cadena que descienda del certificado revocado dejará también de ser válida y no se confiará en ella durante los procedimientos de autenticación.</span><span class="sxs-lookup"><span data-stu-id="b13c8-220">When this occurs, any chains that descend from the revoked certificate are also invalid, and are not trusted during authentication procedures.</span></span> <span data-ttu-id="b13c8-221">Para averiguar qué certificados se revocan, cada emisor publica una *lista de certificados revocados* (CRL) con marca de fecha y hora.</span><span class="sxs-lookup"><span data-stu-id="b13c8-221">To find out which certificates are revoked, each issuer publishes a time- and date-stamped *certificate revocation list* (CRL).</span></span> <span data-ttu-id="b13c8-222">La lista se puede comprobar utilizando revocación en línea o sin conexión estableciendo la propiedad `RevocationMode` o `DefaultRevocationMode` de las siguientes clases en uno de los valores de enumeración <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> : <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>, <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>, y las clases <xref:System.ServiceModel.Security.IssuedTokenServiceCredential>.</span><span class="sxs-lookup"><span data-stu-id="b13c8-222">The list can be checked using either online revocation or offline revocation by setting the `RevocationMode` or `DefaultRevocationMode` property of the following classes to one of the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration values: <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>, <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>, and the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> classes.</span></span> <span data-ttu-id="b13c8-223">El valor predeterminado para todas las propiedades es `Online`.</span><span class="sxs-lookup"><span data-stu-id="b13c8-223">The default value for all properties is `Online`.</span></span>

<span data-ttu-id="b13c8-224">También puede establecer el modo en la configuración mediante el `revocationMode` atributo de [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (de [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) ) y de [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (de [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) ).</span><span class="sxs-lookup"><span data-stu-id="b13c8-224">You can also set the mode in configuration using the `revocationMode` attribute of both the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md)) and the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md)).</span></span>

## <a name="the-setcertificate-method"></a><span data-ttu-id="b13c8-225">El método SetCertificate</span><span class="sxs-lookup"><span data-stu-id="b13c8-225">The SetCertificate Method</span></span>

<span data-ttu-id="b13c8-226">En WCF, a menudo se debe especificar un certificado o conjunto de certificados que un servicio o cliente va a usar para autenticar, cifrar o firmar digitalmente un mensaje.</span><span class="sxs-lookup"><span data-stu-id="b13c8-226">In WCF, you must often specify a certificate or set of certificates a service or client is to use to authenticate, encrypt, or digitally sign a message.</span></span> <span data-ttu-id="b13c8-227">Puede hacer esto mediante programación utilizando el método `SetCertificate` de varias clases que representan certificados X.509.</span><span class="sxs-lookup"><span data-stu-id="b13c8-227">You can do this programmatically by using the `SetCertificate` method of various classes that represent X.509 certificates.</span></span> <span data-ttu-id="b13c8-228">Las siguientes clases utilizan el método `SetCertificate` para especificar un certificado.</span><span class="sxs-lookup"><span data-stu-id="b13c8-228">The following classes use the `SetCertificate` method to specify a certificate.</span></span>

|<span data-ttu-id="b13c8-229">Clase</span><span class="sxs-lookup"><span data-stu-id="b13c8-229">Class</span></span>|<span data-ttu-id="b13c8-230">Método</span><span class="sxs-lookup"><span data-stu-id="b13c8-230">Method</span></span>|
|-----------|------------|
|<xref:System.ServiceModel.Security.PeerCredential>|<xref:System.ServiceModel.Security.PeerCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential>|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential>|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A>|

<span data-ttu-id="b13c8-231">El método `SetCertificate` funciona designando una ubicación del almacén y almacén, un tipo de "búsqueda” (parámetro`x509FindType`) que especifica un campo del certificado, y un valor para encontrar en el campo.</span><span class="sxs-lookup"><span data-stu-id="b13c8-231">The `SetCertificate` method works by designating a store location and store, a "find" type (`x509FindType` parameter) that specifies a field of the certificate, and a value to find in the field.</span></span> <span data-ttu-id="b13c8-232">Por ejemplo, en el código siguiente se crea una instancia de <xref:System.ServiceModel.ServiceHost> y se establece el certificado de servicio que se usa para autenticar el servicio a los clientes con el método `SetCertificate`.</span><span class="sxs-lookup"><span data-stu-id="b13c8-232">For example, the following code creates a <xref:System.ServiceModel.ServiceHost> instance and sets the service certificate used to authenticate the service to clients with the `SetCertificate` method.</span></span>

[!code-csharp[c_WorkingWithCertificates#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_workingwithcertificates/cs/source.cs#1)]
[!code-vb[c_WorkingWithCertificates#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_workingwithcertificates/vb/source.vb#1)]

### <a name="multiple-certificates-with-the-same-value"></a><span data-ttu-id="b13c8-233">Varios certificados con el mismo valor</span><span class="sxs-lookup"><span data-stu-id="b13c8-233">Multiple Certificates with the Same Value</span></span>

<span data-ttu-id="b13c8-234">Un almacén puede contener varios certificados con el mismo nombre de asunto.</span><span class="sxs-lookup"><span data-stu-id="b13c8-234">A store may contain multiple certificates with the same subject name.</span></span> <span data-ttu-id="b13c8-235">Esto significa que si se especifica que `x509FindType` es <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> o <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>, y hay más de un certificado con el mismo valor, se inicia una excepción porque no hay manera de distinguir cuál es el certificado necesario.</span><span class="sxs-lookup"><span data-stu-id="b13c8-235">This means that if you specify that the `x509FindType` is <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> or <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>, and more than one certificate has the same value, an exception is thrown because there is no way to distinguish which certificate is required.</span></span> <span data-ttu-id="b13c8-236">Puede mitigar esto estableciendo el `x509FindType` en <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>.</span><span class="sxs-lookup"><span data-stu-id="b13c8-236">You can mitigate this by setting the `x509FindType` to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>.</span></span> <span data-ttu-id="b13c8-237">El campo de huella digital contiene un valor único que se puede utilizar para encontrar un certificado concreto en un almacén.</span><span class="sxs-lookup"><span data-stu-id="b13c8-237">The thumbprint field contains a unique value that can be used to find a specific certificate in a store.</span></span> <span data-ttu-id="b13c8-238">Sin embargo, este tiene su propia desventaja: si el certificado se revoca o renueva, el método `SetCertificate` falla porque también se ha ido la huella digital.</span><span class="sxs-lookup"><span data-stu-id="b13c8-238">However, this has its own disadvantage: if the certificate is revoked or renewed, the `SetCertificate` method fails because the thumbprint is also gone.</span></span> <span data-ttu-id="b13c8-239">O, si el certificado ya no es válido, se produce un error de autenticación.</span><span class="sxs-lookup"><span data-stu-id="b13c8-239">Or, if the certificate is no longer valid, authentication fails.</span></span> <span data-ttu-id="b13c8-240">Para mitigar esto se ha de establecer el parámetro `x590FindType` en <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> y especificar el nombre del emisor.</span><span class="sxs-lookup"><span data-stu-id="b13c8-240">The way to mitigate this is to set the `x590FindType` parameter to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> and specify the issuer's name.</span></span> <span data-ttu-id="b13c8-241">Si no se requiere ningún emisor determinado, también puede establecer uno de los otros valores de enumeración<xref:System.Security.Cryptography.X509Certificates.X509FindType>, como <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>.</span><span class="sxs-lookup"><span data-stu-id="b13c8-241">If no particular issuer is required, you can also set one of the other <xref:System.Security.Cryptography.X509Certificates.X509FindType> enumeration values, such as <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>.</span></span>

## <a name="certificates-in-configuration"></a><span data-ttu-id="b13c8-242">Certificados en configuración</span><span class="sxs-lookup"><span data-stu-id="b13c8-242">Certificates in Configuration</span></span>

<span data-ttu-id="b13c8-243">También puede establecer certificados mediante configuración.</span><span class="sxs-lookup"><span data-stu-id="b13c8-243">You can also set certificates by using configuration.</span></span> <span data-ttu-id="b13c8-244">Si va a crear un servicio, las credenciales, incluidos los certificados, se especifican en [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="b13c8-244">If you are creating a service, credentials, including certificates, are specified under the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md).</span></span> <span data-ttu-id="b13c8-245">Al programar un cliente, los certificados se especifican en [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="b13c8-245">When you are programming a client, certificates are specified under the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md).</span></span>

## <a name="mapping-a-certificate-to-a-user-account"></a><span data-ttu-id="b13c8-246">Asignación de un certificado a una cuenta de usuario</span><span class="sxs-lookup"><span data-stu-id="b13c8-246">Mapping a Certificate to a User Account</span></span>

<span data-ttu-id="b13c8-247">Una característica de IIS y de Active Directory es la capacidad de asignar un certificado a una cuenta de usuario de Windows.</span><span class="sxs-lookup"><span data-stu-id="b13c8-247">A feature of IIS and Active Directory is the ability to map a certificate to a Windows user account.</span></span> <span data-ttu-id="b13c8-248">Para obtener más información sobre la característica, vea [Map certificates to user accounts](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)) (Asignar certificados a cuentas de usuario).</span><span class="sxs-lookup"><span data-stu-id="b13c8-248">For more information about the feature, see [Map certificates to user accounts](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)).</span></span>

<span data-ttu-id="b13c8-249">Para obtener más información sobre el uso de la asignación de Active Directory, vea [Mapping Client Certificates with Directory Service Mapping](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)) (Asignación de certificados de cliente mediante la asignación del servicio de directorio).</span><span class="sxs-lookup"><span data-stu-id="b13c8-249">For more information about using Active Directory mapping, see [Mapping Client Certificates with Directory Service Mapping](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)).</span></span>

<span data-ttu-id="b13c8-250">Con esta capacidad habilitada, puede definir la propiedad <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> de la clase <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> en `true`.</span><span class="sxs-lookup"><span data-stu-id="b13c8-250">With this capability enabled, you can set the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> property of the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> class to `true`.</span></span> <span data-ttu-id="b13c8-251">En configuración, puede establecer el `mapClientCertificateToWindowsAccount` atributo del [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) elemento en `true` , tal como se muestra en el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="b13c8-251">In configuration, you can set the `mapClientCertificateToWindowsAccount` attribute of the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) element to `true`, as shown in the following code.</span></span>

```xml
<serviceBehaviors>
 <behavior name="MappingBehavior">
  <serviceCredentials>
   <clientCertificate>
    <authentication certificateValidationMode="None" mapClientCertificateToWindowsAccount="true" />
   </clientCertificate>
  </serviceCredentials>
 </behavior>
</serviceBehaviors>
```

<span data-ttu-id="b13c8-252">Asignar un certificado X.509 al token que representa una cuenta de usuario de Windows está considerado como un aumento de los privilegios, porque, una vez asignado, el token de Windows se puede utilizar para obtener acceso a recursos protegidos.</span><span class="sxs-lookup"><span data-stu-id="b13c8-252">Mapping an X.509 certificate to the token that represents a Windows user account is considered an elevation of privilege because, once mapped, the Windows token can be used to gain access to protected resources.</span></span> <span data-ttu-id="b13c8-253">Por consiguiente, la directiva de dominio requiere que el certificado X.509 cumpla con su directiva antes de realizar la asignación.</span><span class="sxs-lookup"><span data-stu-id="b13c8-253">Therefore, domain policy requires the X.509 certificate to comply with its policy prior to mapping.</span></span> <span data-ttu-id="b13c8-254">El paquete de seguridad *SChannel* hace cumplir este requisito.</span><span class="sxs-lookup"><span data-stu-id="b13c8-254">The *SChannel* security package enforces this requirement.</span></span>

<span data-ttu-id="b13c8-255">Cuando se usa .NET Framework 3,5 o versiones posteriores, WCF garantiza que el certificado se ajusta a la Directiva de dominio antes de que se asigne a una cuenta de Windows.</span><span class="sxs-lookup"><span data-stu-id="b13c8-255">When using .NET Framework 3.5 or later versions, WCF ensures the certificate conforms to domain policy before it is mapped to a Windows account.</span></span>

<span data-ttu-id="b13c8-256">En la primera versión de WCF, la asignación se realiza sin consultar la directiva de dominio.</span><span class="sxs-lookup"><span data-stu-id="b13c8-256">In the first release of WCF, mapping is done without consulting the domain policy.</span></span> <span data-ttu-id="b13c8-257">Por consiguiente, es posible que las aplicaciones anteriores que solían funcionar al ejecutarse bajo la primera publicación, provoquen un error si se habilita la asignación y el certificado X.509 no cumple la directiva de dominio.</span><span class="sxs-lookup"><span data-stu-id="b13c8-257">Therefore it is possible that older applications that used to work when running under the first release, fails if the mapping is enabled and the X.509 certificate does not satisfy the domain policy.</span></span>

## <a name="see-also"></a><span data-ttu-id="b13c8-258">Vea también</span><span class="sxs-lookup"><span data-stu-id="b13c8-258">See also</span></span>

- <xref:System.ServiceModel.Channels>
- <xref:System.ServiceModel.Security>
- <xref:System.ServiceModel>
- <xref:System.Security.Cryptography.X509Certificates.X509FindType>
- [<span data-ttu-id="b13c8-259">Protección de servicios y clientes</span><span class="sxs-lookup"><span data-stu-id="b13c8-259">Securing Services and Clients</span></span>](securing-services-and-clients.md)
