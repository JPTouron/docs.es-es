---
title: Control de errores
ms.date: 03/30/2017
ms.assetid: c948841a-7db9-40ae-9b78-587d216cbcaf
ms.openlocfilehash: 9c7d6814a6bf1189fd85de5eb440ec4a6840447e
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/15/2020
ms.locfileid: "90539988"
---
# <a name="error-handling-in-windows-communication-foundation-wcf"></a><span data-ttu-id="2228b-102">Control de errores en Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="2228b-102">Error handling in Windows Communication Foundation (WCF)</span></span>

<span data-ttu-id="2228b-103">Cuando un servicio detecta una excepción o error inesperados, hay varias maneras de diseñar una solución desde el control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="2228b-103">When a service encounters an unexpected exception or error, there are multiple ways to design an exception-handling solution.</span></span> <span data-ttu-id="2228b-104">Aunque no hay una única solución de control de errores "correcta" o "procedimiento recomendado", hay varias rutas de acceso válidas que se deben tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="2228b-104">While there is no single "correct" or "best practice" error-handling solution, there are multiple valid paths for one to consider.</span></span> <span data-ttu-id="2228b-105">Normalmente se recomienda implementar una solución híbrida que combine varios enfoques de la lista siguiente, en función de la complejidad de la implementación de WCF, el tipo y la frecuencia de las excepciones, la naturaleza administrada frente a no controlada de las excepciones y cualquier seguimiento, registro o requisito de directiva asociado.</span><span class="sxs-lookup"><span data-stu-id="2228b-105">It is normally recommended that one implement a hybrid solution that combines multiple approaches from the list below, depending on the complexity of the WCF implementation, the type and frequency of the exceptions, the handled vs. unhandled nature of the exceptions, and any associated tracing, logging, or policy requirements.</span></span>

<span data-ttu-id="2228b-106">Estas soluciones se explican en más profundidad en el resto de esta sección.</span><span class="sxs-lookup"><span data-stu-id="2228b-106">These solutions are explained more deeply in the rest of this section.</span></span>

## <a name="the-microsoft-enterprise-library"></a><span data-ttu-id="2228b-107">Biblioteca de Microsoft Enterprise</span><span class="sxs-lookup"><span data-stu-id="2228b-107">The Microsoft Enterprise Library</span></span>

<span data-ttu-id="2228b-108">El bloque de la aplicación de control de excepciones de la biblioteca de empresas de Microsoft ayuda a implementar patrones comunes de diseño y a crear una estrategia coherente para procesar las excepciones que aparecen en todos los niveles arquitectónicos de una aplicación empresarial.</span><span class="sxs-lookup"><span data-stu-id="2228b-108">The Microsoft Enterprise Library Exception Handling Application Block helps implement common design patterns and create a consistent strategy for processing exceptions that occur in all architectural layers of an enterprise application.</span></span> <span data-ttu-id="2228b-109">Está diseñado para admitir el código estándar contenido en instrucciones CATCH en componentes de aplicación.</span><span class="sxs-lookup"><span data-stu-id="2228b-109">It is designed to support the typical code contained in catch statements in application components.</span></span> <span data-ttu-id="2228b-110">En lugar de repetir este código (como código que registra la información de excepción) en bloques catch idénticos en una aplicación, el bloque de la aplicación de control de excepciones permite a los desarrolladores encapsulen esta lógica como controlador de excepciones reutilizables.</span><span class="sxs-lookup"><span data-stu-id="2228b-110">Instead of repeating this code (such as code that logs exception information) in identical catch blocks throughout an application, the Exception Handling Application Block allows developers to encapsulate this logic as reusable exception handlers.</span></span>

<span data-ttu-id="2228b-111">Esta biblioteca incluye un controlador de excepciones de contrato de error predefinido.</span><span class="sxs-lookup"><span data-stu-id="2228b-111">This Library includes out-of-the-box a Fault Contract Exception Handler.</span></span> <span data-ttu-id="2228b-112">Este controlador de excepciones está diseñado para su uso en los límites del servicio WCF y genera un nuevo contrato de error a partir de la excepción.</span><span class="sxs-lookup"><span data-stu-id="2228b-112">This exception handler is designed for use at WCF service boundaries, and generates a new Fault Contract from the exception.</span></span>

<span data-ttu-id="2228b-113">Los bloques de aplicación tienen por objeto escribir prácticas recomendadas y proporcionar un enfoque común para el control de excepciones en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2228b-113">Application blocks aim to incorporate commonly used best practices and provide a common approach for exception handling throughout your application.</span></span> <span data-ttu-id="2228b-114">Además, los controladores de errores personalizados y los contratos de error desarrollados por uno mismo pueden resultar muy útiles.</span><span class="sxs-lookup"><span data-stu-id="2228b-114">On the other hand, custom error handlers and fault contracts developed on one’s own can also be very useful.</span></span> <span data-ttu-id="2228b-115">Por ejemplo, controladores de errores personalizados proporcionan una oportunidad excelente de promover automáticamente todas las excepciones a FaultExceptions y también para agregar capacidades de inicio de sesión a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="2228b-115">For instance, custom error handlers provide an excellent opportunity to automatically promote all exceptions to FaultExceptions and also to add logging capabilities to your application.</span></span>

<span data-ttu-id="2228b-116">Para obtener más información, consulte [Microsoft Enterprise Library](/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="2228b-116">For more information, please see [Microsoft Enterprise Library](/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span></span>

## <a name="dealing-with-expected-exceptions"></a><span data-ttu-id="2228b-117">Tratar las excepciones esperadas</span><span class="sxs-lookup"><span data-stu-id="2228b-117">Dealing with expected exceptions</span></span>

<span data-ttu-id="2228b-118">El curso de acción adecuado es detectar las excepciones esperadas en cada operación o punto de extensibilidad relevante, decidir si se pueden recuperar y devolver el error personalizado adecuado en un FaultException \<T> .</span><span class="sxs-lookup"><span data-stu-id="2228b-118">The proper course of action is to catch expected exceptions in every operation or relevant extensibility point, decide whether they can be recovered from, and return the proper custom fault in a FaultException\<T>.</span></span>
  
## <a name="dealing-with-unexpected-exceptions-using-an-ierrorhandler"></a><span data-ttu-id="2228b-119">Tratar las excepciones inesperadas mediante un IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="2228b-119">Dealing with unexpected exceptions using an IErrorHandler</span></span>

<span data-ttu-id="2228b-120">Para tratar las excepciones inesperadas, el curso de acción recomendado es "enlazar" un IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="2228b-120">To deal with unexpected exceptions, the recommended course of action is to "hook" an IErrorHandler.</span></span> <span data-ttu-id="2228b-121">Los controladores de error solo detectan excepciones en el nivel de tiempo de ejecución de WCF (el nivel de "modelo de servicio"), no en el nivel de canal.</span><span class="sxs-lookup"><span data-stu-id="2228b-121">Error handlers only catch exceptions at the WCF runtime level (the "service model" layer), not at the channel layer.</span></span> <span data-ttu-id="2228b-122">La única forma de enlazar un IErrorHandler en el nivel de canal es crear un canal personalizado, que no se recomienda en la mayoría de los escenarios.</span><span class="sxs-lookup"><span data-stu-id="2228b-122">The only way to hook an IErrorHandler at the channel level is to create a custom channel, which is not recommended in most scenarios.</span></span>

<span data-ttu-id="2228b-123">Una "excepción inesperada" no suele ser una excepción irrecuperable ni una excepción de procesamiento; en su lugar, se trata de una excepción de usuario inesperada.</span><span class="sxs-lookup"><span data-stu-id="2228b-123">An "unexpected exception" is generally neither an irrecoverable exception nor a processing exception; it is, instead, an unexpected user exception.</span></span> <span data-ttu-id="2228b-124">Una excepción irrecuperable (como una excepción de memoria insuficiente), que normalmente la controla el controlador de [excepciones del modelo de servicio](xref:System.ServiceModel.Dispatcher.ExceptionHandler) , no se puede controlar de forma automática y la única razón para controlar este tipo de excepción puede ser el registro adicional o devolver una excepción estándar al cliente.</span><span class="sxs-lookup"><span data-stu-id="2228b-124">An irrecoverable exception (such as an out-of-memory exception) – one generally handled by the [Service Model Exception Handler](xref:System.ServiceModel.Dispatcher.ExceptionHandler) automatically – cannot generally be handled gracefully, and the only reason to handle such an exception at all may be do additional logging or to return a standard exception to the client.</span></span> <span data-ttu-id="2228b-125">Aparece una excepción de procesamiento en el procesamiento de mensajes, (por ejemplo, en la serialización, el codificador o el nivel formateador, normalmente no se pueden controlar en un IErrorHandler, pues suele ser demasiado antiguo o demasiado atrasado para que intervenga el controlador de errores en el momento en que estas excepciones aparecen.</span><span class="sxs-lookup"><span data-stu-id="2228b-125">A processing exception occurs in the processing of the message – for example, at the serialization, encoder, or formatter level – generally cannot be handled at an IErrorHandler, because it is generally either too early or too late for the error handler to intervene by the time these exceptions occur.</span></span> <span data-ttu-id="2228b-126">De forma similar, las excepciones de transporte no se pueden controlar en un IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="2228b-126">Similarly, transport exceptions cannot be handled at an IErrorHandler.</span></span>

<span data-ttu-id="2228b-127">Con un IErrorHandler, puede controlar explícitamente el comportamiento de la aplicación cuando se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="2228b-127">With an IErrorHandler, you can explicitly control the behavior of your application when an exception is thrown.</span></span> <span data-ttu-id="2228b-128">Puede hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="2228b-128">You may:</span></span>  

1. <span data-ttu-id="2228b-129">Decida si desea enviar o no un error al cliente.</span><span class="sxs-lookup"><span data-stu-id="2228b-129">Decide whether or not to send a fault to the client.</span></span>

2. <span data-ttu-id="2228b-130">Reemplace una excepción con un error.</span><span class="sxs-lookup"><span data-stu-id="2228b-130">Replace an exception with a fault.</span></span>

3. <span data-ttu-id="2228b-131">Reemplace un error por otro error.</span><span class="sxs-lookup"><span data-stu-id="2228b-131">Replace a fault with another fault.</span></span>

4. <span data-ttu-id="2228b-132">Realizar el registro o el seguimiento.</span><span class="sxs-lookup"><span data-stu-id="2228b-132">Perform logging or tracing.</span></span>

5. <span data-ttu-id="2228b-133">Realizar otras actividades personalizadas.</span><span class="sxs-lookup"><span data-stu-id="2228b-133">Perform other custom activities.</span></span>

<span data-ttu-id="2228b-134">Se puede instalar en un controlador de errores personalizado agregándolo a la propiedad ErrorHandlers de distribuidores de canal para el servicio.</span><span class="sxs-lookup"><span data-stu-id="2228b-134">One can install a custom error handler by adding it to the ErrorHandlers property of the channel dispatchers for your service.</span></span>  <span data-ttu-id="2228b-135">Es posible tener varias llamadas a un controlador de errores y se les llama en el orden en que se agregan a esta colección.</span><span class="sxs-lookup"><span data-stu-id="2228b-135">It is possible to have more than one error handler and they are called in the order they are added to this collection.</span></span>

<span data-ttu-id="2228b-136">IErrorHandler.ProvideFault controla el mensaje de error que se envía al cliente.</span><span class="sxs-lookup"><span data-stu-id="2228b-136">IErrorHandler.ProvideFault controls the fault message that is sent to the client.</span></span> <span data-ttu-id="2228b-137">Se llama a este método independientemente del tipo de excepción iniciado por una operación del servicio.</span><span class="sxs-lookup"><span data-stu-id="2228b-137">This method is called regardless of the type of the exception thrown by an operation in your service.</span></span> <span data-ttu-id="2228b-138">Si no se realiza ninguna operación aquí, WCF asume su comportamiento predeterminado y continúa como si no hubiera ningún controlador de errores personalizado en su lugar.</span><span class="sxs-lookup"><span data-stu-id="2228b-138">If no operation is performed here, WCF assumes its default behavior and continues as if there were no custom error handlers in place.</span></span>

<span data-ttu-id="2228b-139">Un área que podría quizás usar este enfoque es cuando se desea crear un sitio central para convertir las excepciones en errores antes de enviarlos al cliente (asegurando que la instancia no está dispuesta y el canal no se desplaza el estado Faulted).</span><span class="sxs-lookup"><span data-stu-id="2228b-139">One area that you could perhaps use this approach is when you want to create a central place for converting exceptions to faults before they are sent to the client (ensuring that the instance is not disposed and the channel is not moved to the Faulted state).</span></span>

<span data-ttu-id="2228b-140">El método IErrorHandler. HandleError se usa normalmente para implementar comportamientos relacionados con errores, como el registro de errores, las notificaciones del sistema, el cierre de la aplicación, etc. Se puede llamar a IErrorHandler. HandleError en varios lugares dentro del servicio y, en función de dónde se produzca el error, el método HandleError puede ser invocado o no por el mismo subproceso que la operación. no se realiza ninguna garantía en este sentido.</span><span class="sxs-lookup"><span data-stu-id="2228b-140">The IErrorHandler.HandleError method is usually used to implement error-related behaviors such as error logging, system notifications, shutting down the application, etc. IErrorHandler.HandleError can be called at multiple places inside the service, and depending on where the error is thrown, the HandleError method may or may not be called by the same thread as the operation; no guarantees are made in this regard.</span></span>

## <a name="dealing-with-exceptions-outside-wcf"></a><span data-ttu-id="2228b-141">Tratar las excepciones fuera de WCF</span><span class="sxs-lookup"><span data-stu-id="2228b-141">Dealing with exceptions outside WCF</span></span>

<span data-ttu-id="2228b-142">A menudo, excepciones de configuración, excepciones de la cadena de conexión a bases de datos y otras excepciones similares pueden aparecer en el contexto de una aplicación de WCF, pero no son excepciones iniciadas por consultas del modelo de servicio o servicio web en sí.</span><span class="sxs-lookup"><span data-stu-id="2228b-142">Often, configuration exceptions, database connection string exceptions, and other similar exceptions may occur within the context of a WCF application, but are themselves are not exceptions caused by the service model or the web service itself.</span></span> <span data-ttu-id="2228b-143">Estas excepciones son excepciones "normales" externas al servicio Web y se deben controlar de la misma forma que se administrarán otras excepciones externas en el entorno.</span><span class="sxs-lookup"><span data-stu-id="2228b-143">These exceptions are "regular" exceptions external to the web service, and should be handled just as other external exceptions in the environment are to be handled.</span></span>

## <a name="tracing-exceptions"></a><span data-ttu-id="2228b-144">Traza de excepciones</span><span class="sxs-lookup"><span data-stu-id="2228b-144">Tracing exceptions</span></span>

<span data-ttu-id="2228b-145">El seguimiento es el único lugar "comodín" en el que se pueden ver todas las excepciones.</span><span class="sxs-lookup"><span data-stu-id="2228b-145">Tracing is the only "catch-all" place where one can potentially see all exceptions.</span></span> <span data-ttu-id="2228b-146">Para obtener más información acerca de excepciones de seguimiento e inicio de sesión, vea Seguimiento e Inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="2228b-146">For more information on tracing and logging exceptions, see Tracing and Logging.</span></span>

## <a name="uri-template-errors-when-using-webgetattribute-and-webinvokeattribute"></a><span data-ttu-id="2228b-147">Errores de la plantilla del URI al usar WebGetAttribute y WebInvokeAttribute</span><span class="sxs-lookup"><span data-stu-id="2228b-147">URI template errors when using WebGetAttribute and WebInvokeAttribute</span></span>

<span data-ttu-id="2228b-148">Los atributos WebGet y WebInvoke permiten especificar una plantilla URI que asigna los componentes de la solicitud a los parámetros de la operación.</span><span class="sxs-lookup"><span data-stu-id="2228b-148">The WebGet and WebInvoke attributes allow you to specify a URI template that maps components of the request address to operation parameters.</span></span> <span data-ttu-id="2228b-149">Por ejemplo, la plantilla de URI "weather/{state}/{city}" asigna la solicitud en tokens literales, un parámetro denominado estado y un parámetro denominado ciudad.</span><span class="sxs-lookup"><span data-stu-id="2228b-149">For example, the URI template "weather/{state}/{city}" maps the request address into literal tokens, a parameter named state, and a parameter named city.</span></span> <span data-ttu-id="2228b-150">Estos parámetros se pueden enlazar a continuación por nombre a algunos de los parámetros formales de la operación.</span><span class="sxs-lookup"><span data-stu-id="2228b-150">These parameters might then be bound by name to some of the formal parameters of the operation.</span></span>

<span data-ttu-id="2228b-151">Los parámetros de plantilla aparecen en forma de cadena del URI mientras que los parámetros formales de un contrato tipo pueden ser de tipos de no cadena.</span><span class="sxs-lookup"><span data-stu-id="2228b-151">The template parameters appear in the form of strings within the URI while the formal parameters of a typed contract might be of non-string types.</span></span> <span data-ttu-id="2228b-152">Por consiguiente, una conversión debe realizarse antes que la operación que se invoca.</span><span class="sxs-lookup"><span data-stu-id="2228b-152">Therefore, a conversion needs to take place before the operation can be invoked.</span></span> <span data-ttu-id="2228b-153">Hay disponible una [tabla de formatos de conversión](wcf-web-http-programming-model-overview.md) .</span><span class="sxs-lookup"><span data-stu-id="2228b-153">A [table of conversion formats](wcf-web-http-programming-model-overview.md) is available.</span></span>

<span data-ttu-id="2228b-154">Sin embargo, si la conversión genera un error, no se puede hacer saber a la operación qué ha salido mal.</span><span class="sxs-lookup"><span data-stu-id="2228b-154">However, if the conversion fails, then there's no way to let the operation know that something has gone wrong.</span></span> <span data-ttu-id="2228b-155">La conversión de tipo, en cambio, emerge en forma de error de envío.</span><span class="sxs-lookup"><span data-stu-id="2228b-155">The type conversion instead surfaces in the form of a dispatch failure.</span></span>

<span data-ttu-id="2228b-156">Un error de envío de conversión de tipo se puede inspeccionar igual que muchos otros tipos de errores de envío instalando un controlador de errores.</span><span class="sxs-lookup"><span data-stu-id="2228b-156">A type conversion dispatch failure can be inspected the same as with many other types of dispatch failures by installing an error handler.</span></span> <span data-ttu-id="2228b-157">El punto de extensibilidad de IErrorHandler se llama para controlar excepciones de nivel de servicio.</span><span class="sxs-lookup"><span data-stu-id="2228b-157">The IErrorHandler extensibility point is called to handle service-level exceptions.</span></span> <span data-ttu-id="2228b-158">Desde allí se puede elegir la respuesta que se va a devolver al que llama, así como realizar las tareas personalizadas y de envío de informes.</span><span class="sxs-lookup"><span data-stu-id="2228b-158">From there, the response to be sent back to the caller – as well as perform any custom tasks and reporting – may be chosen.</span></span>

## <a name="see-also"></a><span data-ttu-id="2228b-159">Vea también</span><span class="sxs-lookup"><span data-stu-id="2228b-159">See also</span></span>

- [<span data-ttu-id="2228b-160">Programación básica de WCF</span><span class="sxs-lookup"><span data-stu-id="2228b-160">Basic WCF Programming</span></span>](../basic-wcf-programming.md)
