---
title: Limitación de la distribución de mensajes
ms.date: 03/30/2017
ms.assetid: 8b5ec4b8-1ce9-45ef-bb90-2c840456bcc1
ms.openlocfilehash: e736aba60d7d2b39d1b8eb958a8c72e6e8d55e13
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/15/2020
ms.locfileid: "90555021"
---
# <a name="limiting-message-distribution"></a><span data-ttu-id="c1915-102">Limitación de la distribución de mensajes</span><span class="sxs-lookup"><span data-stu-id="c1915-102">Limiting Message Distribution</span></span>

<span data-ttu-id="c1915-103">El canal del mismo nivel es, por diseño, una malla de difusión.</span><span class="sxs-lookup"><span data-stu-id="c1915-103">Peer Channel is by design a broadcast mesh.</span></span> <span data-ttu-id="c1915-104">Su modelo de distribución básico implica la distribución de cada mensaje enviado por cualquier miembro de una malla a todos los demás miembros de esa malla.</span><span class="sxs-lookup"><span data-stu-id="c1915-104">Its basic flooding model involves distributing each message sent by any member of a mesh to all other members of that mesh.</span></span> <span data-ttu-id="c1915-105">Esto es ideal en situaciones en las que cada mensaje generado por un miembro es relevante y útil para todos los demás miembros (por ejemplo, en un salón de chat).</span><span class="sxs-lookup"><span data-stu-id="c1915-105">This is ideal in situations where every message generated by a member is relevant and useful to all other members (for example, a chat room).</span></span> <span data-ttu-id="c1915-106">Sin embargo, muchas aplicaciones tienen una necesidad ocasional de limitar la distribución de mensajes.</span><span class="sxs-lookup"><span data-stu-id="c1915-106">However, many applications have an occasional need for limiting message distribution.</span></span> <span data-ttu-id="c1915-107">Por ejemplo, si un nuevo miembro se une a una malla y desea recuperar el último mensaje enviado a través de la malla, esta solicitud no necesita ser distribuida a cada miembro.</span><span class="sxs-lookup"><span data-stu-id="c1915-107">For example, if a new member joins a mesh and wants to retrieve the last message sent through the mesh, this request does not need to be flooded to every member of the mesh.</span></span> <span data-ttu-id="c1915-108">La solicitud se puede limitar a vecinos cercanos o se pueden filtrar los mensajes generados localmente. Los mensajes también se pueden enviar a un nodo individual en la malla.</span><span class="sxs-lookup"><span data-stu-id="c1915-108">The request could be limited to near neighbors, or locally generated messages can be filtered out. Messages can also be sent to an individual node on the mesh.</span></span> <span data-ttu-id="c1915-109">En este tema se analiza el uso del número de saltos, de un filtro de propagación de mensajes, de un filtro local o de una conexión directa para controlar la forma en que los mensajes se reenvían a lo largo de la malla, y se proporcionan instrucciones de carácter general para elegir un enfoque.</span><span class="sxs-lookup"><span data-stu-id="c1915-109">This topic discusses using Hop Count, a Message Propagation Filter, a local filter, or a direct connection to control how messages are forwarded throughout the mesh, and provides general guidelines for choosing an approach.</span></span>

## <a name="hop-counts"></a><span data-ttu-id="c1915-110">Números de saltos</span><span class="sxs-lookup"><span data-stu-id="c1915-110">Hop Counts</span></span>

<span data-ttu-id="c1915-111">El concepto de `PeerHopCount` es similar al de período de vida (TTL) que se usa en el protocolo IP.</span><span class="sxs-lookup"><span data-stu-id="c1915-111">The concept of `PeerHopCount` is similar to TTL (Time-To-Live) used in IP protocol.</span></span> <span data-ttu-id="c1915-112">El valor de `PeerHopCount` se asocia a una instancia de mensaje y especifica cuántas veces se debería reenviar un mensaje antes de entregarse.</span><span class="sxs-lookup"><span data-stu-id="c1915-112">The value of `PeerHopCount` is tied to a message instance, and it specifies how many times a message should be forwarded before being dropped.</span></span> <span data-ttu-id="c1915-113">Cada vez que un cliente del canal del mismo nivel recibe un mensaje, el cliente examina el mensaje para ver si se especifica `PeerHopCount`.</span><span class="sxs-lookup"><span data-stu-id="c1915-113">Each time a message is received by a Peer Channel client, the client examines the message to see if `PeerHopCount` is specified.</span></span> <span data-ttu-id="c1915-114">Si se especifica, el cliente disminuye en uno el valor de número de saltos antes de reenviar el mensaje a los nodos vecinos.</span><span class="sxs-lookup"><span data-stu-id="c1915-114">If it is specified, then the client decrements the hop count value by one before forwarding the message to neighboring nodes.</span></span> <span data-ttu-id="c1915-115">Cuando un cliente recibe un mensaje con un valor cero para el número de saltos, el cliente procesa el mensaje pero no lo reenvía a los vecinos.</span><span class="sxs-lookup"><span data-stu-id="c1915-115">When a client receives a message with a hop count value of zero, the client processes the message, but does not forward the message to neighbors.</span></span>

<span data-ttu-id="c1915-116">El número de saltos se puede agregar a un mensaje agregando `PeerHopCount` como un atributo a la propiedad aplicable o campo en la implementación de la clase de mensaje.</span><span class="sxs-lookup"><span data-stu-id="c1915-116">Hop count may be added to a message by adding `PeerHopCount` as an attribute to the applicable property or field in the implementation of the message class.</span></span> <span data-ttu-id="c1915-117">Puede establecer esto en un valor concreto antes de enviar el mensaje a la malla.</span><span class="sxs-lookup"><span data-stu-id="c1915-117">You can set this to a specific value before sending the message to the mesh.</span></span> <span data-ttu-id="c1915-118">De esta manera, el número de saltos puede servir para limitar la distribución de mensajes a lo largo de la malla cuando sea necesario, evitando así la posible duplicación innecesaria de los mensajes.</span><span class="sxs-lookup"><span data-stu-id="c1915-118">In this manner, you can use hop count to limit distribution of messages throughout the mesh when necessary, potentially avoiding unnecessary message duplication.</span></span> <span data-ttu-id="c1915-119">Esto es útil cuando la malla contiene una gran cantidad de datos redundantes o para enviar un mensaje a los vecinos inmediatos o a los vecinos a pocos saltos de distancia.</span><span class="sxs-lookup"><span data-stu-id="c1915-119">This is useful in cases where the mesh contains a high amount of redundant data, or for sending a message to immediate neighbors, or neighbors within a few hops.</span></span>

- <span data-ttu-id="c1915-120">Para obtener fragmentos de código e información relacionada, vea el blog [PeerHopCount: control](/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) de la publicación de distribución de mensajes en el blog del canal del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="c1915-120">For code snippets and related information, see the [The PeerHopCount Attribute: Controlling Message Distribution](/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) post on the Peer Channel blog.</span></span>

## <a name="message-propagation-filter"></a><span data-ttu-id="c1915-121">Filtro de propagación de mensajes</span><span class="sxs-lookup"><span data-stu-id="c1915-121">Message Propagation Filter</span></span>

<span data-ttu-id="c1915-122">`MessagePropagationFilter` se puede utilizar para el control personalizado de la distribución de mensajes, sobre todo cuando el contenido del mensaje u otros escenarios concretos determinan la propagación.</span><span class="sxs-lookup"><span data-stu-id="c1915-122">`MessagePropagationFilter` can be used for customized control of message flooding, especially when the content of the message or other specific scenarios determine propagation.</span></span> <span data-ttu-id="c1915-123">El filtro toma decisiones de propagación para cada mensaje que atraviesa el nodo.</span><span class="sxs-lookup"><span data-stu-id="c1915-123">The filter makes propagation decisions for every message that passes through the node.</span></span> <span data-ttu-id="c1915-124">Así sucede en el caso de los mensajes originados en otra parte de la malla que el nodo ha recibido, así como los mensajes creados por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c1915-124">This is true for messages that originated elsewhere in the mesh that your node has received as well as messages created by your application.</span></span> <span data-ttu-id="c1915-125">El filtro tiene acceso tanto al mensaje como a su origen, por lo que las decisiones sobre el reenvío o la entrega del mensaje se pueden basar en toda la información disponible.</span><span class="sxs-lookup"><span data-stu-id="c1915-125">The filter has access to both the message and its origination, so decisions about forwarding or dropping the message can be based on the full information available.</span></span>

<span data-ttu-id="c1915-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> es una clase base abstracta con una función única, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span><span class="sxs-lookup"><span data-stu-id="c1915-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> is a base abstract class with a single function, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span></span> <span data-ttu-id="c1915-127">El primer argumento de la llamada al método pasa una copia completa del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c1915-127">The first argument of the method call passes in a full copy of the message.</span></span> <span data-ttu-id="c1915-128">Cualquier cambio realizado en el mensaje no afecta al mensaje real.</span><span class="sxs-lookup"><span data-stu-id="c1915-128">Any changes made to the message do not affect the actual message.</span></span> <span data-ttu-id="c1915-129">El último argumento de la llamada al método identifica el origen del mensaje (`PeerMessageOrigination.Local` o `PeerMessageOrigination.Remote`).</span><span class="sxs-lookup"><span data-stu-id="c1915-129">The last argument of the method call identifies the origin of the message (`PeerMessageOrigination.Local` or `PeerMessageOrigination.Remote`).</span></span> <span data-ttu-id="c1915-130">Las implementaciones concretas de este método deben devolver una constante de la enumeración <xref:System.ServiceModel.PeerMessagePropagation> que indique si el mensaje se debe reenviar a la aplicación local (`Local`), a clientes remotos (`Remote`), a ambos (`LocalAndRemote`) o a ninguno (`None`).</span><span class="sxs-lookup"><span data-stu-id="c1915-130">Concrete implementations of this method must return a constant from the <xref:System.ServiceModel.PeerMessagePropagation> enumeration indicating that the message is to be forwarded to the local application (`Local`), forwarded to remote clients (`Remote`), both (`LocalAndRemote`), or neither (`None`).</span></span> <span data-ttu-id="c1915-131">Para aplicar este filtro, puede tener acceso al objeto `PeerNode` correspondiente y especificar una instancia de la clase de filtro de propagación derivada en la propiedad `PeerNode.MessagePropagationFilter`.</span><span class="sxs-lookup"><span data-stu-id="c1915-131">This filter can be applied by accessing the corresponding `PeerNode` object and specifying an instance of the derived propagation filter class in the `PeerNode.MessagePropagationFilter` property.</span></span> <span data-ttu-id="c1915-132">Asegúrese de que el filtro de propagación está adjunto antes de abrir el canal del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="c1915-132">Ensure that the propagation filter is attached before opening the Peer Channel.</span></span>

- <span data-ttu-id="c1915-133">Para obtener fragmentos de código e información relacionada, vea la entrada de [canal del mismo nivel y MessagePropagationFilter](/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) en el blog del canal del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="c1915-133">For code snippets and related information, see the [Peer Channel and MessagePropagationFilter](/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) post on the Peer Channel blog.</span></span>

## <a name="contacting-an-individual-node-in-the-mesh"></a><span data-ttu-id="c1915-134">Contacto con un nodo Individual de la malla</span><span class="sxs-lookup"><span data-stu-id="c1915-134">Contacting an Individual Node in the Mesh</span></span>

<span data-ttu-id="c1915-135">Es posible establecer contacto con un nodo individual de una malla mediante la configuración de un filtro local o una conexión directa.</span><span class="sxs-lookup"><span data-stu-id="c1915-135">An individual node in a mesh can be contacted by setting up a local filter, or by setting up a direct connection.</span></span>

<span data-ttu-id="c1915-136">Si cada nodo de una malla tiene un identificador individual, se puede especificar un identificador de destino en la implementación del mensaje.</span><span class="sxs-lookup"><span data-stu-id="c1915-136">If the nodes in a mesh each have an individual ID, a destination ID can be specified in the implementation of your message.</span></span> <span data-ttu-id="c1915-137">Para configurar un filtro local, se puede escribir una función en el contrato de mensaje que muestre el mensaje al nodo actual solo si su identificador coincide con el identificador de destino especificado.</span><span class="sxs-lookup"><span data-stu-id="c1915-137">A local filter can be set up by writing a function in your message contract that will only display the message to the current node if its ID matches the destination ID you specified.</span></span> <span data-ttu-id="c1915-138">La malla transporta el mensaje, de modo que se evita la sobrecarga de configurar una nueva conexión.</span><span class="sxs-lookup"><span data-stu-id="c1915-138">The mesh transports the message, so the overhead of setting up a new connection does not have to be incurred.</span></span> <span data-ttu-id="c1915-139">Sin embargo, se produce una pérdida de eficacia, ya que el mensaje se envía muchas veces a lo largo de la malla.</span><span class="sxs-lookup"><span data-stu-id="c1915-139">However, there is a loss of efficiency since the message is sent many times throughout the mesh.</span></span> <span data-ttu-id="c1915-140">Esto funciona correctamente para el envío de mensajes a miembros individuales de una malla siempre y cuando los mensajes no sean ni demasiado grandes ni demasiado frecuentes.</span><span class="sxs-lookup"><span data-stu-id="c1915-140">This works well for sending messages to individual members of a mesh as long as the messages are neither too big nor too frequent.</span></span>

<span data-ttu-id="c1915-141">En el caso de las conexiones prolongadas con un ancho de banda alto, se prefieren las conexiones directas.</span><span class="sxs-lookup"><span data-stu-id="c1915-141">For long-lasting, high-bandwidth connections, direct connections are preferable.</span></span> <span data-ttu-id="c1915-142">Puede enviar la información de conexión a través de la malla y después configurar la conexión directa que prefiera para enviar y recibir los mensajes.</span><span class="sxs-lookup"><span data-stu-id="c1915-142">You can send connection information over the mesh, and then set up a direct connection of your choosing to send/receive messages.</span></span>

## <a name="choosing-an-approach-for-limiting-message-distribution"></a><span data-ttu-id="c1915-143">Elección de un enfoque para limitar la distribución de mensajes</span><span class="sxs-lookup"><span data-stu-id="c1915-143">Choosing an Approach for Limiting Message Distribution</span></span>

<span data-ttu-id="c1915-144">Cuando detecte un escenario para el que es necesario limitar la distribución de mensajes, hágase las preguntas siguientes:</span><span class="sxs-lookup"><span data-stu-id="c1915-144">When you discover a scenario in which you need to limit message distribution, ask yourself the following questions:</span></span>

- <span data-ttu-id="c1915-145">**¿Quién** debe recibir el mensaje?</span><span class="sxs-lookup"><span data-stu-id="c1915-145">**Who** needs to receive the message?</span></span> <span data-ttu-id="c1915-146">¿Simplemente uno nodo vecino?</span><span class="sxs-lookup"><span data-stu-id="c1915-146">Just one neighbor node?</span></span> <span data-ttu-id="c1915-147">¿Un nodo en alguna otra parte de la malla?</span><span class="sxs-lookup"><span data-stu-id="c1915-147">A node somewhere else in the mesh?</span></span> <span data-ttu-id="c1915-148">¿La mitad de la malla?</span><span class="sxs-lookup"><span data-stu-id="c1915-148">Half the mesh?</span></span>

- <span data-ttu-id="c1915-149">**¿Con qué frecuencia** se enviará este mensaje?</span><span class="sxs-lookup"><span data-stu-id="c1915-149">**How often** will this message be sent?</span></span>

- <span data-ttu-id="c1915-150">¿Qué tipo de **ancho de banda** usará este mensaje?</span><span class="sxs-lookup"><span data-stu-id="c1915-150">What kind of **bandwidth** will this message use?</span></span>

<span data-ttu-id="c1915-151">Las respuestas a estas preguntas pueden ayudarle a determinar si debe utilizar el número de saltos, un filtro de propagación de mensajes, un filtro local o una conexión directa.</span><span class="sxs-lookup"><span data-stu-id="c1915-151">The answers to these questions can help you determine whether to use Hop Count, a Message Propagation Filter, a local filter, or a direct connection.</span></span> <span data-ttu-id="c1915-152">Considere las siguientes pautas de carácter general:</span><span class="sxs-lookup"><span data-stu-id="c1915-152">Consider the following general guidelines:</span></span>

- <span data-ttu-id="c1915-153">**Aprovechar**</span><span class="sxs-lookup"><span data-stu-id="c1915-153">**Who**</span></span>

  - <span data-ttu-id="c1915-154">*Nodo individual*: filtro local o conexión directa.</span><span class="sxs-lookup"><span data-stu-id="c1915-154">*Individual node*:  Local filter or direct connection.</span></span>

  - <span data-ttu-id="c1915-155">*Vecinos dentro de un determinado proximidad*: PeerHopCount.</span><span class="sxs-lookup"><span data-stu-id="c1915-155">*Neighbors within a certain vicinity*:  PeerHopCount.</span></span>

  - <span data-ttu-id="c1915-156">*Subconjunto complejo de la malla*: MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="c1915-156">*Complex subset of the mesh*:  MessagePropagationFilter.</span></span>

- <span data-ttu-id="c1915-157">**Frecuencia**</span><span class="sxs-lookup"><span data-stu-id="c1915-157">**How often**</span></span>

  - <span data-ttu-id="c1915-158">*Muy frecuente*: conexión directa, PeerHopCount, MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="c1915-158">*Very frequent*:  Direct connection, PeerHopCount, MessagePropagationFilter.</span></span>

  - <span data-ttu-id="c1915-159">*Ocasional*: filtro local.</span><span class="sxs-lookup"><span data-stu-id="c1915-159">*Occasional*:  Local filter.</span></span>

- <span data-ttu-id="c1915-160">**Uso del ancho de banda**</span><span class="sxs-lookup"><span data-stu-id="c1915-160">**Bandwidth use**</span></span>

  - <span data-ttu-id="c1915-161">*Alta*: conexión directa, menos recomendable para usar MessagePropagationFilter o filtro local.</span><span class="sxs-lookup"><span data-stu-id="c1915-161">*High*:  Direct connection, less advisable to use MessagePropagationFilter or local filter.</span></span>

  - <span data-ttu-id="c1915-162">*Bajo*: cualquier conexión directa probablemente no sea necesaria.</span><span class="sxs-lookup"><span data-stu-id="c1915-162">*Low*:  Any, direct connection probably not needed.</span></span>

## <a name="see-also"></a><span data-ttu-id="c1915-163">Vea también</span><span class="sxs-lookup"><span data-stu-id="c1915-163">See also</span></span>

- [<span data-ttu-id="c1915-164">Creación de una aplicación de canal del mismo nivel</span><span class="sxs-lookup"><span data-stu-id="c1915-164">Building a Peer Channel Application</span></span>](building-a-peer-channel-application.md)
