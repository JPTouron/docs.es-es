---
title: Copias sombra de ensamblados
description: Obtenga información sobre las instantáneas de ensamblados en .NET, que permiten que los ensamblados que se usan en un dominio de aplicación se puedan actualizar sin descargar el dominio de aplicación.
ms.date: 03/30/2017
helpviewer_keywords:
- assemblies [.NET Framework], shadow copying
- application domains, shadow copying assemblies
- shadow copying assemblies
ms.assetid: de8b8759-fca7-4260-896b-5a4973157672
ms.openlocfilehash: a7ff72763dd26dbc50cd37e070c2d25ababa00f3
ms.sourcegitcommit: 1c37a894c923bea021a3cc38ce7cba946357bbe1
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 06/19/2020
ms.locfileid: "85104560"
---
# <a name="shadow-copying-assemblies"></a><span data-ttu-id="8d6f3-103">Copias sombra de ensamblados</span><span class="sxs-lookup"><span data-stu-id="8d6f3-103">Shadow Copying Assemblies</span></span>

<span data-ttu-id="8d6f3-104">Las instantáneas permiten que los ensamblados que se usan en un dominio de aplicación se actualicen sin descargar el dominio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-104">Shadow copying enables assemblies that are used in an application domain to be updated without unloading the application domain.</span></span> <span data-ttu-id="8d6f3-105">Esto es especialmente útil para las aplicaciones que tienen que estar disponibles continuamente, como los sitios de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-105">This is particularly useful for applications that must be available continuously, such as ASP.NET sites.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8d6f3-106">En las aplicaciones de la Tienda Windows 8.x no se admite la generación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-106">Shadow copying is not supported in Windows 8.x Store apps.</span></span>

<span data-ttu-id="8d6f3-107">Common Language Runtime bloquea el archivo de ensamblado al cargar el ensamblado, por lo que no se puede actualizar el archivo hasta que se descarga el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-107">The common language runtime locks an assembly file when the assembly is loaded, so the file cannot be updated until the assembly is unloaded.</span></span> <span data-ttu-id="8d6f3-108">La única manera de descargar un ensamblado de un dominio de aplicación es descargar el dominio de aplicación, por lo que en circunstancias normales, no se puede actualizar un ensamblado en el disco hasta que todos los dominios de aplicación que lo están usando se descargan.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-108">The only way to unload an assembly from an application domain is by unloading the application domain, so under normal circumstances, an assembly cannot be updated on disk until all the application domains that are using it have been unloaded.</span></span>

<span data-ttu-id="8d6f3-109">Cuando un dominio de aplicación se configura para realizar instantáneas de los archivos, los ensamblados de la ruta de acceso de la aplicación se copian a otra ubicación y se cargan desde esa ubicación.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-109">When an application domain is configured to shadow copy files, assemblies from the application path are copied to another location and loaded from that location.</span></span> <span data-ttu-id="8d6f3-110">La instantánea está bloqueada, pero el archivo de ensamblado original está desbloqueado y se puede actualizar.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-110">The copy is locked, but the original assembly file is unlocked and can be updated.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8d6f3-111">Los únicos ensamblados de los que se pueden realizar instantáneas son los que se almacenan en el directorio de la aplicación o sus subdirectorios, y se especifican con las propiedades <xref:System.AppDomainSetup.ApplicationBase%2A> y <xref:System.AppDomainSetup.PrivateBinPath%2A> cuando se configura el dominio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-111">The only assemblies that can be shadow copied are those stored in the application directory or its subdirectories, specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties when the application domain is configured.</span></span> <span data-ttu-id="8d6f3-112">De los ensamblados almacenados en la caché global de ensamblados no se realizan instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-112">Assemblies stored in the global assembly cache are not shadow copied.</span></span>

<span data-ttu-id="8d6f3-113">Este artículo contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="8d6f3-113">This article contains the following sections:</span></span>

- <span data-ttu-id="8d6f3-114">En [Habilitar y usar instantáneas](#EnablingAndUsing) se describe el uso básico y las opciones disponibles para crear instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-114">[Enabling and Using Shadow Copying](#EnablingAndUsing) describes the basic use and the options that are available for shadow copying.</span></span>

- <span data-ttu-id="8d6f3-115">En [Rendimiento de inicio](#StartupPerformance) se describen los cambios que se realizan para crear instantáneas en .NET Framework 4 de cara a mejorar el rendimiento de inicio y cómo revertir al comportamiento de las versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-115">[Startup Performance](#StartupPerformance) describes the changes that are made to shadow copying in the .NET Framework 4 to improve startup performance, and how to revert to the behavior of earlier versions.</span></span>

- <span data-ttu-id="8d6f3-116">En [Métodos obsoletos](#ObsoleteMethods) se describen los cambios realizados en las propiedades y los métodos que controlan las instantáneas en .NET Framework 2.0.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-116">[Obsolete Methods](#ObsoleteMethods) describes the changes that were made to the properties and methods that control shadow copying in the .NET Framework 2.0.</span></span>

<a name="EnablingAndUsing"></a>

## <a name="enabling-and-using-shadow-copying"></a><span data-ttu-id="8d6f3-117">Habilitar y usar instantáneas</span><span class="sxs-lookup"><span data-stu-id="8d6f3-117">Enabling and Using Shadow Copying</span></span>

<span data-ttu-id="8d6f3-118">Puede utilizar las propiedades de la clase <xref:System.AppDomainSetup> como se indica a continuación para configurar un dominio de aplicación y crear instantáneas:</span><span class="sxs-lookup"><span data-stu-id="8d6f3-118">You can use the properties of the <xref:System.AppDomainSetup> class as follows to configure an application domain for shadow copying:</span></span>

- <span data-ttu-id="8d6f3-119">Habilite las instantáneas estableciendo la propiedad <xref:System.AppDomainSetup.ShadowCopyFiles%2A> como el valor de cadena `"true"`.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-119">Enable shadow copying by setting the <xref:System.AppDomainSetup.ShadowCopyFiles%2A> property to the string value `"true"`.</span></span>

  <span data-ttu-id="8d6f3-120">De forma predeterminada, este ajuste hace que todos los ensamblados de la ruta de acceso de la aplicación se copien en una caché de descarga antes de cargarse.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-120">By default, this setting causes all assemblies in the application path to be copied to a download cache before they are loaded.</span></span> <span data-ttu-id="8d6f3-121">Se trata de la misma caché mantenida por Common Language Runtime para almacenar archivos descargados de otros equipos, y Common Language Runtime elimina automáticamente los archivos cuando dejan de ser necesarios.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-121">This is the same cache maintained by the common language runtime to store files downloaded from other computers, and the common language runtime automatically deletes the files when they are no longer needed.</span></span>

- <span data-ttu-id="8d6f3-122">Si quiere, establezca una ubicación personalizada para los archivos de instantáneas con las propiedades <xref:System.AppDomainSetup.CachePath%2A> y <xref:System.AppDomainSetup.ApplicationName%2A>.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-122">Optionally set a custom location for shadow copied files by using the <xref:System.AppDomainSetup.CachePath%2A> property and the <xref:System.AppDomainSetup.ApplicationName%2A> property.</span></span>

  <span data-ttu-id="8d6f3-123">La ruta de acceso base de la ubicación se forma concatenando la propiedad <xref:System.AppDomainSetup.ApplicationName%2A> a la propiedad <xref:System.AppDomainSetup.CachePath%2A> como un subdirectorio.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-123">The base path for the location is formed by concatenating the <xref:System.AppDomainSetup.ApplicationName%2A> property to the <xref:System.AppDomainSetup.CachePath%2A> property as a subdirectory.</span></span> <span data-ttu-id="8d6f3-124">Las instantáneas de los ensamblados se colocan en los subdirectorios de esta ruta, no en la ruta de acceso base.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-124">Assemblies are shadow copied to subdirectories of this path, not to the base path itself.</span></span>

  > [!NOTE]
  > <span data-ttu-id="8d6f3-125">Si no se establece la propiedad <xref:System.AppDomainSetup.ApplicationName%2A>, la propiedad <xref:System.AppDomainSetup.CachePath%2A> se ignora y se utiliza la caché de descarga.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-125">If the <xref:System.AppDomainSetup.ApplicationName%2A> property is not set, the <xref:System.AppDomainSetup.CachePath%2A> property is ignored and the download cache is used.</span></span> <span data-ttu-id="8d6f3-126">No se inicia ninguna excepción.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-126">No exception is thrown.</span></span>

  <span data-ttu-id="8d6f3-127">Si especifica una ubicación personalizada, será usted el responsable de limpiar los directorios y los archivos copiados cuando dejen de ser necesarios.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-127">If you specify a custom location, you are responsible for cleaning up the directories and copied files when they are no longer needed.</span></span> <span data-ttu-id="8d6f3-128">No se eliminan automáticamente.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-128">They are not deleted automatically.</span></span>

  <span data-ttu-id="8d6f3-129">Hay varias razones por las que puede que le convenga establecer una ubicación personalizada para los archivos de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-129">There are a few reasons why you might want to set a custom location for shadow copied files.</span></span> <span data-ttu-id="8d6f3-130">Puede que le venga bien establecer una ubicación personalizada para los archivos de instantáneas si la aplicación genera un gran número de copias.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-130">You might want to set a custom location for shadow copied files if your application generates a large number of copies.</span></span> <span data-ttu-id="8d6f3-131">La caché de descarga tiene un límite de tamaño, no de duración, por lo que es posible que Common Language Runtime trate de eliminar un archivo que todavía se esté usando.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-131">The download cache is limited by size, not by lifetime, so it is possible that the common language runtime will attempt to delete a file that is still in use.</span></span> <span data-ttu-id="8d6f3-132">Otra razón para establecer una ubicación personalizada se da cuando los usuarios que ejecutan la aplicación no tienen acceso de escritura a la ubicación del directorio que Common Language Runtime utiliza para la caché de descarga.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-132">Another reason to set a custom location is when users running your application do not have write access to the directory location the common language runtime uses for the download cache.</span></span>

- <span data-ttu-id="8d6f3-133">Si quiere, puede limitar los ensamblados de los que se toman instantáneas con la propiedad <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-133">Optionally limit the assemblies that are shadow copied by using the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span>

  <span data-ttu-id="8d6f3-134">Al habilitar las instantáneas en un dominio de aplicación, el valor predeterminado es copiar todos los ensamblados en la ruta de acceso de la aplicación, es decir, en los directorios especificados por las propiedades <xref:System.AppDomainSetup.ApplicationBase%2A> y <xref:System.AppDomainSetup.PrivateBinPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-134">When you enable shadow copying for an application domain, the default is to copy all assemblies in the application path — that is, in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties.</span></span> <span data-ttu-id="8d6f3-135">Puede limitar la copia a determinados directorios: para ello, cree una cadena que contenga solo los directorios de los que quiera crear instantáneas y asigne la cadena a la propiedad <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-135">You can limit the copying to selected directories by creating a string that contains only those directories you want to shadow copy, and assigning the string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span> <span data-ttu-id="8d6f3-136">Separe los directorios con punto y coma.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-136">Separate the directories with semicolons.</span></span> <span data-ttu-id="8d6f3-137">Solo se realizarán instantáneas de los ensamblados situados en los directorios seleccionados.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-137">The only assemblies that are shadow copied are the ones in the selected directories.</span></span>

  > [!NOTE]
  > <span data-ttu-id="8d6f3-138">Si no asigna ninguna cadena a la propiedad <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>, o si establece esta propiedad como `null`, se realizarán instantáneas de todos los ensamblados de los directorios especificados por las propiedades <xref:System.AppDomainSetup.ApplicationBase%2A> y <xref:System.AppDomainSetup.PrivateBinPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-138">If you don’t assign a string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property, or if you set this property to `null`, all assemblies in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties are shadow copied.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="8d6f3-139">Las rutas de acceso de directorio no deben contener ningún carácter de punto y coma, porque el punto y coma es el carácter delimitador.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-139">Directory paths must not contain semicolons, because the semicolon is the delimiter character.</span></span> <span data-ttu-id="8d6f3-140">No hay ningún carácter de escape para el punto y coma.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-140">There is no escape character for semicolons.</span></span>

<a name="StartupPerformance"></a>

## <a name="startup-performance"></a><span data-ttu-id="8d6f3-141">Rendimiento de inicio</span><span class="sxs-lookup"><span data-stu-id="8d6f3-141">Startup Performance</span></span>

<span data-ttu-id="8d6f3-142">Cuando se inicia un dominio de aplicación que utiliza instantáneas, hay un retraso mientras las instantáneas del directorio de aplicación se copian al directorio de instantáneas, o se comprueba si ya están en esa ubicación.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-142">When an application domain that uses shadow copying starts, there is a delay while assemblies in the application directory are copied to the shadow copy directory, or verified if they are already in that location.</span></span> <span data-ttu-id="8d6f3-143">Antes de .NET Framework 4, todos los ensamblados se copiaban en un directorio temporal.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-143">Before the .NET Framework 4, all assemblies were copied to a temporary directory.</span></span> <span data-ttu-id="8d6f3-144">Cada ensamblado se abría para comprobar el nombre del ensamblado y el nombre seguro se validaba.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-144">Each assembly was opened to verify the assembly name, and the strong name was validated.</span></span> <span data-ttu-id="8d6f3-145">Se comprobaba cada ensamblado para saber si se actualizó más recientemente que la copia del directorio de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-145">Each assembly was checked to see whether it had been updated more recently than the copy in the shadow copy directory.</span></span> <span data-ttu-id="8d6f3-146">Si es así, se copiaba al directorio de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-146">If so, it was copied to the shadow copy directory.</span></span> <span data-ttu-id="8d6f3-147">Por último, se descartaban las copias temporales.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-147">Finally, the temporary copies were discarded.</span></span>

<span data-ttu-id="8d6f3-148">A partir de .NET Framework 4, el comportamiento de inicio predeterminado consiste en comparar directamente la fecha y la hora de cada archivo de ensamblado del directorio de aplicación con la fecha y la hora de la copia situada en el directorio de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-148">Beginning with the .NET Framework 4, the default startup behavior is to directly compare the file date and time of each assembly in the application directory with the file date and time of the copy in the shadow copy directory.</span></span> <span data-ttu-id="8d6f3-149">Si el ensamblado se ha actualizado, se copiará con el mismo procedimiento que en las versiones anteriores de .NET Framework. Si no, se cargará la copia del directorio de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-149">If the assembly has been updated, it is copied by using the same procedure as in earlier versions of the .NET Framework; otherwise, the copy in the shadow copy directory is loaded.</span></span>

<span data-ttu-id="8d6f3-150">La mejora del rendimiento resultante es mayor en las aplicaciones en las que los ensamblados no cambian con frecuencia y, normalmente, los cambios se producen en un pequeño subconjunto de ensamblados.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-150">The resulting performance improvement is largest for applications in which assemblies do not change frequently and changes usually occur in a small subset of assemblies.</span></span> <span data-ttu-id="8d6f3-151">Si la mayoría de los ensamblados de una aplicación cambia con frecuencia, el nuevo comportamiento predeterminado puede provocar una regresión del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-151">If a majority of assemblies in an application change frequently, the new default behavior might cause a performance regression.</span></span> <span data-ttu-id="8d6f3-152">Puede restaurar el comportamiento de inicio de las versiones anteriores de .NET Framework. Para ello, agregue el [elemento \<shadowCopyVerifyByTimestamp>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) al archivo de configuración, con `enabled="false"`.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-152">You can restore the startup behavior of previous versions of the .NET Framework by adding the [\<shadowCopyVerifyByTimestamp> element](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) to the configuration file, with `enabled="false"`.</span></span>

<a name="ObsoleteMethods"></a>

## <a name="obsolete-methods"></a><span data-ttu-id="8d6f3-153">Métodos obsoletos</span><span class="sxs-lookup"><span data-stu-id="8d6f3-153">Obsolete Methods</span></span>

<span data-ttu-id="8d6f3-154">La clase <xref:System.AppDomain> tiene varios métodos, como <xref:System.AppDomain.SetShadowCopyFiles%2A> y <xref:System.AppDomain.ClearShadowCopyPath%2A>, que pueden utilizarse para controlar la creación de instantáneas en un dominio de aplicación, pero estos métodos se marcaron como obsoletos en la versión 2.0 de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-154">The <xref:System.AppDomain> class has several methods, such as <xref:System.AppDomain.SetShadowCopyFiles%2A> and <xref:System.AppDomain.ClearShadowCopyPath%2A>, that can be used to control shadow copying on an application domain, but these have been marked obsolete in the .NET Framework version 2.0.</span></span> <span data-ttu-id="8d6f3-155">La forma recomendada de configurar un dominio de aplicación es utilizar las propiedades de la clase <xref:System.AppDomainSetup>.</span><span class="sxs-lookup"><span data-stu-id="8d6f3-155">The recommended way to configure an application domain for shadow copying is to use the properties of the <xref:System.AppDomainSetup> class.</span></span>

## <a name="see-also"></a><span data-ttu-id="8d6f3-156">Vea también</span><span class="sxs-lookup"><span data-stu-id="8d6f3-156">See also</span></span>

- <xref:System.AppDomainSetup.ShadowCopyFiles%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.CachePath%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ApplicationName%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ShadowCopyDirectories%2A?displayProperty=nameWithType>
- [<span data-ttu-id="8d6f3-157">Elemento \<shadowCopyVerifyByTimestamp></span><span class="sxs-lookup"><span data-stu-id="8d6f3-157">\<shadowCopyVerifyByTimestamp> Element</span></span>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md)
