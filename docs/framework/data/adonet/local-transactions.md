---
title: Transacciones locales
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8ae3712f-ef5e-41a1-9ea9-b3d0399439f1
ms.openlocfilehash: a0b713ab0b81cb2f0661212dae22db34b7f9f3ae
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/24/2020
ms.locfileid: "91175400"
---
# <a name="local-transactions"></a><span data-ttu-id="c25f7-102">Transacciones locales</span><span class="sxs-lookup"><span data-stu-id="c25f7-102">Local Transactions</span></span>

<span data-ttu-id="c25f7-103">Las transacciones de ADO.NET se usan cuando se desea enlazar varias tareas juntas para que se ejecuten como una sola unidad de trabajo.</span><span class="sxs-lookup"><span data-stu-id="c25f7-103">Transactions in ADO.NET are used when you want to bind multiple tasks together so that they execute as a single unit of work.</span></span> <span data-ttu-id="c25f7-104">Por ejemplo, imagine que una aplicación realiza dos tareas.</span><span class="sxs-lookup"><span data-stu-id="c25f7-104">For example, imagine that an application performs two tasks.</span></span> <span data-ttu-id="c25f7-105">Primero, actualiza una tabla con información de pedidos.</span><span class="sxs-lookup"><span data-stu-id="c25f7-105">First, it updates a table with order information.</span></span> <span data-ttu-id="c25f7-106">Luego, actualiza una tabla que contiene la información de inventario, cargando en cuenta los elementos pedidos.</span><span class="sxs-lookup"><span data-stu-id="c25f7-106">Second, it updates a table that contains inventory information, debiting the items ordered.</span></span> <span data-ttu-id="c25f7-107">Si se produce un error en cualquiera de las tareas, se revierten ambas.</span><span class="sxs-lookup"><span data-stu-id="c25f7-107">If either task fails, then both updates are rolled back.</span></span>  
  
## <a name="determining-the-transaction-type"></a><span data-ttu-id="c25f7-108">Determinación del tipo de transacción</span><span class="sxs-lookup"><span data-stu-id="c25f7-108">Determining the Transaction Type</span></span>  

 <span data-ttu-id="c25f7-109">Una transacción se considera una transacción local cuando es una transacción de una sola fase y se controla directamente por la base de datos.</span><span class="sxs-lookup"><span data-stu-id="c25f7-109">A transaction is considered to be a local transaction when it is a single-phase transaction and is handled by the database directly.</span></span> <span data-ttu-id="c25f7-110">Una transacción se considera una transacción distribuida cuando está coordinada por un monitor de transacciones y utiliza mecanismos de error (como confirmación en dos fases) para la resolución de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c25f7-110">A transaction is considered to be a distributed transaction when it is coordinated by a transaction monitor and uses fail-safe mechanisms (such as two-phase commit) for transaction resolution.</span></span>  
  
 <span data-ttu-id="c25f7-111">Cada uno de los proveedores de datos de .NET Framework tiene su propio `Transaction` objeto para realizar transacciones locales.</span><span class="sxs-lookup"><span data-stu-id="c25f7-111">Each of the .NET Framework data providers has its own `Transaction` object for performing local transactions.</span></span> <span data-ttu-id="c25f7-112">Si necesita que se realice una transacción en una base de datos de SQL Server, seleccione una transacción de <xref:System.Data.SqlClient>.</span><span class="sxs-lookup"><span data-stu-id="c25f7-112">If you require a transaction to be performed in a SQL Server database, select a <xref:System.Data.SqlClient> transaction.</span></span> <span data-ttu-id="c25f7-113">En transacciones de Oracle, utilice el proveedor <xref:System.Data.OracleClient>.</span><span class="sxs-lookup"><span data-stu-id="c25f7-113">For an Oracle transaction, use the <xref:System.Data.OracleClient> provider.</span></span> <span data-ttu-id="c25f7-114">Además, hay una <xref:System.Data.Common.DbTransaction> clase que está disponible para escribir código independiente del proveedor que requiere transacciones.</span><span class="sxs-lookup"><span data-stu-id="c25f7-114">In addition, there is a <xref:System.Data.Common.DbTransaction> class that is available for writing provider-independent code that requires transactions.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c25f7-115">Las transacciones son más eficaces cuando se realizan en el servidor.</span><span class="sxs-lookup"><span data-stu-id="c25f7-115">Transactions are most efficient when they are performed on the server.</span></span> <span data-ttu-id="c25f7-116">Si trabaja con una base de datos de SQL Server que hace uso masivo de transacciones explícitas, debería estudiar la posibilidad de escribirlas como procedimientos almacenados mediante la instrucción BEGIN TRANSACTION de Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="c25f7-116">If you are working with a SQL Server database that makes extensive use of explicit transactions, consider writing them as stored procedures using the Transact-SQL BEGIN TRANSACTION statement.</span></span>
  
## <a name="performing-a-transaction-using-a-single-connection"></a><span data-ttu-id="c25f7-117">Realización de una transacción mediante una única conexión</span><span class="sxs-lookup"><span data-stu-id="c25f7-117">Performing a Transaction Using a Single Connection</span></span>  

 <span data-ttu-id="c25f7-118">En ADO.NET, las transacciones se controlan con el `Connection` objeto.</span><span class="sxs-lookup"><span data-stu-id="c25f7-118">In ADO.NET, you control transactions with the `Connection` object.</span></span> <span data-ttu-id="c25f7-119">Puede iniciar una transacción local con el método `BeginTransaction`.</span><span class="sxs-lookup"><span data-stu-id="c25f7-119">You can initiate a local transaction with the `BeginTransaction` method.</span></span> <span data-ttu-id="c25f7-120">Una vez iniciada una transacción, puede inscribir un comando en esa transacción con la propiedad `Transaction` de un objeto `Command`.</span><span class="sxs-lookup"><span data-stu-id="c25f7-120">Once you have begun a transaction, you can enlist a command in that transaction with the `Transaction` property of a `Command` object.</span></span> <span data-ttu-id="c25f7-121">Luego, puede confirmar o revertir las modificaciones realizadas en el origen de datos según el resultado correcto o incorrecto de los componentes de la transacción.</span><span class="sxs-lookup"><span data-stu-id="c25f7-121">You can then commit or roll back modifications made at the data source based on the success or failure of the components of the transaction.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c25f7-122">El método `EnlistDistributedTransaction` no se debe emplear en transacciones locales.</span><span class="sxs-lookup"><span data-stu-id="c25f7-122">The `EnlistDistributedTransaction` method should not be used for a local transaction.</span></span>  
  
 <span data-ttu-id="c25f7-123">El ámbito de la transacción está limitado a la conexión.</span><span class="sxs-lookup"><span data-stu-id="c25f7-123">The scope of the transaction is limited to the connection.</span></span> <span data-ttu-id="c25f7-124">En el siguiente ejemplo se realiza una transacción explícita que consta de por dos comandos independientes en el bloque `try`.</span><span class="sxs-lookup"><span data-stu-id="c25f7-124">The following example performs an explicit transaction that consists of two separate commands in the `try` block.</span></span> <span data-ttu-id="c25f7-125">Los comandos ejecutan instrucciones INSERT en la tabla Production. ScrapReason de la base de datos de ejemplo AdventureWorks SQL Server, que se confirman si no se inicia ninguna excepción.</span><span class="sxs-lookup"><span data-stu-id="c25f7-125">The commands execute INSERT statements against the Production.ScrapReason table in the AdventureWorks SQL Server sample database, which are committed if no exceptions are thrown.</span></span> <span data-ttu-id="c25f7-126">El código del bloque `catch` revierte la transacción si se lanza una excepción.</span><span class="sxs-lookup"><span data-stu-id="c25f7-126">The code in the `catch` block rolls back the transaction if an exception is thrown.</span></span> <span data-ttu-id="c25f7-127">Si la transacción se anula o la conexión se cierra antes de que se haya completado la transacción, ésta se revierte automáticamente.</span><span class="sxs-lookup"><span data-stu-id="c25f7-127">If the transaction is aborted or the connection is closed before the transaction has completed, it is automatically rolled back.</span></span>  
  
## <a name="example"></a><span data-ttu-id="c25f7-128">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="c25f7-128">Example</span></span>  

 <span data-ttu-id="c25f7-129">Para llevar a cabo una transacción, siga estos pasos.</span><span class="sxs-lookup"><span data-stu-id="c25f7-129">Follow these steps to perform a transaction.</span></span>  
  
1. <span data-ttu-id="c25f7-130">Llame al método <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> del objeto <xref:System.Data.SqlClient.SqlConnection> para marcar el comienzo de la transacción.</span><span class="sxs-lookup"><span data-stu-id="c25f7-130">Call the <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> method of the <xref:System.Data.SqlClient.SqlConnection> object to mark the start of the transaction.</span></span> <span data-ttu-id="c25f7-131">El método <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> devuelve una referencia a la transacción.</span><span class="sxs-lookup"><span data-stu-id="c25f7-131">The <xref:System.Data.SqlClient.SqlConnection.BeginTransaction%2A> method returns a reference to the transaction.</span></span> <span data-ttu-id="c25f7-132">Esta referencia se asigna a los objetos <xref:System.Data.SqlClient.SqlCommand> que están inscritos en la transacción.</span><span class="sxs-lookup"><span data-stu-id="c25f7-132">This reference is assigned to the <xref:System.Data.SqlClient.SqlCommand> objects that are enlisted in the transaction.</span></span>  
  
2. <span data-ttu-id="c25f7-133">Asigne el objeto `Transaction` a la propiedad <xref:System.Data.SqlClient.SqlCommand.Transaction%2A> del objeto <xref:System.Data.SqlClient.SqlCommand> que se va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="c25f7-133">Assign the `Transaction` object to the <xref:System.Data.SqlClient.SqlCommand.Transaction%2A> property of the <xref:System.Data.SqlClient.SqlCommand> to be executed.</span></span> <span data-ttu-id="c25f7-134">Si el comando se ejecuta en una conexión con una transacción activa y el objeto `Transaction` no se ha asignado a la propiedad `Transaction` del objeto `Command`, se inicia una excepción.</span><span class="sxs-lookup"><span data-stu-id="c25f7-134">If a command is executed on a connection with an active transaction, and the `Transaction` object has not been assigned to the `Transaction` property of the `Command` object, an exception is thrown.</span></span>  
  
3. <span data-ttu-id="c25f7-135">Ejecute los comandos necesarios.</span><span class="sxs-lookup"><span data-stu-id="c25f7-135">Execute the required commands.</span></span>  
  
4. <span data-ttu-id="c25f7-136">Llame al método <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> del objeto <xref:System.Data.SqlClient.SqlTransaction> para completar la transacción, o al método <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> para finalizarla.</span><span class="sxs-lookup"><span data-stu-id="c25f7-136">Call the <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> method of the <xref:System.Data.SqlClient.SqlTransaction> object to complete the transaction, or call the <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> method to end the transaction.</span></span> <span data-ttu-id="c25f7-137">Si la conexión se cierra o elimina antes de que se hayan ejecutado los métodos <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> o <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A>, la transacción se revierte.</span><span class="sxs-lookup"><span data-stu-id="c25f7-137">If the connection is closed or disposed before either the <xref:System.Data.SqlClient.SqlTransaction.Commit%2A> or <xref:System.Data.SqlClient.SqlTransaction.Rollback%2A> methods have been executed, the transaction is rolled back.</span></span>  
  
 <span data-ttu-id="c25f7-138">En el ejemplo de código siguiente se muestra la lógica transaccional mediante ADO.NET con Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c25f7-138">The following code example demonstrates transactional logic using ADO.NET with Microsoft SQL Server.</span></span>  
  
 [!code-csharp[DataWorks SqlTransaction.Local#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlTransaction.Local/CS/source.cs#1)]
 [!code-vb[DataWorks SqlTransaction.Local#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlTransaction.Local/VB/source.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="c25f7-139">Consulte también</span><span class="sxs-lookup"><span data-stu-id="c25f7-139">See also</span></span>

- [<span data-ttu-id="c25f7-140">Transacciones y simultaneidad</span><span class="sxs-lookup"><span data-stu-id="c25f7-140">Transactions and Concurrency</span></span>](transactions-and-concurrency.md)
- [<span data-ttu-id="c25f7-141">Transacciones distribuidas</span><span class="sxs-lookup"><span data-stu-id="c25f7-141">Distributed Transactions</span></span>](distributed-transactions.md)
- [<span data-ttu-id="c25f7-142">Integración de System.Transactions con SQL Server</span><span class="sxs-lookup"><span data-stu-id="c25f7-142">System.Transactions Integration with SQL Server</span></span>](system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="c25f7-143">Información general de ADO.NET</span><span class="sxs-lookup"><span data-stu-id="c25f7-143">ADO.NET Overview</span></span>](ado-net-overview.md)
