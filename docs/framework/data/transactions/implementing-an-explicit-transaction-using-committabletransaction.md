---
title: Implementar una transacción explícita mediante una transacción confirmable
description: Implemente una transacción explícita mediante la clase CommittableTransaction en .NET. Esta clase proporciona una forma explícita de que las aplicaciones usen una transacción.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 29efe5e5-897b-46c2-a35f-e599a273acc8
ms.openlocfilehash: 7e1d78b581fcb3c4b2265f1d04cf2aba83faa28a
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/24/2020
ms.locfileid: "91182888"
---
# <a name="implementing-an-explicit-transaction-using-committabletransaction"></a><span data-ttu-id="b72ba-104">Implementar una transacción explícita mediante una transacción confirmable</span><span class="sxs-lookup"><span data-stu-id="b72ba-104">Implementing an Explicit Transaction using CommittableTransaction</span></span>

<span data-ttu-id="b72ba-105">La clase <xref:System.Transactions.CommittableTransaction> proporciona a las aplicaciones una manera explícita de utilizar una transacción, a diferencia de utilizar implícitamente la clase <xref:System.Transactions.TransactionScope>.</span><span class="sxs-lookup"><span data-stu-id="b72ba-105">The <xref:System.Transactions.CommittableTransaction> class provides an explicit way for applications to use a transaction, as opposed to using the <xref:System.Transactions.TransactionScope> class implicitly.</span></span> <span data-ttu-id="b72ba-106">Es útil para las aplicaciones que desean utilizar la misma transacción por varias llamadas de función o llamadas de subproceso múltiples.</span><span class="sxs-lookup"><span data-stu-id="b72ba-106">It is useful for applications that want to use the same transaction across multiple function calls or multiple thread calls.</span></span> <span data-ttu-id="b72ba-107">A diferencia de la clase <xref:System.Transactions.TransactionScope>, el sistema de escritura de la aplicación ha de llamar específicamente a los métodos <xref:System.Transactions.CommittableTransaction.Commit%2A> y <xref:System.Transactions.Transaction.Rollback%2A> para confirmar o anular la transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-107">Unlike the <xref:System.Transactions.TransactionScope> class, the application writer needs to specifically call the <xref:System.Transactions.CommittableTransaction.Commit%2A> and <xref:System.Transactions.Transaction.Rollback%2A> methods in order to commit or abort the transaction.</span></span>  
  
## <a name="overview-of-the-committabletransaction-class"></a><span data-ttu-id="b72ba-108">Información general sobre la clase CommittableTransaction.</span><span class="sxs-lookup"><span data-stu-id="b72ba-108">Overview of the CommittableTransaction class</span></span>  

 <span data-ttu-id="b72ba-109">La clase <xref:System.Transactions.CommittableTransaction> deriva de la clase <xref:System.Transactions.Transaction>, proporcionando, por consiguiente, toda la funcionalidad del último.</span><span class="sxs-lookup"><span data-stu-id="b72ba-109">The <xref:System.Transactions.CommittableTransaction> class derives from the <xref:System.Transactions.Transaction> class, therefore providing all the functionality of the latter.</span></span> <span data-ttu-id="b72ba-110">Específicamente útil es el método <xref:System.Transactions.Transaction.Rollback%2A> en la clase <xref:System.Transactions.Transaction> que también se puede utilizar para revertir un objeto <xref:System.Transactions.CommittableTransaction>.</span><span class="sxs-lookup"><span data-stu-id="b72ba-110">Specifically useful is the <xref:System.Transactions.Transaction.Rollback%2A> method on the <xref:System.Transactions.Transaction> class that can also be used to rollback a <xref:System.Transactions.CommittableTransaction> object.</span></span>  
  
 <span data-ttu-id="b72ba-111">La clase <xref:System.Transactions.Transaction> es similar a la clase <xref:System.Transactions.CommittableTransaction> pero no proporciona un método `Commit`.</span><span class="sxs-lookup"><span data-stu-id="b72ba-111">The  <xref:System.Transactions.Transaction> class is similar to the <xref:System.Transactions.CommittableTransaction> class but does not offer a `Commit` method.</span></span> <span data-ttu-id="b72ba-112">Esto le permite pasar el objeto de transacción (o clones de él) a otros métodos (potencialmente en otros subprocesos) mientras todavía se controla cuando se confirma la transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-112">This enables you to pass the transaction object (or clones of it) to other methods (potentially on other threads) while still controlling when the transaction is committed.</span></span> <span data-ttu-id="b72ba-113">El código llamado puede dar de alta y votar en la transacción, pero solo el creador del objeto <xref:System.Transactions.CommittableTransaction> tiene la capacidad de confirmar la transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-113">The called code is able to enlist and vote on the transaction, but only the creator of the <xref:System.Transactions.CommittableTransaction> object has the ability to commit the transaction.</span></span>  
  
 <span data-ttu-id="b72ba-114">Debe tener en cuenta lo siguiente cuando trabaje con la clase <xref:System.Transactions.CommittableTransaction>,</span><span class="sxs-lookup"><span data-stu-id="b72ba-114">You should note the followings when working with the <xref:System.Transactions.CommittableTransaction> class,</span></span>  
  
- <span data-ttu-id="b72ba-115">Al crear una transacción <xref:System.Transactions.CommittableTransaction>, no se establece la transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="b72ba-115">Creating a <xref:System.Transactions.CommittableTransaction> transaction does not set the ambient transaction.</span></span> <span data-ttu-id="b72ba-116">Tendrá que establecer y restablecer específicamente la transacción de ambiente con el fin de garantizar que los administradores de recursos funcionen bajo el contexto de transacción correcto cuando sea apropiado.</span><span class="sxs-lookup"><span data-stu-id="b72ba-116">You need to specifically set and reset the ambient transaction, to ensure that resource managers operate under the right transaction context when appropriate.</span></span> <span data-ttu-id="b72ba-117">La manera de establecer la transacción ambiente actual está estableciendo la propiedad <xref:System.Transactions.Transaction.Current%2A> estática en el objeto <xref:System.Transactions.Transaction> global.</span><span class="sxs-lookup"><span data-stu-id="b72ba-117">The way to set the current ambient transaction is by setting the static <xref:System.Transactions.Transaction.Current%2A> property on the global <xref:System.Transactions.Transaction> object.</span></span>  
  
- <span data-ttu-id="b72ba-118">No se puede reutilizar un objeto <xref:System.Transactions.CommittableTransaction>.</span><span class="sxs-lookup"><span data-stu-id="b72ba-118">A <xref:System.Transactions.CommittableTransaction> object cannot be reused.</span></span> <span data-ttu-id="b72ba-119">Una vez confirmado o revertido un objeto <xref:System.Transactions.CommittableTransaction>, no se puede utilizar de nuevo en una transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-119">Once a <xref:System.Transactions.CommittableTransaction> object has been committed or rolled back, it cannot be used again in a transaction.</span></span> <span data-ttu-id="b72ba-120">Es decir, no se puede establecer como el contexto de la transacción ambiente actual.</span><span class="sxs-lookup"><span data-stu-id="b72ba-120">That is, it cannot be set as the current ambient transaction context.</span></span>  
  
## <a name="creating-a-committabletransaction"></a><span data-ttu-id="b72ba-121">Crear un CommittableTransaction</span><span class="sxs-lookup"><span data-stu-id="b72ba-121">Creating a CommittableTransaction</span></span>  

 <span data-ttu-id="b72ba-122">En el ejemplo siguiente se crea una nueva instancia de <xref:System.Transactions.CommittableTransaction> y se confirma.</span><span class="sxs-lookup"><span data-stu-id="b72ba-122">The following sample creates a new <xref:System.Transactions.CommittableTransaction> and commits it.</span></span>  
  
 [!code-csharp[Tx_CommittableTx#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_committabletx/cs/committabletxwithsql.cs#1)]
 [!code-vb[Tx_CommittableTx#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_committabletx/vb/committabletxwithsql.vb#1)]  
  
 <span data-ttu-id="b72ba-123">Al crear una instancia de <xref:System.Transactions.CommittableTransaction>, no se establece automáticamente el contexto de la transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="b72ba-123">Creating an instance of <xref:System.Transactions.CommittableTransaction> does not automatically set the ambient transaction context.</span></span> <span data-ttu-id="b72ba-124">Por consiguiente, cualquier operación en un administrador de recursos no forma parte de esa transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-124">Therefore, any operation on a resource manager is not part of that transaction.</span></span> <span data-ttu-id="b72ba-125">La propiedad <xref:System.Transactions.Transaction.Current%2A> estática en el objeto <xref:System.Transactions.Transaction> global se utiliza para establecer o recuperar la transacción ambiente y la aplicación debe establecerlo manualmente para asegurarse de que los administradores de recursos pueden participar en la transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-125">The static <xref:System.Transactions.Transaction.Current%2A> property on the global <xref:System.Transactions.Transaction> object is used to set or retrieve the ambient transaction and the application must manually set it to ensure that resource managers can participate in the transaction.</span></span> <span data-ttu-id="b72ba-126">También es una práctica buena guardar la transacción ambiente anterior y restaurarla al terminar de utilizar el objeto <xref:System.Transactions.CommittableTransaction>.</span><span class="sxs-lookup"><span data-stu-id="b72ba-126">It is also a good practice to save the old ambient transaction and restore it when you finish using the <xref:System.Transactions.CommittableTransaction> object.</span></span>  
  
 <span data-ttu-id="b72ba-127">Para confirmar la transacción se necesita llamar explícitamente al método <xref:System.Transactions.CommittableTransaction.Commit%2A> .</span><span class="sxs-lookup"><span data-stu-id="b72ba-127">To commit the transaction, you need to explicitly call the <xref:System.Transactions.CommittableTransaction.Commit%2A> method.</span></span> <span data-ttu-id="b72ba-128">Para deshacer una transacción, debería llamar al método <xref:System.Transactions.Transaction.Rollback%2A>.</span><span class="sxs-lookup"><span data-stu-id="b72ba-128">For rolling back a transaction, you should call the <xref:System.Transactions.Transaction.Rollback%2A> method.</span></span> <span data-ttu-id="b72ba-129">Es importante tener en cuenta que hasta que <xref:System.Transactions.CommittableTransaction> se haya confirmado o revertido, se bloquean todos los recursos implicados todavía en esa transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-129">It is important to note that until a <xref:System.Transactions.CommittableTransaction> has been committed or rolled back, all the resources involved in that transaction are still locked.</span></span>  
  
 <span data-ttu-id="b72ba-130">Un objeto <xref:System.Transactions.CommittableTransaction> se puede utilizar por las llamadas de función y subprocesos.</span><span class="sxs-lookup"><span data-stu-id="b72ba-130">A <xref:System.Transactions.CommittableTransaction> object can be used across function calls and threads.</span></span> <span data-ttu-id="b72ba-131">Sin embargo, es tarea del desarrollador de aplicaciones administrar las excepciones y específicamente llamar al método <xref:System.Transactions.Transaction.Rollback%28System.Exception%29> en caso de error.</span><span class="sxs-lookup"><span data-stu-id="b72ba-131">However, it is up to the application developer to handle exceptions and specifically call the <xref:System.Transactions.Transaction.Rollback%28System.Exception%29> method in case of failures.</span></span>  
  
## <a name="asynchronous-commit"></a><span data-ttu-id="b72ba-132">Confirmación asincrónica</span><span class="sxs-lookup"><span data-stu-id="b72ba-132">Asynchronous Commit</span></span>  

 <span data-ttu-id="b72ba-133">La clase <xref:System.Transactions.CommittableTransaction> también proporciona un mecanismo para confirmar de forma asincrónica una transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-133">The <xref:System.Transactions.CommittableTransaction> class also provides a mechanism for committing a transaction asynchronously.</span></span> <span data-ttu-id="b72ba-134">Una confirmación de la transacción puede tardar un tiempo sustancial, al igual que podría implicar varios accesos a bases de datos y una posible latencia de red.</span><span class="sxs-lookup"><span data-stu-id="b72ba-134">A transaction commit can take substantial time, as it might involve multiple database access and possible network latency.</span></span> <span data-ttu-id="b72ba-135">Al desear evitar los interbloqueos en aplicaciones de alto rendimiento, puede utilizar la confirmación asincrónica para finalizar lo antes posible el trabajo transaccional y ejecutar la operación de la confirmación como una tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="b72ba-135">When you want to avoid deadlocks in high throughput applications, you can use asynchronous commit to finish the transactional work as soon as possible, and run the commit operation as a background task.</span></span> <span data-ttu-id="b72ba-136"><xref:System.Transactions.CommittableTransaction.BeginCommit%2A> y los métodos <xref:System.Transactions.CommittableTransaction.EndCommit%2A> de la clase <xref:System.Transactions.CommittableTransaction> le permiten esto.</span><span class="sxs-lookup"><span data-stu-id="b72ba-136">The <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> and <xref:System.Transactions.CommittableTransaction.EndCommit%2A> methods of the <xref:System.Transactions.CommittableTransaction> class allow you to do so.</span></span>  
  
 <span data-ttu-id="b72ba-137">Puede llamar <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> para enviar el retraso de la confirmación a un subproceso del grupo de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="b72ba-137">You can call <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> to dispatch the commit holdup to a thread from the thread pool.</span></span> <span data-ttu-id="b72ba-138">También puede llamar <xref:System.Transactions.CommittableTransaction.EndCommit%2A> para determinar si se ha confirmado la transacción realmente.</span><span class="sxs-lookup"><span data-stu-id="b72ba-138">You can also call <xref:System.Transactions.CommittableTransaction.EndCommit%2A> to determine if the transaction has actually been committed.</span></span> <span data-ttu-id="b72ba-139">Si la transacción no se confirma por cualquier razón, <xref:System.Transactions.CommittableTransaction.EndCommit%2A> se producirá una excepción de transacción.</span><span class="sxs-lookup"><span data-stu-id="b72ba-139">If the transaction failed to commit for whatever reason, <xref:System.Transactions.CommittableTransaction.EndCommit%2A> raises a transaction exception.</span></span> <span data-ttu-id="b72ba-140">Si no se confirma la transacción todavía cuando se llama <xref:System.Transactions.CommittableTransaction.EndCommit%2A>, se bloquea el llamador hasta que la transacción se confirme o anule.</span><span class="sxs-lookup"><span data-stu-id="b72ba-140">If the transaction is not yet committed by the time <xref:System.Transactions.CommittableTransaction.EndCommit%2A> is called, the caller is blocked until the transaction is committed or aborted.</span></span>  
  
 <span data-ttu-id="b72ba-141">La manera más fácil de hacer una confirmación asincrónica es proporcionando un método de devolución de llamada, para ser llamado cuando la confirmación esté terminada.</span><span class="sxs-lookup"><span data-stu-id="b72ba-141">The easiest way to do an asynchronous commit is by providing a callback method, to be called when committing is finished.</span></span> <span data-ttu-id="b72ba-142">Sin embargo, debe llamar al método <xref:System.Transactions.CommittableTransaction.EndCommit%2A> en el objeto <xref:System.Transactions.CommittableTransaction> original utilizado para invocar la llamada.</span><span class="sxs-lookup"><span data-stu-id="b72ba-142">However, you must call the <xref:System.Transactions.CommittableTransaction.EndCommit%2A> method on the original <xref:System.Transactions.CommittableTransaction> object used to invoke the call.</span></span> <span data-ttu-id="b72ba-143">Para obtener ese objeto, puede convertir en un nivel inferior el parámetro *IAsyncResult* del método de devolución de llamada, ya que la <xref:System.Transactions.CommittableTransaction> clase implementa la <xref:System.IAsyncResult> clase.</span><span class="sxs-lookup"><span data-stu-id="b72ba-143">To obtain that object, you can downcast the *IAsyncResult* parameter of the callback method, since the <xref:System.Transactions.CommittableTransaction> class implements <xref:System.IAsyncResult> class.</span></span>  
  
 <span data-ttu-id="b72ba-144">El ejemplo siguiente muestra cómo se puede hacer una confirmación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="b72ba-144">The following example shows how an asynchronous commit can be done.</span></span>  
  
```csharp  
public void DoTransactionalWork()  
{  
     Transaction oldAmbient = Transaction.Current;  
     CommittableTransaction committableTransaction = new CommittableTransaction();  
     Transaction.Current = committableTransaction;  
  
     try  
     {  
          /* Perform transactional work here */  
          // No errors - commit transaction asynchronously  
          committableTransaction.BeginCommit(OnCommitted,null);  
     }  
     finally  
     {  
          //Restore the ambient transaction
          Transaction.Current = oldAmbient;  
     }  
}  
void OnCommitted(IAsyncResult asyncResult)  
{  
     CommittableTransaction committableTransaction;  
     committableTransaction = asyncResult as CommittableTransaction;
     Debug.Assert(committableTransaction != null);  
     try  
     {  
          using(committableTransaction)  
          {  
               committableTransaction.EndCommit(asyncResult);  
          }  
     }  
     catch(TransactionException e)  
     {  
          //Handle the failure to commit  
     }  
}  
```  
  
## <a name="see-also"></a><span data-ttu-id="b72ba-145">Consulte también</span><span class="sxs-lookup"><span data-stu-id="b72ba-145">See also</span></span>

- [<span data-ttu-id="b72ba-146">Implementar una transacción implícita mediante el ámbito de la transacción</span><span class="sxs-lookup"><span data-stu-id="b72ba-146">Implementing an Implicit Transaction using Transaction Scope</span></span>](implementing-an-implicit-transaction-using-transaction-scope.md)
- [<span data-ttu-id="b72ba-147">Procesar transacciones</span><span class="sxs-lookup"><span data-stu-id="b72ba-147">Transaction Processing</span></span>](index.md)
