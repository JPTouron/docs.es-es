---
title: Implementar un administrador de recursos
description: Implemente un administrador de recursos en .NET. Un administrador de recursos administra los recursos utilizados en las transacciones. Un administrador de transacciones coordina las acciones del administrador de recursos.
ms.date: 03/30/2017
ms.assetid: d5c153f6-4419-49e3-a5f1-a50ae4c81bf3
ms.openlocfilehash: bf40c6eaee35a5a548c6de4a286e46c4d4a66aca
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141854"
---
# <a name="implementing-a-resource-manager"></a><span data-ttu-id="11ea6-105">Implementar un administrador de recursos</span><span class="sxs-lookup"><span data-stu-id="11ea6-105">Implementing a Resource Manager</span></span>
<span data-ttu-id="11ea6-106">Un administrador de recursos administra cada recurso utilizado, cuyas acciones coordina un administrador de transacciones. </span><span class="sxs-lookup"><span data-stu-id="11ea6-106">Each resource used in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="11ea6-107">Los administradores de recursos trabajan en cooperación con el administrador de transacciones para proporcionar una garantía de atomicidad y aislamiento a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="11ea6-107">Resource managers work in cooperation with the transaction manager to provide the application with a guarantee of atomicity and isolation.</span></span> <span data-ttu-id="11ea6-108">Microsoft SQL Server, colas de mensajes durables, las tablas hash en memoria, son ejemplos de administradores de recursos.</span><span class="sxs-lookup"><span data-stu-id="11ea6-108">Microsoft SQL Server, durable message queues, in-memory hash tables are all examples of resource managers.</span></span>  
  
 <span data-ttu-id="11ea6-109">Un administrador de recursos administra los datos duraderos o volátiles.</span><span class="sxs-lookup"><span data-stu-id="11ea6-109">A resource manager manages either durable or volatile data.</span></span> <span data-ttu-id="11ea6-110">La duración (o a la inversa la volatilidad) de un administrador de recursos hace referencia a si el administrador de recursos admite la recuperación del error.</span><span class="sxs-lookup"><span data-stu-id="11ea6-110">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="11ea6-111">Si un administrador de recursos admite la recuperación del error, conserva los datos del almacenamiento duradero durante la fase1 (preparación) de tal manera que si el administrador de recursos baja, puede reenganchar la transacción en la recuperación y realizar las acciones apropiadas basadas en las notificaciones recibidas del administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="11ea6-111">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the transaction manager.</span></span> <span data-ttu-id="11ea6-112">En general, los administradores de recursos volátiles administran recursos volátiles como una estructura de datos en memoria (por ejemplo, una tabla hash llevada a cabo en memoria) y los administradores de recursos duraderos administran recursos que tienen una memoria auxiliar más persistente (por ejemplo, una base de datos cuyo dispositivo de copia de seguridad es el disco).</span><span class="sxs-lookup"><span data-stu-id="11ea6-112">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>  
  
 <span data-ttu-id="11ea6-113">Para que un administrador de recursos participe en una transacción, debe inscribirse en la transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-113">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="11ea6-114">La <xref:System.Transactions.Transaction> clase define un conjunto de métodos cuyos nombres comienzan por **dar de alta** que proporcionan esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="11ea6-114">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="11ea6-115">Los diferentes métodos de **inscripción** se corresponden con los distintos tipos de inscripción que puede tener un administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="11ea6-115">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="11ea6-116">Específicamente, utiliza los métodos <xref:System.Transactions.Transaction.EnlistVolatile%2A> para los recursos volátiles y el método <xref:System.Transactions.Transaction.EnlistDurable%2A> para los recursos duraderos.</span><span class="sxs-lookup"><span data-stu-id="11ea6-116">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="11ea6-117">Para simplificar, después de decidir si utilizar el método<xref:System.Transactions.Transaction.EnlistDurable%2A> o <xref:System.Transactions.Transaction.EnlistVolatile%2A> basado en la compatibilidad de la duración de su recurso, debería dar de alta su recurso para participar en la confirmación en dos fases (2PC) implementando la interfaz <xref:System.Transactions.IEnlistmentNotification> para su administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="11ea6-117">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="11ea6-118">Para obtener más información sobre 2PC, consulte [confirmar una transacción en una sola fase y varias fases](committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="11ea6-118">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>  
  
 <span data-ttu-id="11ea6-119">Dando de alta, el administrador de recursos se asegura de que recibe las devoluciones de llamada del administrador de transacciones cuando la transacción se confirma o interrumpe.</span><span class="sxs-lookup"><span data-stu-id="11ea6-119">By enlisting, the resource manager ensures that it gets callbacks from the transaction manager when the transaction commits or aborts.</span></span> <span data-ttu-id="11ea6-120">Hay una instancia de <xref:System.Transactions.IEnlistmentNotification> por la inscripción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-120">There is one instance of <xref:System.Transactions.IEnlistmentNotification> per enlistment.</span></span> <span data-ttu-id="11ea6-121">Hay normalmente, una inscripción por la transacción, pero un administrador de recursos puede decidir darse de alta varias veces en la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-121">Typically, there is one enlistment per transaction, but a resource manager can choose to enlist multiple times in the same transaction.</span></span>  
  
 <span data-ttu-id="11ea6-122">Después de la inscripción, el administrador de recursos responde a las solicitudes de la transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-122">After enlistment, the resource manager responds to the transaction's requests.</span></span> <span data-ttu-id="11ea6-123">Un administrador de recursos duradero almacena bastante información para permitir que deshaga o rehaga el trabajo de la transacción de los recursos que él administra.</span><span class="sxs-lookup"><span data-stu-id="11ea6-123">A durable resource manager stores enough information to allow it to either undo or redo the transaction's work on resources it manages.</span></span> <span data-ttu-id="11ea6-124">Hay muchas maneras para ello; manteniendo versiones de datos o manteniendo un registro de los cambios son dos técnicas comunes.</span><span class="sxs-lookup"><span data-stu-id="11ea6-124">There are many ways to do this; keeping versions of data or keeping a log of the changes are two common techniques.</span></span>  
  
 <span data-ttu-id="11ea6-125">Cuando la aplicación confirma la transacción, el administrador de transacciones inicia el protocolo de confirmación en dos fases.</span><span class="sxs-lookup"><span data-stu-id="11ea6-125">When the application commits the transaction, the transaction manager initiates the two-phase commit protocol.</span></span> <span data-ttu-id="11ea6-126">El administrador de transacciones pregunta primero a cada administrador de recursos inscrito si está preparado para confirmar la transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-126">The transaction manager first asks each enlisted resource manager if it is prepared to commit the transaction.</span></span> <span data-ttu-id="11ea6-127">El administrador de recursos debe prepararse para confirmar o anular la transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-127">The resource manager must prepare to commit—it readies itself to either commit or abort the transaction.</span></span>  
  
 <span data-ttu-id="11ea6-128">Durante la fase de preparación, el administrador de recursos duraderos graba los datos anteriores y nuevos en almacenamiento estable para que el administrador de recursos pueda recuperarlos incluso cuando se produzca un error en el sistema.</span><span class="sxs-lookup"><span data-stu-id="11ea6-128">During the prepare phase, the durable resource manager records the old and new data in stable storage so that the resource manager can recover it even if the system fails.</span></span> <span data-ttu-id="11ea6-129">Si el administrador de recursos puede prepararse, informa sobre su voto al administrador de transacciones si va a confirmar o anular la transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-129">If the resource manager can prepare, it informs the transaction manager its vote on whether to commit or abort the transaction.</span></span> <span data-ttu-id="11ea6-130">Si cualquier administrador de recursos informa de un error para preparar, el administrador de transacciones envía un comando de recuperación a cada administrador de recursos e indica el error de la confirmación a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="11ea6-130">If any resource manager reports a failure to prepare, the transaction manager sends a rollback command to each resource manager and indicates the failure of the commit to the application.</span></span>  
  
 <span data-ttu-id="11ea6-131">Una vez preparado, un administrador de recursos debe esperar hasta que reciba una devolución de llamada de confirmación o de interrupción del administrador de transacciones en la fase 2.</span><span class="sxs-lookup"><span data-stu-id="11ea6-131">Once prepared, a resource manager must wait until it gets a commit or abort callback from the transaction manager in phase 2.</span></span> <span data-ttu-id="11ea6-132">Normalmente, todo el protocolo de confirmación y preparación se completa en una fracción de un segundo.</span><span class="sxs-lookup"><span data-stu-id="11ea6-132">Typically, the entire prepare and commit protocol completes in a fraction of a second.</span></span> <span data-ttu-id="11ea6-133">Si hay sistema o errores de comunicación, la confirmación o anulación de la notificación no puede llegar durante minutos u horas.</span><span class="sxs-lookup"><span data-stu-id="11ea6-133">If there are system or communication failures, the commit or abort notification may not arrive for minutes or hours.</span></span> <span data-ttu-id="11ea6-134">Durante este período, el administrador de recursos está en duda sobre el resultado de la transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-134">During this period, the resource manager is in doubt about the outcome of the transaction.</span></span> <span data-ttu-id="11ea6-135">No sabe si la transacción se confirmó o se anuló.</span><span class="sxs-lookup"><span data-stu-id="11ea6-135">It does not know whether the transaction committed or aborted.</span></span> <span data-ttu-id="11ea6-136">Aunque el administrador de recursos está en duda sobre una transacción, mantiene los datos modificados manteniendo la transacción bloqueada, aislando por eso estos cambios de cualquier otra transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-136">While the resource manager is in doubt about a transaction, it keeps the data modified by keeping the transaction locked, thereby isolating these changes from any other transactions.</span></span>  
  
 <span data-ttu-id="11ea6-137">Cuando se produce un error en un administrador de recursos, todas sus transacciones inscritas se anulan salvo aquellas que se preparan o se confirman antes del error.</span><span class="sxs-lookup"><span data-stu-id="11ea6-137">When a resource manager fails, all of its enlisted transactions are aborted except for those that are prepared or committed prior to the failure.</span></span> <span data-ttu-id="11ea6-138">Cuando un administrador de recursos duraderos se reinicia, se reconstruye el estado confirmado de los recursos que administra recuperando la información de preparación escrita la fase de preparación y confirma o anula de acuerdo con estas transacciones.</span><span class="sxs-lookup"><span data-stu-id="11ea6-138">When a durable resource manager restarts, it reconstructs the committed state of the resources it manages by retrieving the prepare information written in the prepare phase, and commits or aborts these transactions accordingly.</span></span>  
  
 <span data-ttu-id="11ea6-139">En resumen, el protocolo de confirmación en dos fases y los administradores de recursos se combinan para hacer las transacciones atómicas y duraderas.</span><span class="sxs-lookup"><span data-stu-id="11ea6-139">In summary, the two-phase commit protocol and the resource managers combine to make transactions atomic and durable.</span></span>  
  
 <span data-ttu-id="11ea6-140">La clase <xref:System.Transactions.Transaction> también proporciona el método <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> para dar de alta una Inscripción de fase única promocional (PSPE).</span><span class="sxs-lookup"><span data-stu-id="11ea6-140">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="11ea6-141">Esto permite a un administrador de recursos duradero (RM) hospedar y "poseer" una transacción que puede realizar una escalada para que sea administrada por MSDTC si es necesario.</span><span class="sxs-lookup"><span data-stu-id="11ea6-141">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="11ea6-142">Para obtener más información, consulte [optimización mediante la confirmación de fase única y la notificación de fase única promocionable](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="11ea6-142">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="11ea6-143">En esta sección</span><span class="sxs-lookup"><span data-stu-id="11ea6-143">In This Section</span></span>  
 <span data-ttu-id="11ea6-144">Los pasos generalmente seguidos por un administrador de recursos se describen en los temas siguientes.</span><span class="sxs-lookup"><span data-stu-id="11ea6-144">The steps generally followed by a resource manager are outlined in the following topics.</span></span>  
  
 [<span data-ttu-id="11ea6-145">Dar de alta los recursos como participantes en una transacción</span><span class="sxs-lookup"><span data-stu-id="11ea6-145">Enlisting Resources as Participants in a Transaction</span></span>](enlisting-resources-as-participants-in-a-transaction.md)  
  
 <span data-ttu-id="11ea6-146">Describe cómo un recurso duradero o volátil puede darse de alta en una transacción.</span><span class="sxs-lookup"><span data-stu-id="11ea6-146">Describes how a durable or volatile resource can enlist in a transaction.</span></span>  
  
 [<span data-ttu-id="11ea6-147">Confirmar una transacción en fase única y múltiple</span><span class="sxs-lookup"><span data-stu-id="11ea6-147">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](committing-a-transaction-in-single-phase-and-multi-phase.md)  
  
 <span data-ttu-id="11ea6-148">Describe cómo un administrador de recursos responde para confirmar la notificación y preparar la confirmación.</span><span class="sxs-lookup"><span data-stu-id="11ea6-148">Describes how a resource manager responds to commit notification and prepare the commit.</span></span>  
  
 [<span data-ttu-id="11ea6-149">Realizar la recuperación</span><span class="sxs-lookup"><span data-stu-id="11ea6-149">Performing Recovery</span></span>](performing-recovery.md)  
  
 <span data-ttu-id="11ea6-150">Describe cómo un administrador de recursos duradero se recupera del error.</span><span class="sxs-lookup"><span data-stu-id="11ea6-150">Describes how a durable resource manager recovers from failure.</span></span>  
  
 [<span data-ttu-id="11ea6-151">Niveles de confianza de seguridad para acceder a los recursos</span><span class="sxs-lookup"><span data-stu-id="11ea6-151">Security Trust Levels in Accessing Resources</span></span>](security-trust-levels-in-accessing-resources.md)  
  
 <span data-ttu-id="11ea6-152">Define cómo tres niveles de confianza para System.Transactions restringen el acceso a los tipos de recursos que <xref:System.Transactions> expone.</span><span class="sxs-lookup"><span data-stu-id="11ea6-152">Describes how the three levels of trust for System.Transactions restrict access on the types of resources that <xref:System.Transactions> exposes.</span></span>  
  
 [<span data-ttu-id="11ea6-153">Optimización mediante el uso de la confirmación de fase única y de la inscripción de fase única promovible</span><span class="sxs-lookup"><span data-stu-id="11ea6-153">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](optimization-spc-and-promotable-spn.md)  
  
 <span data-ttu-id="11ea6-154">Describe los ejercicios de la optimización disponible sobre las implementaciones de administradores de recursos.</span><span class="sxs-lookup"><span data-stu-id="11ea6-154">Describes optimization practices available to implementations of resource managers.</span></span>
