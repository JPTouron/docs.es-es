---
title: Implementar una transacción implícita mediante el ámbito de la transacción
description: Implemente una transacción implícita mediante la clase TransactionScope en .NET. Esta clase proporciona una manera de marcar un bloque de código como participante en una transacción.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 49d1706a-1e0c-4c85-9704-75c908372eb9
ms.openlocfilehash: ff2fe64156d5d72773549d78b2e29631905cbb10
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/24/2020
ms.locfileid: "91186866"
---
# <a name="implementing-an-implicit-transaction-using-transaction-scope"></a><span data-ttu-id="fb0ee-104">Implementar una transacción implícita mediante el ámbito de la transacción</span><span class="sxs-lookup"><span data-stu-id="fb0ee-104">Implementing an Implicit Transaction using Transaction Scope</span></span>

<span data-ttu-id="fb0ee-105">La clase <xref:System.Transactions.TransactionScope> proporciona una manera simple de marcar un bloque de código como participar en una transacción, sin exigirle que interactuara con la propia transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-105">The <xref:System.Transactions.TransactionScope> class provides a simple way to mark a block of code as participating in a transaction, without requiring you to interact with the transaction itself.</span></span> <span data-ttu-id="fb0ee-106">Un ámbito de la transacción puede seleccionar y administrar automáticamente la transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-106">A transaction scope can select and manage the ambient transaction automatically.</span></span> <span data-ttu-id="fb0ee-107">Debido a su facilidad de uso y eficacia, se recomienda que utilice la clase <xref:System.Transactions.TransactionScope> al desarrollar una aplicación de transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-107">Due to its ease of use and efficiency, it is recommended that you use the <xref:System.Transactions.TransactionScope> class when developing a transaction application.</span></span>  
  
 <span data-ttu-id="fb0ee-108">Además, no necesita dar de alta explícitamente los recursos con la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-108">In addition, you do not need to enlist resources explicitly with the transaction.</span></span> <span data-ttu-id="fb0ee-109">Cualquier administrador de recursos <xref:System.Transactions> (como SQL Server 2005) puede detectar la existencia de una transacción ambiente creada por el ámbito y automáticamente darse de alta.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-109">Any <xref:System.Transactions> resource manager (such as SQL Server 2005) can detect the existence of an ambient transaction created by the scope and automatically enlist.</span></span>  
  
## <a name="creating-a-transaction-scope"></a><span data-ttu-id="fb0ee-110">Crear un ámbito de la transacción</span><span class="sxs-lookup"><span data-stu-id="fb0ee-110">Creating a transaction scope</span></span>  

 <span data-ttu-id="fb0ee-111">En el ejemplo siguiente se muestra un uso sencillo de la clase <xref:System.Transactions.TransactionScope>.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-111">The following sample shows a simple usage of the <xref:System.Transactions.TransactionScope> class.</span></span>  
  
 [!code-csharp[TransactionScope#1](../../../../samples/snippets/csharp/VS_Snippets_Remoting/TransactionScope/cs/ScopeWithSQL.cs#1)]
 [!code-vb[TransactionScope#1](../../../../samples/snippets/visualbasic/VS_Snippets_Remoting/TransactionScope/vb/ScopeWithSQL.vb#1)]  
  
 <span data-ttu-id="fb0ee-112">El ambiente de transacción ha comenzado una vez que se ha creado un nuevo objeto <xref:System.Transactions.TransactionScope> .</span><span class="sxs-lookup"><span data-stu-id="fb0ee-112">The transaction scope is started once you create a new <xref:System.Transactions.TransactionScope> object.</span></span>  <span data-ttu-id="fb0ee-113">Como se muestra en el ejemplo de código, se recomienda crear ámbitos con una `using` instrucción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-113">As illustrated in the code sample, it is recommended that you create scopes with a `using` statement.</span></span> <span data-ttu-id="fb0ee-114">La `using` instrucción está disponible tanto en C# como en Visual Basic y funciona como un `try` bloque... `finally` para asegurarse de que el ámbito se elimina correctamente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-114">The `using` statement is available both in C# and in Visual Basic, and works like a `try`...`finally` block to ensure that the scope is disposed of properly.</span></span>  
  
 <span data-ttu-id="fb0ee-115">Al crear una instancia de <xref:System.Transactions.TransactionScope>, el administrador de transacciones determina en qué transacción participar.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-115">When you instantiate <xref:System.Transactions.TransactionScope>, the transaction manager determines which transaction to participate in.</span></span> <span data-ttu-id="fb0ee-116">Una vez determinado, el ámbito siempre participa en esa transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-116">Once determined, the scope always participates in that transaction.</span></span> <span data-ttu-id="fb0ee-117">La decisión se basa en dos factores: si está presente una transacción de ambiente y el valor del parámetro `TransactionScopeOption` del constructor.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-117">The decision is based on two factors: whether an ambient transaction is present and the value of the `TransactionScopeOption` parameter in the constructor.</span></span> <span data-ttu-id="fb0ee-118">La transacción ambiente es la transacción dentro de la que su código se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-118">The ambient transaction is the transaction within which your code executes.</span></span> <span data-ttu-id="fb0ee-119">Puede obtener una referencia a la transacción ambiente llamando a la propiedad estática <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType> de la clase <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-119">You can obtain a reference to the ambient transaction by calling the static <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType> property of the <xref:System.Transactions.Transaction> class.</span></span> <span data-ttu-id="fb0ee-120">Para obtener más información sobre cómo se usa este parámetro, consulte la sección Administración del flujo de la [transacción mediante TransactionScopeOption](#ManageTxFlow) de este tema.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-120">For more information on how this parameter is used, see the [Managing transaction flow using TransactionScopeOption](#ManageTxFlow) section of this topic.</span></span>  
  
## <a name="completing-a-transaction-scope"></a><span data-ttu-id="fb0ee-121">Completar un ámbito de la transacción</span><span class="sxs-lookup"><span data-stu-id="fb0ee-121">Completing a transaction scope</span></span>  

 <span data-ttu-id="fb0ee-122">Cuando la aplicación termina todo el trabajo que tiene que llevar a cabo en una transacción, debe llamar al método <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWithType> solo una vez para notificar al administrador de transacciones que la transacción se puede confirmar.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-122">When your application completes all the work it wants to perform in a transaction, you should call the <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWithType> method only once to inform the transaction manager that it is acceptable to commit the transaction.</span></span> <span data-ttu-id="fb0ee-123">Es muy recomendable poner la llamada a <xref:System.Transactions.TransactionScope.Complete%2A> como la última instrucción del `using` bloque.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-123">It is very good practice to put the call to <xref:System.Transactions.TransactionScope.Complete%2A> as the last statement in the `using` block.</span></span>  
  
 <span data-ttu-id="fb0ee-124">Si no se llama a este método, se anula la transacción, porque el administrador de transacciones lo interpreta como un error del sistema o equivalente a una excepción iniciada en el ámbito de la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-124">Failing to call this method aborts the transaction, because the transaction manager interprets this as a system failure, or equivalent to an exception thrown within the scope of the transaction.</span></span> <span data-ttu-id="fb0ee-125">Sin embargo, llamar a este método no garantiza que se vaya a confirmar la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-125">However, calling this method does not guarantee that the transaction wil be committed.</span></span> <span data-ttu-id="fb0ee-126">Es solo una manera de informar al administrador de transacciones de su estado.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-126">It is merely a way of informing the transaction manager of your status.</span></span> <span data-ttu-id="fb0ee-127">Después de llamar a este método<xref:System.Transactions.TransactionScope.Complete%2A> ya no podrá obtener acceso a la transacción de ambiente mediante la propiedad <xref:System.Transactions.Transaction.Current%2A> y, si intenta hacerlo, se producirá una excepción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-127">After calling the <xref:System.Transactions.TransactionScope.Complete%2A> method, you can no longer access the ambient transaction by using the <xref:System.Transactions.Transaction.Current%2A> property, and attempting to do so will result in an exception being thrown.</span></span>  
  
 <span data-ttu-id="fb0ee-128">Si el <xref:System.Transactions.TransactionScope> objeto creó la transacción inicialmente, el trabajo real de confirmación de la transacción por parte del administrador de transacciones se produce después de la última línea de código del `using` bloque.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-128">If the <xref:System.Transactions.TransactionScope> object created the transaction initially, the actual work of committing the transaction by the transaction manager occurs after the last line of code in the `using` block.</span></span> <span data-ttu-id="fb0ee-129">Si no ha creado la transacción, se produce la confirmación cada vez que el propietario del objeto <xref:System.Transactions.CommittableTransaction.Commit%2A> llama al método <xref:System.Transactions.CommittableTransaction>.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-129">If it did not create the transaction, the commit occurs whenever <xref:System.Transactions.CommittableTransaction.Commit%2A> is called by the owner of the <xref:System.Transactions.CommittableTransaction> object.</span></span> <span data-ttu-id="fb0ee-130">En ese momento, el administrador de transacciones llama a los administradores de recursos y les informa de la confirmación o la reversión, en función de si <xref:System.Transactions.TransactionScope.Complete%2A> se llamó al método en el <xref:System.Transactions.TransactionScope> objeto.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-130">At that point the transaction manager calls the resource managers and informs them to either commit or rollback, based on whether the <xref:System.Transactions.TransactionScope.Complete%2A> method was called on the <xref:System.Transactions.TransactionScope> object.</span></span>  
  
 <span data-ttu-id="fb0ee-131">La `using` instrucción garantiza que <xref:System.Transactions.TransactionScope.Dispose%2A> se llame al método del <xref:System.Transactions.TransactionScope> objeto incluso si se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-131">The `using` statement ensures that the <xref:System.Transactions.TransactionScope.Dispose%2A> method of the <xref:System.Transactions.TransactionScope> object is called even if an exception occurs.</span></span> <span data-ttu-id="fb0ee-132">El método <xref:System.Transactions.TransactionScope.Dispose%2A> marca el fin del ámbito de la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-132">The <xref:System.Transactions.TransactionScope.Dispose%2A> method marks the end of the transaction scope.</span></span> <span data-ttu-id="fb0ee-133">Las excepciones que se producen después de llamar a este método quizá no afecten a la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-133">Exceptions that occur after calling this method may not affect the transaction.</span></span> <span data-ttu-id="fb0ee-134">Este método también restaura la transacción de ambiente a su estado previo.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-134">This method also restores the ambient transaction to it previous state.</span></span>  
  
 <span data-ttu-id="fb0ee-135">Se inicia <xref:System.Transactions.TransactionAbortedException> si el ámbito crea la transacción, y ésta se anula.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-135">A <xref:System.Transactions.TransactionAbortedException> is thrown if the scope creates the transaction, and the transaction is aborted.</span></span> <span data-ttu-id="fb0ee-136">Se inicia <xref:System.Transactions.TransactionInDoubtException> si el administrador de transacciones no puede llegar a una decisión de la confirmación.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-136">A <xref:System.Transactions.TransactionInDoubtException> is thrown if the transaction manager cannot reach a Commit decision.</span></span> <span data-ttu-id="fb0ee-137">No se produce ninguna excepción si se confirma la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-137">No exception is thrown if the transaction is committed.</span></span>  
  
## <a name="rolling-back-a-transaction"></a><span data-ttu-id="fb0ee-138">Revertir una transacción</span><span class="sxs-lookup"><span data-stu-id="fb0ee-138">Rolling back a transaction</span></span>  

 <span data-ttu-id="fb0ee-139">Si desea revertir una transacción, no debería llamar al método <xref:System.Transactions.TransactionScope.Complete%2A> dentro del ámbito de la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-139">If you want to rollback a transaction, you should not call the <xref:System.Transactions.TransactionScope.Complete%2A> method within the transaction scope.</span></span> <span data-ttu-id="fb0ee-140">Por ejemplo, puede producir una excepción dentro del ámbito.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-140">For example, you can throw an exception within the scope.</span></span> <span data-ttu-id="fb0ee-141">Se deshará la transacción en la que participa.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-141">The transaction in which it participates in will be rolled back.</span></span>  
  
## <a name="managing-transaction-flow-using-transactionscopeoption"></a><a name="ManageTxFlow"></a> <span data-ttu-id="fb0ee-142">Administrar el flujo de la transacción mediante TransactionScopeOption</span><span class="sxs-lookup"><span data-stu-id="fb0ee-142">Managing transaction flow using TransactionScopeOption</span></span>  

 <span data-ttu-id="fb0ee-143">El ámbito de la transacción puede estar anidado al llamar a un método que utiliza desde dentro <xref:System.Transactions.TransactionScope> un método que utiliza su propio ámbito, como es el caso con el método `RootMethod` en el ejemplo siguiente,</span><span class="sxs-lookup"><span data-stu-id="fb0ee-143">Transaction scope can be nested by calling a method that uses a <xref:System.Transactions.TransactionScope> from within a method that uses its own scope, as is the case with the `RootMethod` method in the following example,</span></span>  
  
```csharp  
void RootMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        SomeMethod();
        scope.Complete();
    }
}

void SomeMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        scope.Complete();
    }
}
```  
  
 <span data-ttu-id="fb0ee-144">El ámbito de la transacción de nivel superior se conoce como el ámbito de la raíz.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-144">The top-most transaction scope is referred to as the root scope.</span></span>  
  
 <span data-ttu-id="fb0ee-145">La clase <xref:System.Transactions.TransactionScope> proporciona varios constructores sobrecargados que aceptan una enumeración del tipo <xref:System.Transactions.TransactionScopeOption>, que define el comportamiento transaccional del ámbito.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-145">The <xref:System.Transactions.TransactionScope> class provides several overloaded constructors that accept an enumeration of the type <xref:System.Transactions.TransactionScopeOption>, which defines the transactional behavior of the scope.</span></span>  
  
 <span data-ttu-id="fb0ee-146">Un objeto <xref:System.Transactions.TransactionScope> tiene tres opciones:</span><span class="sxs-lookup"><span data-stu-id="fb0ee-146">A <xref:System.Transactions.TransactionScope> object has three options:</span></span>  
  
- <span data-ttu-id="fb0ee-147">Unir la transacción ambiente o crear una nueva si no existe.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-147">Join the ambient transaction, or create a new one if one does not exist.</span></span>  
  
- <span data-ttu-id="fb0ee-148">Ser un nuevo ámbito de la raíz, eso es, iniciar una nueva transacción y tener esa transacción siendo la nueva transacción ambiente dentro de su propio ámbito.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-148">Be a new root scope, that is, start a new transaction and have that transaction be the new ambient transaction inside its own scope.</span></span>  
  
- <span data-ttu-id="fb0ee-149">No tomar parte en absoluto en una transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-149">Not take part in a transaction at all.</span></span> <span data-ttu-id="fb0ee-150">Como resultado, no hay ninguna transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-150">There is no ambient transaction as a result.</span></span>  
  
 <span data-ttu-id="fb0ee-151">Si se crean instancias del ámbito con <xref:System.Transactions.TransactionScopeOption.Required>, y una transacción ambiente está presente, el ámbito combina dicha transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-151">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Required>, and an ambient transaction is present, the scope joins that transaction.</span></span> <span data-ttu-id="fb0ee-152">Si, por otro lado, no hay ninguna transacción ambiente, a continuación, el ámbito crea una nueva transacción y se vuelve el ámbito de la raíz.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-152">If, on the other hand, there is no ambient transaction, then the scope creates a new transaction, and become the root scope.</span></span> <span data-ttu-id="fb0ee-153">Este es el valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-153">This is the default value.</span></span> <span data-ttu-id="fb0ee-154">Cuando se utiliza <xref:System.Transactions.TransactionScopeOption.Required>, el código dentro del ámbito no necesita comportarse de manera diferente si es la raíz o simplemente uniendo la transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-154">When <xref:System.Transactions.TransactionScopeOption.Required> is used, the code inside the scope does not need to behave differently whether it is the root or just joining the ambient transaction.</span></span> <span data-ttu-id="fb0ee-155">Debería funcionar idénticamente en ambos casos.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-155">It should operate identically in both cases.</span></span>  
  
 <span data-ttu-id="fb0ee-156">Si se crean instancias del ámbito con <xref:System.Transactions.TransactionScopeOption.RequiresNew>, siempre es el ámbito de la raíz.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-156">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.RequiresNew>, it is always the root scope.</span></span> <span data-ttu-id="fb0ee-157">Inicia una nueva transacción y su transacción se vuelve la nueva transacción ambiente dentro del ámbito.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-157">It starts a new transaction, and its transaction becomes the new ambient transaction inside the scope.</span></span>  
  
 <span data-ttu-id="fb0ee-158">Si se crea del ámbito instancias con <xref:System.Transactions.TransactionScopeOption.Suppress>, nunca toma la parte en una transacción, sin tener en cuenta si una transacción ambiente está presente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-158">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Suppress>, it never takes part in a transaction, regardless of whether an ambient transaction is present.</span></span> <span data-ttu-id="fb0ee-159">Un ámbito del que se ha creado una instancia con este valor siempre tiene `null` como su transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-159">A scope instantiated with this value always have `null` as its ambient transaction.</span></span>  
  
 <span data-ttu-id="fb0ee-160">Las opciones anteriores se resumen en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-160">The above options are summarized in the following table.</span></span>  
  
|<span data-ttu-id="fb0ee-161">TransactionScopeOption</span><span class="sxs-lookup"><span data-stu-id="fb0ee-161">TransactionScopeOption</span></span>|<span data-ttu-id="fb0ee-162">Transacción ambiente</span><span class="sxs-lookup"><span data-stu-id="fb0ee-162">Ambient Transaction</span></span>|<span data-ttu-id="fb0ee-163">El ámbito toma parte.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-163">The scope takes part in</span></span>|  
|----------------------------|-------------------------|-----------------------------|  
|<span data-ttu-id="fb0ee-164">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="fb0ee-164">Required</span></span>|<span data-ttu-id="fb0ee-165">No</span><span class="sxs-lookup"><span data-stu-id="fb0ee-165">No</span></span>|<span data-ttu-id="fb0ee-166">Nueva transacción (será la raíz)</span><span class="sxs-lookup"><span data-stu-id="fb0ee-166">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="fb0ee-167">Se requiere nueva</span><span class="sxs-lookup"><span data-stu-id="fb0ee-167">Requires New</span></span>|<span data-ttu-id="fb0ee-168">No</span><span class="sxs-lookup"><span data-stu-id="fb0ee-168">No</span></span>|<span data-ttu-id="fb0ee-169">Nueva transacción (será la raíz)</span><span class="sxs-lookup"><span data-stu-id="fb0ee-169">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="fb0ee-170">Suprimir</span><span class="sxs-lookup"><span data-stu-id="fb0ee-170">Suppress</span></span>|<span data-ttu-id="fb0ee-171">No</span><span class="sxs-lookup"><span data-stu-id="fb0ee-171">No</span></span>|<span data-ttu-id="fb0ee-172">Sin transacción</span><span class="sxs-lookup"><span data-stu-id="fb0ee-172">No Transaction</span></span>|  
|<span data-ttu-id="fb0ee-173">Obligatorio</span><span class="sxs-lookup"><span data-stu-id="fb0ee-173">Required</span></span>|<span data-ttu-id="fb0ee-174">Sí</span><span class="sxs-lookup"><span data-stu-id="fb0ee-174">Yes</span></span>|<span data-ttu-id="fb0ee-175">Transacción ambiente</span><span class="sxs-lookup"><span data-stu-id="fb0ee-175">Ambient  Transaction</span></span>|  
|<span data-ttu-id="fb0ee-176">Se requiere nueva</span><span class="sxs-lookup"><span data-stu-id="fb0ee-176">Requires New</span></span>|<span data-ttu-id="fb0ee-177">Sí</span><span class="sxs-lookup"><span data-stu-id="fb0ee-177">Yes</span></span>|<span data-ttu-id="fb0ee-178">Nueva transacción (será la raíz)</span><span class="sxs-lookup"><span data-stu-id="fb0ee-178">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="fb0ee-179">Suprimir</span><span class="sxs-lookup"><span data-stu-id="fb0ee-179">Suppress</span></span>|<span data-ttu-id="fb0ee-180">Sí</span><span class="sxs-lookup"><span data-stu-id="fb0ee-180">Yes</span></span>|<span data-ttu-id="fb0ee-181">Sin transacción</span><span class="sxs-lookup"><span data-stu-id="fb0ee-181">No Transaction</span></span>|  
  
 <span data-ttu-id="fb0ee-182">Cuando un objeto <xref:System.Transactions.TransactionScope> une una transacción ambiente existente, al eliminar el objeto de ámbito, no se puede finalizar la transacción, a menos que el ámbito anule la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-182">When a <xref:System.Transactions.TransactionScope> object joins an existing ambient transaction, disposing of the scope object may not end the transaction, unless the scope aborts the transaction.</span></span> <span data-ttu-id="fb0ee-183">Si un ámbito de la raíz creara la transacción ambiente, solo cuando el ámbito de la raíz se elimina, se llama <xref:System.Transactions.CommittableTransaction.Commit%2A> en la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-183">If the ambient transaction was created by a root scope, only when the root scope is disposed of, does <xref:System.Transactions.CommittableTransaction.Commit%2A> get called on the transaction.</span></span> <span data-ttu-id="fb0ee-184">Si se crea la transacción manualmente, la transacción finaliza cuando se anula o cuando su creador la confirma.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-184">If the transaction was created manually, the transaction ends when it is either aborted, or committed by its creator.</span></span>  
  
 <span data-ttu-id="fb0ee-185">El ejemplo siguiente muestra un objeto <xref:System.Transactions.TransactionScope> que crea tres objetos de ámbito anidados, cada uno con instancias con un valor <xref:System.Transactions.TransactionScopeOption> diferente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-185">The following example shows a <xref:System.Transactions.TransactionScope> object that creates three nested scope objects, each instantiated with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
//Default is Required
{
    using(TransactionScope scope2 = new TransactionScope(TransactionScopeOption.Required))
    {
        //...
    }

    using(TransactionScope scope3 = new TransactionScope(TransactionScopeOption.RequiresNew))
    {
        //...  
    }
  
    using(TransactionScope scope4 = new TransactionScope(TransactionScopeOption.Suppress))
    {
        //...  
    }
}
```  
  
 <span data-ttu-id="fb0ee-186">El ejemplo muestra un bloque de código sin cualquier transacción ambiente que crea un nuevo ámbito (`scope1`) con <xref:System.Transactions.TransactionScopeOption.Required>.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-186">The example shows a code block without any ambient transaction creating a new scope (`scope1`) with <xref:System.Transactions.TransactionScopeOption.Required>.</span></span> <span data-ttu-id="fb0ee-187">El ámbito `scope1` es un ámbito raíz porque cuando crea una nueva transacción (la transacción A) y hace que la transacción A sea transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-187">The scope `scope1` is a root scope as it creates a new transaction (Transaction A) and makes Transaction A the ambient transaction.</span></span> <span data-ttu-id="fb0ee-188">`Scope1` después, crea tres objetos más, cada uno con un <xref:System.Transactions.TransactionScopeOption> valor diferente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-188">`Scope1` then creates three more objects, each with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span> <span data-ttu-id="fb0ee-189">Por ejemplo, `scope2` se crea con <xref:System.Transactions.TransactionScopeOption.Required>y hay subsecuentemente una transacción ambiente, que se une la primera transacción creada por `scope1`.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-189">For example, `scope2` is created with <xref:System.Transactions.TransactionScopeOption.Required>, and since there is an ambient transaction, it joins the first transaction created by `scope1`.</span></span> <span data-ttu-id="fb0ee-190">Observe que `scope3` es el ámbito de la raíz de una nueva transacción, y `scope4` no tiene ninguna transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-190">Note that `scope3` is the root scope of a new transaction, and that `scope4` has no ambient transaction.</span></span>  
  
 <span data-ttu-id="fb0ee-191">Aunque el valor predeterminado y más comúnmente utilizado de <xref:System.Transactions.TransactionScopeOption> es <xref:System.Transactions.TransactionScopeOption.Required>, cada uno de los otros valores tiene su propósito único.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-191">Although the default and most commonly used value of <xref:System.Transactions.TransactionScopeOption> is <xref:System.Transactions.TransactionScopeOption.Required>, each of the other values has its unique purpose.</span></span>  

### <a name="non-transactional-code-inside-a-transaction-scope"></a><span data-ttu-id="fb0ee-192">Código no transaccional dentro de un ámbito de transacción</span><span class="sxs-lookup"><span data-stu-id="fb0ee-192">Non-transactional code inside a transaction scope</span></span>

 <span data-ttu-id="fb0ee-193"><xref:System.Transactions.TransactionScopeOption.Suppress> resulta útil cuando se desea conservar las operaciones realizadas por la sección de código y no se desea anular la transacción ambiente si se produce un error en las operaciones.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-193"><xref:System.Transactions.TransactionScopeOption.Suppress> is useful when you want to preserve the operations performed by the code section, and do not want to abort the ambient transaction if the operations fail.</span></span> <span data-ttu-id="fb0ee-194">Por ejemplo, al desear realizar un registro u operaciones de la auditoría, o al desear publicar los eventos a los suscriptores sin tener en cuenta si su transacción ambiente se confirma o sufre interrupciones.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-194">For example, when you want to perform logging or audit operations, or when you want to publish events to subscribers regardless of whether your ambient transaction commits or aborts.</span></span> <span data-ttu-id="fb0ee-195">Este valor le permite tener una sección de código no transaccional dentro de un ámbito de la transacción, como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-195">This value allows you to have a non-transactional code section inside a transaction scope, as shown in the following example.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
{
    try
    {
        //Start of non-transactional section
        using(TransactionScope scope2 = new
            TransactionScope(TransactionScopeOption.Suppress))  
        {  
            //Do non-transactional work here  
        }  
        //Restores ambient transaction here
   }
   catch {}  
   //Rest of scope1
}
```  
  
### <a name="voting-inside-a-nested-scope"></a><span data-ttu-id="fb0ee-196">Votar dentro de un ámbito anidado</span><span class="sxs-lookup"><span data-stu-id="fb0ee-196">Voting inside a nested scope</span></span>  

 <span data-ttu-id="fb0ee-197">Aunque un ámbito anidado puede unir la transacción ambiente del ámbito de la raíz, llamar <xref:System.Transactions.TransactionScope.Complete%2A> en el ámbito anidado no tiene ningún efecto en el ámbito de la raíz.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-197">Although a nested scope can join the ambient transaction of the root scope, calling <xref:System.Transactions.TransactionScope.Complete%2A> in the nested scope has no affect on the root scope.</span></span> <span data-ttu-id="fb0ee-198">Sólo si todos los ámbitos del ámbito de la raíz, hasta el último del ámbito anidado, votan para confirmar la transacción, la transacción se confirmará.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-198">Only if all the scopes from the root scope down to the last nested scope vote to commit the transaction, will the transaction be committed.</span></span> <span data-ttu-id="fb0ee-199">Si no se llama a <xref:System.Transactions.TransactionScope.Complete%2A> en un ámbito anidado afectará al ámbito de la raíz ya que la transacción ambiente se anulará inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-199">Not calling <xref:System.Transactions.TransactionScope.Complete%2A> in a nested scope will affect the root scope as the ambient transaction will immediately be aborted.</span></span>  
  
## <a name="setting-the-transactionscope-timeout"></a><span data-ttu-id="fb0ee-200">Establecer el tiempo de espera de TransactionScope</span><span class="sxs-lookup"><span data-stu-id="fb0ee-200">Setting the TransactionScope timeout</span></span>  

 <span data-ttu-id="fb0ee-201">Algunos de los constructores sobrecargados de <xref:System.Transactions.TransactionScope> aceptan un valor de tipo <xref:System.TimeSpan>, que se utiliza para controlar el tiempo de espera de la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-201">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a value of type <xref:System.TimeSpan>, which is used to control the timeout of the transaction.</span></span> <span data-ttu-id="fb0ee-202">Un conjunto de tiempos de espera establecidos a cero significa un tiempo de espera infinito.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-202">A timeout set to zero means an infinite timeout.</span></span> <span data-ttu-id="fb0ee-203">El tiempo de espera infinito es principalmente útil para depurar, al desear aislar un problema en su lógica comercial caminando a través de su código, y no desear la transacción que depura el tiempo de espera mientras intenta buscar el problema.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-203">Infinite timeout is useful mostly for debugging, when you want to isolate a problem in your business logic by stepping through your code, and you do not want the transaction you debug to time out while you attempt to locate the problem.</span></span> <span data-ttu-id="fb0ee-204">Sea sumamente cuidadoso utilizando el valor de tiempo de espera infinito en todos los otros casos, porque invalida las medidas de seguridad contra los interbloqueos de la transacción.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-204">Be extremely careful using the infinite timeout value in all other cases, because it overrides the safeguards against transaction deadlocks.</span></span>  
  
 <span data-ttu-id="fb0ee-205">Se establece normalmente el tiempo de espera <xref:System.Transactions.TransactionScope> en los valores distintos del valor predeterminado en dos casos.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-205">You typically set the <xref:System.Transactions.TransactionScope> timeout to values other than default in two cases.</span></span> <span data-ttu-id="fb0ee-206">El primero durante el desarrollo, al desear probar la manera en que su aplicación administra las transacciones anuladas.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-206">The first is during development, when you want to test the way your application handles aborted transactions.</span></span> <span data-ttu-id="fb0ee-207">Estableciendo el tiempo de espera en un valor pequeño (como un milisegundo), hace que su transacción produzca un error y observa así su código de control de errores.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-207">By setting the timeout to a small value (such as one millisecond), you cause your transaction to fail and can thus observe your error handling code.</span></span> <span data-ttu-id="fb0ee-208">El segundo caso en el que establece el valor para ser menor que el tiempo de espera predeterminado es al creer que el ámbito está implicado en la contención del recurso, produciendo los interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-208">The second case in which you set the value to be less than the default timeout is when you believe that the scope is involved in resource contention, resulting in deadlocks.</span></span> <span data-ttu-id="fb0ee-209">En ese caso, desea anular lo antes posible la transacción y no esperar para que el tiempo de espera predeterminado expire.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-209">In that case, you want to abort the transaction as soon as possible and not wait for the default timeout to expire.</span></span>  
  
 <span data-ttu-id="fb0ee-210">Cuando un ámbito combina una transacción ambiente pero especifica un tiempo de espera menor que el de la transacción ambiente, el nuevo tiempo de espera más corto se exige en el objeto <xref:System.Transactions.TransactionScope> y el ámbito debe finalizar dentro de la hora anidada especificada o se anula la transacción automáticamente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-210">When a scope joins an ambient transaction but specifies a smaller timeout than the one the ambient transaction is set to, the new, shorter timeout is enforced on the <xref:System.Transactions.TransactionScope> object, and the scope must end within the nested time specified, or the transaction is automatically aborted.</span></span> <span data-ttu-id="fb0ee-211">Si el tiempo de espera del ámbito anidado es más que eso de la transacción ambiente, no tiene ningún efecto.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-211">If the nested scope's timeout is more than that of the ambient transaction, it has no effect.</span></span>  
  
## <a name="setting-the-transactionscope-isolation-level"></a><span data-ttu-id="fb0ee-212">Establecer el nivel de aislamiento de TransactionScope</span><span class="sxs-lookup"><span data-stu-id="fb0ee-212">Setting the TransactionScope isolation level</span></span>  

 <span data-ttu-id="fb0ee-213">Algunos de los constructores sobrecargados de <xref:System.Transactions.TransactionScope> aceptan una estructura de tipo <xref:System.Transactions.TransactionOptions> para especificar un nivel de aislamiento, además de un valor de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-213">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a structure of type <xref:System.Transactions.TransactionOptions> to specify an isolation level, in addition to a timeout value.</span></span> <span data-ttu-id="fb0ee-214">De forma predeterminada, la transacción se ejecuta con nivel de aislamiento establecido en <xref:System.Transactions.IsolationLevel.Serializable>.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-214">By default, the transaction executes with isolation level set to <xref:System.Transactions.IsolationLevel.Serializable>.</span></span> <span data-ttu-id="fb0ee-215">La selección de un nivel de aislamiento distinto de <xref:System.Transactions.IsolationLevel.Serializable> se utiliza normalmente para los sistemas de lectura-intensivos.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-215">Selecting an isolation level other than <xref:System.Transactions.IsolationLevel.Serializable> is commonly used for read-intensive systems.</span></span> <span data-ttu-id="fb0ee-216">Esto requiere un sólido entendimiento de teoría del procesamiento de transacciones y las semántica de la propia transacción, los problemas de simultaneidad implicados y las consecuencias para la coherencia del sistema.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-216">This requires a solid understanding of transaction processing theory and the semantics of the transaction itself, the concurrency issues involved, and the consequences for system consistency.</span></span>  
  
 <span data-ttu-id="fb0ee-217">Además, no todos los administradores de recursos admiten todos los niveles de aislamiento y pueden elegir tomar parte en la transacción en un nivel más alto que el que se configuró.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-217">In addition, not all resource managers support all levels of isolation, and they may elect to take part in the transaction at a higher level than the one configured.</span></span>  
  
 <span data-ttu-id="fb0ee-218">Cada nivel de aislamiento además de <xref:System.Transactions.IsolationLevel.Serializable> es susceptible a la inconsistencia que es el resultado de otras transacciones que tienen acceso a la misma información.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-218">Every isolation level besides <xref:System.Transactions.IsolationLevel.Serializable> is susceptible to inconsistency resulting from other transactions accessing the same information.</span></span> <span data-ttu-id="fb0ee-219">La diferencia entre los niveles de aislamiento diferentes es la manera en que se utilizan los bloqueos de la lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-219">The difference between the different isolation levels is in the way read and write locks are used.</span></span> <span data-ttu-id="fb0ee-220">Se puede contener un bloqueo solo cuando la transacción tiene acceso a los datos en el administrador de recursos, o se puede contener hasta que la transacción se confirme o anule.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-220">A lock can be held only when the transaction accesses the data in the resource manager, or it can be held until the transaction is committed or aborted.</span></span> <span data-ttu-id="fb0ee-221">Lo primero es mejor para el rendimiento, lo último para la coherencia.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-221">The former is better for throughput, the latter for consistency.</span></span> <span data-ttu-id="fb0ee-222">Los dos tipos de bloqueos y los dos tipos de operaciones (lectura/escritura) proporcionan cuatro niveles de aislamiento básicos.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-222">The two kinds of locks and the two kinds of operations (read/write) give four basic isolation levels.</span></span> <span data-ttu-id="fb0ee-223">Vea <xref:System.Transactions.IsolationLevel> para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-223">See <xref:System.Transactions.IsolationLevel> for more information.</span></span>  
  
 <span data-ttu-id="fb0ee-224">Al utilizar los objetos <xref:System.Transactions.TransactionScope> anidados, todos los ámbitos anidados se deben configurar para utilizar exactamente el mismo nivel de aislamiento si desean unir la transacción ambiente.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-224">When using nested <xref:System.Transactions.TransactionScope> objects, all nested scopes must be configured to use exactly the same isolation level if they want to join the ambient transaction.</span></span> <span data-ttu-id="fb0ee-225">Si un objeto <xref:System.Transactions.TransactionScope> anidado intenta unir la transacción ambiente todavía especifica un nivel de aislamiento diferente, se inicia <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-225">If a nested <xref:System.Transactions.TransactionScope> object tries to join the ambient transaction yet it specifies a different isolation level, an <xref:System.ArgumentException> is thrown.</span></span>  
  
## <a name="interop-with-com"></a><span data-ttu-id="fb0ee-226">Interoperabilidad con COM+</span><span class="sxs-lookup"><span data-stu-id="fb0ee-226">Interop with COM+</span></span>  

 <span data-ttu-id="fb0ee-227">Al crear que una nueva instancia <xref:System.Transactions.TransactionScope>, se puede utilizar la enumeración <xref:System.Transactions.EnterpriseServicesInteropOption> en uno de los constructores para especificar cómo interactuar con COM+.</span><span class="sxs-lookup"><span data-stu-id="fb0ee-227">When you create a new <xref:System.Transactions.TransactionScope> instance, you can use the <xref:System.Transactions.EnterpriseServicesInteropOption> enumeration in one of the constructors to specify how to interact with COM+.</span></span> <span data-ttu-id="fb0ee-228">Para obtener más información sobre esto, consulte [interoperabilidad con Enterprise Services y transacciones de com+](interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="fb0ee-228">For more information on this, see [Interoperability with Enterprise Services and COM+ Transactions](interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fb0ee-229">Consulte también</span><span class="sxs-lookup"><span data-stu-id="fb0ee-229">See also</span></span>

- <xref:System.Transactions.Transaction.Clone%2A>
- <xref:System.Transactions.TransactionScope>
