---
title: Extensión de administración de transacción
description: Obtenga información sobre la escalación de la administración de transacciones en .NET, que es el proceso de migración de una transacción de los componentes de un administrador de transacciones a otro.
ms.date: 03/30/2017
ms.assetid: 1e96331e-31b6-4272-bbbd-29ed1e110460
ms.openlocfilehash: 83abca2e2c9acf53ce3f72d6bc55a82964b99cb5
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/24/2020
ms.locfileid: "91155447"
---
# <a name="transaction-management-escalation"></a><span data-ttu-id="c6a6d-103">Extensión de administración de transacción</span><span class="sxs-lookup"><span data-stu-id="c6a6d-103">Transaction Management Escalation</span></span>

<span data-ttu-id="c6a6d-104">Windows hospeda un conjunto de servicios y módulos que juntos constituyen un administrador de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-104">Windows hosts a set of services and modules that together constitute a transaction manager.</span></span> <span data-ttu-id="c6a6d-105">La subida de administración de transacciones describe el proceso de migración de una transacción desde uno de los componentes del administrador de transacciones a otro.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-105">Transaction management escalation describes the process of migrating a transaction from one of the transaction manager's components to another.</span></span>  
  
 <span data-ttu-id="c6a6d-106"><xref:System.Transactions> incluye un componente del administrador de transacciones que coordina una transacción que implica como máximo un recurso duradero único o varios recursos volátiles.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-106"><xref:System.Transactions> includes a transaction manager component that coordinates a transaction involving at most, a single durable resource or multiple volatile resources.</span></span> <span data-ttu-id="c6a6d-107">Dado que el administrador de transacciones solo utiliza las llamadas de dominio de intraaplicación, produce el máximo rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-107">Because the transaction manager uses only intra-application domain calls, it yields the best performance.</span></span> <span data-ttu-id="c6a6d-108">Los programadores no necesitan interactuar directamente con el administrador de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-108">Developers need not interact with the transaction manager directly.</span></span> <span data-ttu-id="c6a6d-109">En su lugar, una infraestructura común que define las interfaces, un comportamiento común, y las clases del asistente <xref:System.Transactions> es proporcionada por el espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-109">Instead, a common infrastructure that defines interfaces, common behavior, and helper classes is provided by the <xref:System.Transactions> namespace.</span></span>  
  
 <span data-ttu-id="c6a6d-110">Cuando desea proporcionar la transacción a un objeto de otro dominio de aplicación (incluidos los límites del proceso y del equipo) en el mismo equipo, la <xref:System.Transactions> infraestructura de escala automáticamente la transacción para que la administre Microsoft Coordinador de transacciones distribuidas (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="c6a6d-110">When you want to provide the transaction to an object in another application domain (including across process and machine boundaries) on the same computer, the <xref:System.Transactions> infrastructure automatically escalates the transaction to be managed by the Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="c6a6d-111">La subida también se produce si da de alta a otro administrador de recursos duradero.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-111">The escalation also occurs if you enlist another durable resource manager.</span></span> <span data-ttu-id="c6a6d-112">Cuando se realiza una escalada, la transacción sigue siendo administrada en su estado elevado hasta su realización.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-112">When escalated, the transaction remains managed in its elevated state until its completion.</span></span>  
  
 <span data-ttu-id="c6a6d-113">Entre la transacción <xref:System.Transactions> y la transacción de MSDTC, hay un tipo intermediario de transacción disponible a través de la inscripción de fase única promocional (PSPE).</span><span class="sxs-lookup"><span data-stu-id="c6a6d-113">Between the <xref:System.Transactions> transaction and MSDTC transaction, there is an intermediary type of transaction that is made available through the Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="c6a6d-114">PSPE es otro mecanismo importante en <xref:System.Transactions> para la optimización de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-114">PSPE is another important mechanism in <xref:System.Transactions> for performance optimization.</span></span> <span data-ttu-id="c6a6d-115">Permite un recurso duradero remoto, situado en un dominio de aplicación diferente, proceso o equipo, para participar en una transacción <xref:System.Transactions> sin producir que se realice una escalada a una transacción de MSDTC.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-115">It allows a remote durable resource, located in a different application domain, process or computer, to participate in a <xref:System.Transactions> transaction without causing it to be escalated to an MSDTC transaction.</span></span> <span data-ttu-id="c6a6d-116">Para obtener más información sobre PSPE, vea [dar de alta recursos como participantes en una transacción](enlisting-resources-as-participants-in-a-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="c6a6d-116">For more information about PSPE, see [Enlisting Resources as Participants in a Transaction](enlisting-resources-as-participants-in-a-transaction.md).</span></span>  
  
## <a name="how-escalation-is-initiated"></a><span data-ttu-id="c6a6d-117">Cómo se Inicia la subida</span><span class="sxs-lookup"><span data-stu-id="c6a6d-117">How Escalation is Initiated</span></span>  

 <span data-ttu-id="c6a6d-118">La subida de la transacción reduce el rendimiento porque MSDTC reside en un proceso independiente, y realizar una escalada de una transacción a MSDTC produce el envío de mensajes durante el proceso.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-118">Transaction escalation reduces performance because the MSDTC resides in a separate process, and escalating a transaction to the MSDTC results in messages being sent across process.</span></span> <span data-ttu-id="c6a6d-119">Para mejorar el rendimiento, debería retrasar o evitar la subida a MSDTC; así, necesita conocer cómo y cuando se inicia la subida.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-119">To improve performance, you should delay or avoid escalation to MSDTC; thus, you need to know how and when the escalation is initiated.</span></span>  
  
 <span data-ttu-id="c6a6d-120">Con tal de que la infraestructura <xref:System.Transactions> administre los recursos volátiles y a lo sumo un recurso duradero que admita notificaciones de la fase única, la transacción permanece en la propiedad de la infraestructura <xref:System.Transactions>.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-120">As long as the <xref:System.Transactions> infrastructure handles volatile resources and at most one durable resource that supports single-phase notifications, the transaction remains in the ownership of the <xref:System.Transactions> infrastructure.</span></span> <span data-ttu-id="c6a6d-121">El administrador de transacciones solo es útil a esos recursos que viven en el mismo dominio de aplicación y para los que no se requiere estar registrado (escribir el resultado de la transacción en el disco).</span><span class="sxs-lookup"><span data-stu-id="c6a6d-121">The transaction manager avails itself only to those resources that live in the same application domain and for which logging (writing the transaction outcome to disk) is not required.</span></span> <span data-ttu-id="c6a6d-122">Una subida que provoca que la infraestructura <xref:System.Transactions> transfiera la propiedad de la transacción a MSDTC sucede cuando:</span><span class="sxs-lookup"><span data-stu-id="c6a6d-122">An escalation that results in the <xref:System.Transactions> infrastructure transferring the ownership of the transaction to MSDTC happens when:</span></span>  
  
- <span data-ttu-id="c6a6d-123">Por lo menos un recurso duradero que no admite notificaciones de la fase única se da de alta en la transacción.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-123">At least one durable resource that does not support single-phase notifications is enlisted in the transaction.</span></span>  
  
- <span data-ttu-id="c6a6d-124">Por lo menos dos recursos duraderos que admiten notificaciones de la fase del soltero se dan de alta en la transacción.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-124">At least two durable resources that support single-phase notifications are enlisted in the transaction.</span></span> <span data-ttu-id="c6a6d-125">Por ejemplo, dar de alta una conexión única con SQL Server 2005 no provoca la promoción de una transacción.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-125">For example, enlisting a single connection with SQL Server 2005 does not cause a transaction to be promoted.</span></span> <span data-ttu-id="c6a6d-126">Sin embargo, cada vez que se abre una segunda conexión a una base de datos SQL Server 2005 que hace que la base de datos se inscriba, la <xref:System.Transactions> infraestructura detecta que es el segundo recurso duradero de la transacción y la escala a una transacción MSDTC.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-126">However, whenever you open a second connection to a SQL Server 2005 database causing the database to enlist, the <xref:System.Transactions> infrastructure detects that it is the second durable resource in the transaction, and escalates it to an MSDTC transaction.</span></span>  
  
- <span data-ttu-id="c6a6d-127">Se invoca una solicitud para "calcular las referencias" de la transacción a un dominio de aplicación diferente o un proceso diferente.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-127">A request to "marshal" the transaction to a different application domain or different process is invoked.</span></span> <span data-ttu-id="c6a6d-128">Por ejemplo, la serialización del objeto de transacción a través de un límite del dominio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-128">For example, the serialization of the transaction object across an application domain boundary.</span></span> <span data-ttu-id="c6a6d-129">Se calculan referencias al objeto de transacción por valor, lo que significa que cualquier intento de pasarlo por un límite de dominio de aplicación (incluso en el mismo proceso) da como resultado la serialización del objeto de transacción.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-129">The transaction object is marshaled-by-value, meaning that any attempt to pass it across an application domain boundary (even in the same process) results in serialization of the transaction object.</span></span> <span data-ttu-id="c6a6d-130">Puede pasar los objetos de transacción realizando una llamada en un método remoto que toma <xref:System.Transactions.Transaction> como un parámetro o puede intentar tener acceso a un componente transaccional-reparado remoto.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-130">You can pass the transaction objects by making a call on a remote method that takes a <xref:System.Transactions.Transaction> as a parameter or you can try to access a remote transactional-serviced component.</span></span> <span data-ttu-id="c6a6d-131">Esto serializa el objeto de transacción y resulta en una subida, como cuando una transacción se serializa por un dominio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-131">This serializes the transaction object and results in an escalation, as when a transaction is serialized across an application domain.</span></span> <span data-ttu-id="c6a6d-132">Se distribuye y el administrador de transacciones local ya no es adecuado.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-132">It is being distributed and the local transaction manager is no longer adequate.</span></span>  
  
 <span data-ttu-id="c6a6d-133">La tabla siguiente hace una lista de todas las posibles excepciones que se pueden producir durante la subida.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-133">The following table lists all the possible exceptions that can be thrown during escalation.</span></span>  
  
|<span data-ttu-id="c6a6d-134">Tipo de excepción</span><span class="sxs-lookup"><span data-stu-id="c6a6d-134">Exception type</span></span>|<span data-ttu-id="c6a6d-135">Condición</span><span class="sxs-lookup"><span data-stu-id="c6a6d-135">Condition</span></span>|  
|--------------------|---------------|  
|<xref:System.InvalidOperationException>|<span data-ttu-id="c6a6d-136">Intento para realizar una escalada de una transacción con nivel de aislamiento igual a <xref:System.Transactions.IsolationLevel.Snapshot>.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-136">An attempt to escalate a transaction with isolation level equal to <xref:System.Transactions.IsolationLevel.Snapshot>.</span></span>|  
|<xref:System.Transactions.TransactionAbortedException>|<span data-ttu-id="c6a6d-137">El administrador de transacciones está inactivo.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-137">The transaction manager is down.</span></span>|  
|<xref:System.Transactions.TransactionException>|<span data-ttu-id="c6a6d-138">Error en la subida, se anula la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c6a6d-138">The escalation fails and the application is aborted.</span></span>|
