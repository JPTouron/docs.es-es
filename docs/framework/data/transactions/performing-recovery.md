---
title: Realizar la recuperación
description: Realice la recuperación en .NET. El administrador de recursos ayuda a resolver las inlistas de transacciones duraderas volviendo a inscribir al participante de la transacción después de un error en el recurso.
ms.date: 03/30/2017
ms.assetid: 6dd17bf6-ba42-460a-a44b-8046f52b10d0
ms.openlocfilehash: bb00d2f574cc2651b733f3308cf2ffc6b430cc31
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141970"
---
# <a name="performing-recovery"></a><span data-ttu-id="854d1-104">Realizar la recuperación</span><span class="sxs-lookup"><span data-stu-id="854d1-104">Performing Recovery</span></span>
<span data-ttu-id="854d1-105">El administrador de recursos facilita la resolución de inscripciones duraderas en una transacción volviendo a inscribir al participante de la transacción después de un error de recurso.</span><span class="sxs-lookup"><span data-stu-id="854d1-105">A resource manager facilitates resolution of durable enlistments in a transaction by reenlisting the transaction participant after resource failure.</span></span>  
  
## <a name="the-recovery-process"></a><span data-ttu-id="854d1-106">El Proceso de la recuperación</span><span class="sxs-lookup"><span data-stu-id="854d1-106">The Recovery Process</span></span>  
 <span data-ttu-id="854d1-107">Para dar de alta de forma duradera a un recurso (se describe por una implementación de la interfaz <xref:System.Transactions.IEnlistmentNotification>) que puede ser después elegible para la recuperación, debería llamar al método <xref:System.Transactions.Transaction.EnlistDurable%2A>.</span><span class="sxs-lookup"><span data-stu-id="854d1-107">To durably enlist a resource (described by an implementation of the <xref:System.Transactions.IEnlistmentNotification> interface) that can later be eligible for recovery, you should call the <xref:System.Transactions.Transaction.EnlistDurable%2A> method.</span></span> <span data-ttu-id="854d1-108">Además, debe proporcionar un identificador del administrador de recursos (un <xref:System.Transactions.Transaction.EnlistDurable%2A>) que se utiliza para etiquetar de forma consistente al participante de la transacción en caso de un error de recurso al método <xref:System.Guid>.</span><span class="sxs-lookup"><span data-stu-id="854d1-108">In addition, you must provide the <xref:System.Transactions.Transaction.EnlistDurable%2A> method with a resource manager identifier (a <xref:System.Guid>) that is used to consistently label the participant of the transaction in the event of a resource failure.</span></span> <span data-ttu-id="854d1-109">Por esta razón, el <xref:System.Guid> que se proporciona a la llamada de inscripción inicial debe ser idéntico al parámetro *resourceManagerIdentifier* en la <xref:System.Transactions.TransactionManager.Reenlist%2A> llamada durante la recuperación.</span><span class="sxs-lookup"><span data-stu-id="854d1-109">For this reason, the <xref:System.Guid> that is provided to the initial Enlist call should be identical to the *resourceManagerIdentifier* parameter in the <xref:System.Transactions.TransactionManager.Reenlist%2A> call during recovery.</span></span> <span data-ttu-id="854d1-110">De lo contrario, se produce <xref:System.Transactions.TransactionException>.</span><span class="sxs-lookup"><span data-stu-id="854d1-110">Otherwise, <xref:System.Transactions.TransactionException> is thrown.</span></span> <span data-ttu-id="854d1-111">Para obtener más información sobre las inlistas duraderas, vea [dar de alta recursos como participantes en una transacción](enlisting-resources-as-participants-in-a-transaction.md) .</span><span class="sxs-lookup"><span data-stu-id="854d1-111">For more information on durable enlistments, see [Enlisting Resources as Participants in a Transaction](enlisting-resources-as-participants-in-a-transaction.md) .</span></span>  
  
 <span data-ttu-id="854d1-112">En la fase de preparación (fase 1) del  protocolo 2PC, cuando su implementación de un administrador de recursos duradero recibe la notificación <xref:System.Transactions.IEnlistmentNotification.Prepare%2A>, debería registrar su registro de preparación durante esta fase.</span><span class="sxs-lookup"><span data-stu-id="854d1-112">In the prepare phase (phase 1) of the 2PC protocol, when your implementation of a durable resource manager receives the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification, it should log its prepare record during this phase.</span></span> <span data-ttu-id="854d1-113">El registro debería contener toda la información que es necesaria para completar la transacción en confirmación.</span><span class="sxs-lookup"><span data-stu-id="854d1-113">The record should contain all the information that is necessary to complete the transaction on commit.</span></span> <span data-ttu-id="854d1-114">Se puede obtener acceso al registro de preparación más adelante durante la recuperación mediante la recuperación <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> de la propiedad de la devolución de llamada *preparingEnlistment* .</span><span class="sxs-lookup"><span data-stu-id="854d1-114">The prepare record can later be accessed during recovery by retrieving the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the *preparingEnlistment* callback.</span></span> <span data-ttu-id="854d1-115">El registro del registro no necesita ser realizado dentro del método <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> cuando RM puede hacer esto en un subproceso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="854d1-115">The record logging does not need to be performed within the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> method as the RM can do this on a worker thread.</span></span>  
  
 <span data-ttu-id="854d1-116">El proceso de recuperación consiste de los dos siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="854d1-116">The recovery process consists of the following two steps:</span></span>  
  
### <a name="step-1---reenlist"></a><span data-ttu-id="854d1-117">El paso 1 - ReEnlist</span><span class="sxs-lookup"><span data-stu-id="854d1-117">Step 1 - ReEnlist</span></span>  
 <span data-ttu-id="854d1-118">El administrador de recursos examina el registro de preparación de la información para cada inscripción que está dudosa.</span><span class="sxs-lookup"><span data-stu-id="854d1-118">The resource manager examines the prepare information record for each enlistment that is in-doubt.</span></span> <span data-ttu-id="854d1-119">Esto se hace examinando la propiedad <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> de la devolución de llamada <xref:System.Transactions.PreparingEnlistment>, que se pasa al administrador de recursos en la notificación <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> durante fase 1.</span><span class="sxs-lookup"><span data-stu-id="854d1-119">This is done by examining the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the <xref:System.Transactions.PreparingEnlistment> callback, which is passed to the resource manager in the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification during phase 1.</span></span>  
  
 <span data-ttu-id="854d1-120">Para cada inscripción que examina, invoca <xref:System.Transactions.TransactionManager.Reenlist%2A> en el administrador de transacciones.</span><span class="sxs-lookup"><span data-stu-id="854d1-120">For each such enlistment it examines, it invokes <xref:System.Transactions.TransactionManager.Reenlist%2A> on the transaction manager.</span></span> <span data-ttu-id="854d1-121">Este método pasa en un <xref:System.Guid> único que identifica el administrador de recursos, así como la información de la inscripción en una matriz de bytes.</span><span class="sxs-lookup"><span data-stu-id="854d1-121">This method passes on a unique <xref:System.Guid> that identifies the resource manager, as well as the enlistment's information in a byte array.</span></span> <span data-ttu-id="854d1-122">Se devuelve un objeto nuevo <xref:System.Transactions.Enlistment> .</span><span class="sxs-lookup"><span data-stu-id="854d1-122">A new <xref:System.Transactions.Enlistment> object is returned.</span></span> <span data-ttu-id="854d1-123">En caso de error en el reenganche con una excepción, el administrador de recursos necesitará reintentar en un momento posterior.</span><span class="sxs-lookup"><span data-stu-id="854d1-123">If the reenlistment fails with an exception, the resource manager will need to retry at a later time.</span></span>  
  
 <span data-ttu-id="854d1-124">Solo debería llamar al <xref:System.Transactions.TransactionManager.Reenlist%2A> método si un administrador de recursos se reinicia a partir de un error.</span><span class="sxs-lookup"><span data-stu-id="854d1-124">You should only call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method when a resource manager restarts from failure.</span></span> <span data-ttu-id="854d1-125">Además, solo debería volver a inscribir las transacciones sin resolver registradas por un administrador de recursos durante fase de preparación inicial de una confirmación en dos fases.</span><span class="sxs-lookup"><span data-stu-id="854d1-125">In addition, you should only reenlist unresolved transactions logged by a resource manager during the initial Prepare phase of a two-phase commit.</span></span> <span data-ttu-id="854d1-126">Cualquier intento de llamar a este método en momentos que no corresponda puede generar resultados erróneos.</span><span class="sxs-lookup"><span data-stu-id="854d1-126">Any attempt to call this method at invalid times can produce erroneous results.</span></span>  
  
 <span data-ttu-id="854d1-127">Cuando se vuelve a inscribir un participante con este método, se llama a los métodos de la fase 2 de <xref:System.Transactions.IEnlistmentNotification> que corresponden al resultado de la transacción (es decir, <xref:System.Transactions.IEnlistmentNotification.Commit%2A>, <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> o <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A>) según sea adecuado.</span><span class="sxs-lookup"><span data-stu-id="854d1-127">When a participant is reenlisted using this method, the phase 2 methods of <xref:System.Transactions.IEnlistmentNotification> that correspond to the transaction's outcome (that is, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> or <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) are called as appropriate.</span></span>  
  
### <a name="step-2---completing-the-recovery"></a><span data-ttu-id="854d1-128">El paso 2 - Completando la recuperación</span><span class="sxs-lookup"><span data-stu-id="854d1-128">Step 2 - Completing the recovery</span></span>  
 <span data-ttu-id="854d1-129">Cuando todas las inscripciones hayan finalizado el administrador de recursos llamará al método <xref:System.Transactions.TransactionManager.RecoveryComplete%2A>.</span><span class="sxs-lookup"><span data-stu-id="854d1-129">When all the reenlistments are finished, the resource manager calls the <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> method.</span></span> <span data-ttu-id="854d1-130">Este método completa la recuperación e informa el administrador de transacciones de que el administrador de recursos no tiene ninguna transacción dudosa más.</span><span class="sxs-lookup"><span data-stu-id="854d1-130">This method completes the recovery and informs the transaction manager that the resource manager has no more in-doubt transactions.</span></span> <span data-ttu-id="854d1-131">Haciendo esto, el administrador de recursos garantiza que no invocará de nuevo el método <xref:System.Transactions.TransactionManager.Reenlist%2A>.</span><span class="sxs-lookup"><span data-stu-id="854d1-131">By doing so, the resource manager guarantees that it will not invoke the <xref:System.Transactions.TransactionManager.Reenlist%2A> method again.</span></span>  
  
 <span data-ttu-id="854d1-132">No se exige a un administrador de recursos que resuelva todas las transacciones dudosas antes de dar de alta nuevas transacciones.</span><span class="sxs-lookup"><span data-stu-id="854d1-132">A resource manager is not required to resolve all in-doubt transactions before enlisting in new transactions.</span></span> <span data-ttu-id="854d1-133">El primer paso se puede realizar en cualquier momento después de que el administrador de recursos establezca una relación con el administrador de transacciones, pero después de que se haya <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> invocado (paso 2); el paso 1 no se puede volver a realizar.</span><span class="sxs-lookup"><span data-stu-id="854d1-133">The first step can be performed at any time after the resource manager establishes a relationship with the transaction manager, but after <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> has been invoked (step 2); step 1 cannot be performed again.</span></span> <span data-ttu-id="854d1-134">El paso 2 se puede repetir varias veces sin afectar al resultado de transacciones.</span><span class="sxs-lookup"><span data-stu-id="854d1-134">Step 2 can be repeated multiple times without affecting the outcome of transactions.</span></span>
