---
title: Dar de alta los recursos como participantes en una transacción
description: Dar de alta los recursos como participantes en una transacción de .NET. Un administrador de recursos administra cada recurso de una transacción, coordinada por un administrador de transacciones.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 786a12c2-d530-49f4-9c59-5c973e15a11d
ms.openlocfilehash: c3c777593750b3a4f05ae97ed6e26e19f58e4d72
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141880"
---
# <a name="enlisting-resources-as-participants-in-a-transaction"></a><span data-ttu-id="cc6bb-104">Dar de alta los recursos como participantes en una transacción</span><span class="sxs-lookup"><span data-stu-id="cc6bb-104">Enlisting Resources as Participants in a Transaction</span></span>

<span data-ttu-id="cc6bb-105">Un administrador de recursos administra cada recurso participante, cuyas acciones coordina un administrador de transacciones.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-105">Each resource participating in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="cc6bb-106">La coordinación se hace a través de las notificaciones dadas a los suscriptores que han dado de alta una transacción a través del administrador de transacciones.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-106">The coordination is done through notifications given to subscribers who have enlisted in a transaction through the transaction manager.</span></span>

<span data-ttu-id="cc6bb-107">En este tema se trata cómo un recurso (o varios recursos) se puede dar de alta en una transacción, así como los tipos diferentes de inscripción.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-107">This topic covers how a resource (or multiple resources) can be enlisted in a transaction, as well as the different types of enlistment.</span></span> <span data-ttu-id="cc6bb-108">En el tema [confirmación de una transacción en una fase y varias fases](committing-a-transaction-in-single-phase-and-multi-phase.md) se explica cómo se puede coordinar el compromiso de la transacción entre los recursos que se han dado de alta.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-108">The [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md) topic covers how transaction commitment can be coordinated among enlisted resources.</span></span>

## <a name="enlisting-resources-in-a-transaction"></a><span data-ttu-id="cc6bb-109">Dar de alta los recursos en una transacción</span><span class="sxs-lookup"><span data-stu-id="cc6bb-109">Enlisting Resources in a Transaction</span></span>

<span data-ttu-id="cc6bb-110">Para que un administrador de recursos participe en una transacción, debe inscribirse en la transacción.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-110">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="cc6bb-111">La <xref:System.Transactions.Transaction> clase define un conjunto de métodos cuyos nombres comienzan por **dar de alta** que proporcionan esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-111">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="cc6bb-112">Los diferentes métodos de **inscripción** se corresponden con los distintos tipos de inscripción que puede tener un administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-112">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="cc6bb-113">Específicamente, utiliza los métodos <xref:System.Transactions.Transaction.EnlistVolatile%2A> para los recursos volátiles y el método <xref:System.Transactions.Transaction.EnlistDurable%2A> para los recursos duraderos.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-113">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="cc6bb-114">La duración (o a la inversa la volatilidad) de un administrador de recursos hace referencia a si el administrador de recursos admite la recuperación del error.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-114">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="cc6bb-115">Si un administrador de recursos admite la recuperación del error, conserva los datos del almacenamiento duradero durante la fase1 (preparación) de tal manera que si el administrador de recursos baja, puede reenganchar la transacción en la recuperación y realizar las acciones apropiadas basadas en las notificaciones recibidas de la TM.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-115">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the TM.</span></span> <span data-ttu-id="cc6bb-116">En general, los administradores de recursos volátiles administran recursos volátiles como una estructura de datos en memoria (por ejemplo, una tabla hash llevada a cabo en memoria) y los administradores de recursos duraderos administran recursos que tienen una memoria auxiliar más persistente (por ejemplo, una base de datos cuyo dispositivo de copia de seguridad es el disco).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-116">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>

<span data-ttu-id="cc6bb-117">Para simplificar, después de decidir si utilizar el método<xref:System.Transactions.Transaction.EnlistDurable%2A> o <xref:System.Transactions.Transaction.EnlistVolatile%2A> basado en la compatibilidad de la duración de su recurso, debería dar de alta su recurso para participar en la confirmación en dos fases (2PC) implementando la interfaz <xref:System.Transactions.IEnlistmentNotification> para su administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-117">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="cc6bb-118">Para obtener más información sobre 2PC, consulte [confirmar una transacción en una sola fase y varias fases](committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-118">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>

<span data-ttu-id="cc6bb-119">Una participante única puede inscribir para más de uno de estos protocolos varias veces llamando a <xref:System.Transactions.Transaction.EnlistDurable%2A> y a <xref:System.Transactions.Transaction.EnlistVolatile%2A>.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-119">A single participant can enlist for more than one of these protocols by calling <xref:System.Transactions.Transaction.EnlistDurable%2A> and <xref:System.Transactions.Transaction.EnlistVolatile%2A> multiple times.</span></span>

### <a name="durable-enlistment"></a><span data-ttu-id="cc6bb-120">Inscripción duradera</span><span class="sxs-lookup"><span data-stu-id="cc6bb-120">Durable Enlistment</span></span>

<span data-ttu-id="cc6bb-121">El método <xref:System.Transactions.Transaction.EnlistDurable%2A> se utiliza para inscribir un administrador de recursos para la participación en la transacción como un recurso duradero.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-121">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods are used to enlist a resource manager for participation in the transaction as a durable resource.</span></span>  <span data-ttu-id="cc6bb-122">Se espera que si un administrador de recursos duradero se derrumba en el medio de una transacción, puede realizar la recuperación una vez devuelta la línea volviendo a darle de alta (utilizando el método <xref:System.Transactions.TransactionManager.Reenlist%2A>) en todas las transacciones en las que fue un participante y no completó la fase 2, y <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> de la llamada cuando finaliza el procesamiento de la recuperación.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-122">It is expected that if a durable resource manager is brought down in the middle of a transaction, it can perform recovery once it is brought back online by reenlisting (using the <xref:System.Transactions.TransactionManager.Reenlist%2A> method) in all transactions in which it was a participant and did not complete phase 2, and call <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> once it finishes recovery processing.</span></span> <span data-ttu-id="cc6bb-123">Para obtener más información sobre la recuperación, vea [realizar la recuperación](performing-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-123">For more information on recovery, see [Performing Recovery](performing-recovery.md).</span></span>

<span data-ttu-id="cc6bb-124">Todos métodos <xref:System.Transactions.Transaction.EnlistDurable%2A> toman un objeto <xref:System.Guid> como su primer parámetro.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-124">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods all take a <xref:System.Guid> object as their first parameter.</span></span> <span data-ttu-id="cc6bb-125">El administrador de transacciones utiliza <xref:System.Guid> para asociar una inscripción duradera a un administrador de recursos determinado.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-125">The <xref:System.Guid> is used by the transaction manager to associate a durable enlistment with a particular resource manager.</span></span> <span data-ttu-id="cc6bb-126">Como tal, es imperativo que un administrador de recursos utilice de forma consistente el mismo <xref:System.Guid> para incluso identificarse por los administradores de recursos diferentes al reiniciar, de lo contrario se puede producir un error en la recuperación.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-126">As such, it is imperative that a resource manager consistently uses the same <xref:System.Guid> to identify itself even across different resource managers upon restarting, otherwise the recovery can fail.</span></span>

<span data-ttu-id="cc6bb-127">El segundo parámetro del método <xref:System.Transactions.Transaction.EnlistDurable%2A> es una referencia al objeto que el administrador de recursos implementa para recibir las notificaciones de la transacción.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-127">The second parameter of the <xref:System.Transactions.Transaction.EnlistDurable%2A> method is a reference to the object that the resource manager implements to receive transaction notifications.</span></span> <span data-ttu-id="cc6bb-128">La sobrecarga que utiliza informa al administrador de transacciones si su administrador de recursos admite la optimización de la fase de confirmación única(SPC).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-128">The overload you use informs the transaction manager whether your resource manager supports the Single Phase Commit (SPC) optimization.</span></span> <span data-ttu-id="cc6bb-129">La mayoría de las veces,  implementaría la interfaz <xref:System.Transactions.IEnlistmentNotification> para tomar la parte en la confirmación en dos fases (2PC).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-129">Most of the time you would implement the <xref:System.Transactions.IEnlistmentNotification> interface to take part in Two-Phase Commit (2PC).</span></span> <span data-ttu-id="cc6bb-130">Sin embargo, si desea optimizar el proceso de confirmación, puede considerar implementar la interfaz <xref:System.Transactions.ISinglePhaseNotification> para SPC.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-130">However, if you want to optimize the commit process, you can consider implementing the <xref:System.Transactions.ISinglePhaseNotification> interface for SPC.</span></span> <span data-ttu-id="cc6bb-131">Para obtener más información sobre SPC, consulte [confirmación de una transacción en fase única y varias fases](committing-a-transaction-in-single-phase-and-multi-phase.md) y [optimización mediante la confirmación de fase única y la notificación de fase única promocionable](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-131">For more information on SPC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md) and [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>

<span data-ttu-id="cc6bb-132">El tercer parámetro es una enumeración <xref:System.Transactions.EnlistmentOptions>, cuyo valor puede ser <xref:System.Transactions.EnlistmentOptions.None> o <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-132">The third parameter is an <xref:System.Transactions.EnlistmentOptions> enumeration, whose value can be either <xref:System.Transactions.EnlistmentOptions.None> or <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span></span> <span data-ttu-id="cc6bb-133">Si el valor está establecido en <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, la inscripción puede dar de alta los administradores de recursos adicionales al recibir la notificación de preparación del administrador de transacciones.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-133">If the value is set to <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, the enlistment may enlist additional resource managers upon receiving the Prepare notification from the transaction manager.</span></span> <span data-ttu-id="cc6bb-134">Sin embargo, debería ser consciente de que este tipo de inscripción no es apta para la optimización de la fase de confirmación única.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-134">However, you should be aware that this type of enlistment is not eligible for the Single Phase Commit optimization.</span></span>

### <a name="volatile-enlistment"></a><span data-ttu-id="cc6bb-135">Inscripción volátil</span><span class="sxs-lookup"><span data-stu-id="cc6bb-135">Volatile Enlistment</span></span>

<span data-ttu-id="cc6bb-136">Los participantes que administran recursos volátiles como una caché, deberían darse de alta utilizando los métodos <xref:System.Transactions.Transaction.EnlistVolatile%2A>.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-136">Participants managing volatile resources such as a cache should enlist using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods.</span></span> <span data-ttu-id="cc6bb-137">Tales objetos no podrían obtener el resultado de una transacción o recuperar el estado de cualquier transacción participan después de un error del sistema.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-137">Such objects might not be able to obtain the outcome of a transaction or recover the state of any transaction they participate in after a system failure.</span></span>

<span data-ttu-id="cc6bb-138">Como dicho previamente, un administrador de recursos realizaría una inscripción volátil si administra un recurso en memoria volátil.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-138">As stated previously, a resource manager would make a volatile enlistment if it manages an in-memory, volatile resource.</span></span> <span data-ttu-id="cc6bb-139">Una de las ventajas de utilizar <xref:System.Transactions.Transaction.EnlistVolatile%2A> es que no fuerza ninguna subida innecesaria de la transacción.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-139">One of the benefits of using <xref:System.Transactions.Transaction.EnlistVolatile%2A> is that it does not force an unnecessary escalation of the transaction.</span></span> <span data-ttu-id="cc6bb-140">Para obtener más información sobre el escalado de transacciones, vea el tema sobre [escalado de administración de transacciones](transaction-management-escalation.md) .</span><span class="sxs-lookup"><span data-stu-id="cc6bb-140">For more information on transaction escalation, see [Transaction Management Escalation](transaction-management-escalation.md) topic.</span></span> <span data-ttu-id="cc6bb-141">Dar de alta la volatilidad implica tanto una diferencia en el modo en que el administrador de transacciones controla la inscripción, así como lo que el administrador de transacciones espera que el administrador de recursos.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-141">Enlisting volatility implies both a difference in how the enlistment is handled by the transaction manager, as well as what is expected of the resource manager by the transaction manager.</span></span> <span data-ttu-id="cc6bb-142">Esto es porque un administrador de recursos volátil no realiza la recuperación.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-142">This is because a volatile resource manager does not perform recovery.</span></span> <span data-ttu-id="cc6bb-143">Los métodos <xref:System.Transactions.Transaction.EnlistVolatile%2A> no toman un parámetro <xref:System.Guid>, porque un administrador de recursos volátil no realiza la recuperación y no llama al método <xref:System.Transactions.TransactionManager.Reenlist%2A> que necesita <xref:System.Guid>.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-143">The <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods do not take a <xref:System.Guid> parameter, because a volatile resource manager does not perform recovery and would not call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method which needs a <xref:System.Guid>.</span></span>

<span data-ttu-id="cc6bb-144">Como con inscripciones duraderas, el método de sobrecarga que se utiliza para dar de alta indica al administrador de transacciones si su administrador de recursos admite la optimización de la fase de confirmación única.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-144">As with durable enlistments, whichever overload method you use to enlist denotes to the transaction manager whether your resource manager supports the Single Phase Commit optimization.</span></span> <span data-ttu-id="cc6bb-145">Puesto que un administrador de recursos volátil no puede realizar la recuperación, ninguna información de la recuperación se escribe para una inscripción volátil durante la fase de preparación.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-145">Since a volatile resource manager cannot perform recovery, no recovery information is written for a volatile enlistment during the Prepare phase.</span></span> <span data-ttu-id="cc6bb-146">Por consiguiente, llamar al método <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> produce <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-146">Therefore, calling the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> method results in an <xref:System.InvalidOperationException>.</span></span>

<span data-ttu-id="cc6bb-147">El ejemplo siguiente muestra cómo dar de alta este tipo de objeto como un participante en una transacción utilizando el método <xref:System.Transactions.Transaction.EnlistVolatile%2A>.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-147">The following example shows how to enlist such an object as a participant in a transaction using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> method.</span></span>

[!code-csharp[Tx_Enlist#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_enlist/cs/enlist.cs#1)]
[!code-vb[Tx_Enlist#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_enlist/vb/enlist.vb#1)]

### <a name="optimizing-performance"></a><span data-ttu-id="cc6bb-148">Optimizar el rendimiento</span><span class="sxs-lookup"><span data-stu-id="cc6bb-148">Optimizing Performance</span></span>

<span data-ttu-id="cc6bb-149">La clase <xref:System.Transactions.Transaction> también proporciona el método <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> para dar de alta una Inscripción de fase única promocional (PSPE).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-149">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="cc6bb-150">Esto permite a un administrador de recursos duradero (RM) hospedar y "poseer" una transacción que puede realizar una escalada para que sea administrada por MSDTC si es necesario.</span><span class="sxs-lookup"><span data-stu-id="cc6bb-150">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="cc6bb-151">Para obtener más información, consulte [optimización mediante la confirmación de fase única y la notificación de fase única promocionable](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="cc6bb-151">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="cc6bb-152">Consulte también:</span><span class="sxs-lookup"><span data-stu-id="cc6bb-152">See also</span></span>

- [<span data-ttu-id="cc6bb-153">Optimización mediante el uso de la confirmación de fase única y de la inscripción de fase única promovible</span><span class="sxs-lookup"><span data-stu-id="cc6bb-153">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](optimization-spc-and-promotable-spn.md)
- [<span data-ttu-id="cc6bb-154">Confirmar una transacción en fase única y múltiple</span><span class="sxs-lookup"><span data-stu-id="cc6bb-154">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](committing-a-transaction-in-single-phase-and-multi-phase.md)
