---
title: 'Tutorial: Llamadas a las API de Windows'
ms.date: 07/20/2015
helpviewer_keywords:
- DLLs, calling
- Windows API, walkthroughs
- platform invoke, walkthroughs
- API calls [Visual Basic], walkthroughs [Visual Basic]
- Windows API, calling
- walkthroughs [Visual Basic], API calls
- DllImport attribute, calling Windows API
- Declare statement [Visual Basic], declaring DLL functions
ms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb
ms.openlocfilehash: 88b3df2f18add6641d0355d2c605bc5f74dabbc7
ms.sourcegitcommit: bf5c5850654187705bc94cc40ebfb62fe346ab02
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/23/2020
ms.locfileid: "91098325"
---
# <a name="walkthrough-calling-windows-apis-visual-basic"></a><span data-ttu-id="09bae-102">Tutorial: Llamar a las API de Windows (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="09bae-102">Walkthrough: Calling Windows APIs (Visual Basic)</span></span>

<span data-ttu-id="09bae-103">Las API de Windows son bibliotecas de vínculos dinámicos (dll) que forman parte del sistema operativo Windows.</span><span class="sxs-lookup"><span data-stu-id="09bae-103">Windows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system.</span></span> <span data-ttu-id="09bae-104">Se usan para realizar tareas cuando es difícil escribir procedimientos equivalentes propios.</span><span class="sxs-lookup"><span data-stu-id="09bae-104">You use them to perform tasks when it is difficult to write equivalent procedures of your own.</span></span> <span data-ttu-id="09bae-105">Por ejemplo, Windows proporciona una función denominada `FlashWindowEx` que le permite hacer que la barra de título de una aplicación alterne entre sombras claras y oscuras.</span><span class="sxs-lookup"><span data-stu-id="09bae-105">For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades.</span></span>  
  
 <span data-ttu-id="09bae-106">La ventaja de usar las API de Windows en el código es que pueden ahorrar tiempo de desarrollo porque contienen docenas de funciones útiles que ya están escritas y en espera de usarse.</span><span class="sxs-lookup"><span data-stu-id="09bae-106">The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used.</span></span> <span data-ttu-id="09bae-107">El inconveniente es que las API de Windows pueden ser difíciles de trabajar con y Unforgiving cuando hay algún problema.</span><span class="sxs-lookup"><span data-stu-id="09bae-107">The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.</span></span>  
  
 <span data-ttu-id="09bae-108">Las API de Windows representan una categoría especial de interoperabilidad.</span><span class="sxs-lookup"><span data-stu-id="09bae-108">Windows APIs represent a special category of interoperability.</span></span> <span data-ttu-id="09bae-109">Las API de Windows no usan código administrado, no tienen bibliotecas de tipos integrados y usan tipos de datos que son diferentes de los que se usan con Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="09bae-109">Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio.</span></span> <span data-ttu-id="09bae-110">Debido a estas diferencias, y dado que las API de Windows no son objetos COM, la interoperabilidad con las API de Windows y el .NET Framework se realiza mediante la invocación de plataforma o PInvoke.</span><span class="sxs-lookup"><span data-stu-id="09bae-110">Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the .NET Framework is performed using platform invoke, or PInvoke.</span></span> <span data-ttu-id="09bae-111">La invocación de plataforma es un servicio que permite al código administrado llamar a funciones no administradas implementadas en archivos dll.</span><span class="sxs-lookup"><span data-stu-id="09bae-111">Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs.</span></span> <span data-ttu-id="09bae-112">Para obtener más información, vea [consumir funciones dll no administradas](../../../framework/interop/consuming-unmanaged-dll-functions.md).</span><span class="sxs-lookup"><span data-stu-id="09bae-112">For more information, see [Consuming Unmanaged DLL Functions](../../../framework/interop/consuming-unmanaged-dll-functions.md).</span></span> <span data-ttu-id="09bae-113">Puede usar PInvoke en Visual Basic mediante la `Declare` instrucción o aplicando el `DllImport` atributo a un procedimiento vacío.</span><span class="sxs-lookup"><span data-stu-id="09bae-113">You can use PInvoke in Visual Basic by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure.</span></span>  
  
 <span data-ttu-id="09bae-114">Las llamadas a la API de Windows eran una parte importante de la programación de Visual Basic en el pasado, pero rara vez son necesarias con Visual Basic .NET.</span><span class="sxs-lookup"><span data-stu-id="09bae-114">Windows API calls were an important part of Visual Basic programming in the past, but are seldom necessary with Visual Basic .NET.</span></span> <span data-ttu-id="09bae-115">Siempre que sea posible, debe usar código administrado desde el .NET Framework para realizar tareas, en lugar de llamadas a la API de Windows.</span><span class="sxs-lookup"><span data-stu-id="09bae-115">Whenever possible, you should use managed code from the .NET Framework to perform tasks, instead of Windows API calls.</span></span> <span data-ttu-id="09bae-116">En este tutorial se proporciona información sobre las situaciones en las que es necesario usar las API de Windows.</span><span class="sxs-lookup"><span data-stu-id="09bae-116">This walkthrough provides information for those situations in which using Windows APIs is necessary.</span></span>  
  
[!INCLUDE[note_settings_general](~/includes/note-settings-general-md.md)]  
  
## <a name="api-calls-using-declare"></a><span data-ttu-id="09bae-117">Llamadas API mediante declare</span><span class="sxs-lookup"><span data-stu-id="09bae-117">API Calls Using Declare</span></span>  

 <span data-ttu-id="09bae-118">La forma más común de llamar a las API de Windows es mediante la `Declare` instrucción.</span><span class="sxs-lookup"><span data-stu-id="09bae-118">The most common way to call Windows APIs is by using the `Declare` statement.</span></span>  
  
### <a name="to-declare-a-dll-procedure"></a><span data-ttu-id="09bae-119">Para declarar un procedimiento DLL</span><span class="sxs-lookup"><span data-stu-id="09bae-119">To declare a DLL procedure</span></span>  
  
1. <span data-ttu-id="09bae-120">Determine el nombre de la función a la que desea llamar, además de sus argumentos, tipos de argumentos y valor devuelto, así como el nombre y la ubicación del archivo DLL que lo contiene.</span><span class="sxs-lookup"><span data-stu-id="09bae-120">Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="09bae-121">Para obtener información completa sobre las API de Windows, consulte la documentación del SDK de Win32 en la API de Windows de Platform SDK.</span><span class="sxs-lookup"><span data-stu-id="09bae-121">For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API.</span></span> <span data-ttu-id="09bae-122">Para obtener más información sobre las constantes que usan las API de Windows, examine los archivos de encabezado como Windows. h incluido con el SDK de la plataforma.</span><span class="sxs-lookup"><span data-stu-id="09bae-122">For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.</span></span>  
  
2. <span data-ttu-id="09bae-123">Abra un nuevo proyecto de aplicación para Windows; para ello, haga clic en **nuevo** en el menú **archivo** y, a continuación, haga clic en **proyecto**.</span><span class="sxs-lookup"><span data-stu-id="09bae-123">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="09bae-124">Aparecerá el cuadro de diálogo **Nuevo proyecto** .</span><span class="sxs-lookup"><span data-stu-id="09bae-124">The **New Project** dialog box appears.</span></span>  
  
3. <span data-ttu-id="09bae-125">Seleccione **aplicación de Windows** en la lista de plantillas de proyecto de Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="09bae-125">Select **Windows Application** from the list of Visual Basic project templates.</span></span> <span data-ttu-id="09bae-126">Se muestra el nuevo proyecto.</span><span class="sxs-lookup"><span data-stu-id="09bae-126">The new project is displayed.</span></span>  
  
4. <span data-ttu-id="09bae-127">Agregue la siguiente `Declare` función a la clase o módulo en el que desea utilizar el archivo dll:</span><span class="sxs-lookup"><span data-stu-id="09bae-127">Add the following `Declare` function either to the class or module in which you want to use the DLL:</span></span>  
  
     [!code-vb[VbVbalrInterop#9](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#9)]  
  
### <a name="parts-of-the-declare-statement"></a><span data-ttu-id="09bae-128">Partes de la instrucción Declare</span><span class="sxs-lookup"><span data-stu-id="09bae-128">Parts of the Declare Statement</span></span>  

 <span data-ttu-id="09bae-129">La `Declare` instrucción incluye los siguientes elementos.</span><span class="sxs-lookup"><span data-stu-id="09bae-129">The `Declare` statement includes the following elements.</span></span>  
  
#### <a name="auto-modifier"></a><span data-ttu-id="09bae-130">Auto (modificador)</span><span class="sxs-lookup"><span data-stu-id="09bae-130">Auto modifier</span></span>  

 <span data-ttu-id="09bae-131">El `Auto` modificador indica al tiempo de ejecución que convierta la cadena basándose en el nombre del método de acuerdo con las reglas de Common Language Runtime (o el nombre de alias si se especifica).</span><span class="sxs-lookup"><span data-stu-id="09bae-131">The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).</span></span>  
  
#### <a name="lib-and-alias-keywords"></a><span data-ttu-id="09bae-132">Palabras clave lib y alias</span><span class="sxs-lookup"><span data-stu-id="09bae-132">Lib and Alias keywords</span></span>  

 <span data-ttu-id="09bae-133">El nombre que sigue `Function` a la palabra clave es el nombre que usa el programa para tener acceso a la función importada.</span><span class="sxs-lookup"><span data-stu-id="09bae-133">The name following the `Function` keyword is the name your program uses to access the imported function.</span></span> <span data-ttu-id="09bae-134">Puede ser el mismo nombre real de la función a la que se está llamando, o bien se puede usar cualquier nombre de procedimiento válido y, a continuación, utilizar la `Alias` palabra clave para especificar el nombre real de la función a la que se está llamando.</span><span class="sxs-lookup"><span data-stu-id="09bae-134">It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling.</span></span>  
  
 <span data-ttu-id="09bae-135">Especifique la `Lib` palabra clave, seguida del nombre y la ubicación del archivo DLL que contiene la función a la que llama.</span><span class="sxs-lookup"><span data-stu-id="09bae-135">Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling.</span></span> <span data-ttu-id="09bae-136">No es necesario especificar la ruta de acceso de los archivos que se encuentran en los directorios del sistema de Windows.</span><span class="sxs-lookup"><span data-stu-id="09bae-136">You do not need to specify the path for files located in the Windows system directories.</span></span>  
  
 <span data-ttu-id="09bae-137">Use la `Alias` palabra clave si el nombre de la función a la que se está llamando no es un nombre de procedimiento Visual Basic válido o está en conflicto con el nombre de otros elementos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="09bae-137">Use the `Alias` keyword if the name of the function you are calling is not a valid Visual Basic procedure name, or conflicts with the name of other items in your application.</span></span> <span data-ttu-id="09bae-138">`Alias` indica el nombre real de la función que se va a llamar.</span><span class="sxs-lookup"><span data-stu-id="09bae-138">`Alias` indicates the true name of the function being called.</span></span>  
  
#### <a name="argument-and-data-type-declarations"></a><span data-ttu-id="09bae-139">Declaraciones de argumentos y tipos de datos</span><span class="sxs-lookup"><span data-stu-id="09bae-139">Argument and Data Type Declarations</span></span>  

 <span data-ttu-id="09bae-140">Declare los argumentos y sus tipos de datos.</span><span class="sxs-lookup"><span data-stu-id="09bae-140">Declare the arguments and their data types.</span></span> <span data-ttu-id="09bae-141">Esta parte puede ser desafiante, ya que los tipos de datos que usa Windows no se corresponden con los tipos de datos de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="09bae-141">This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types.</span></span> <span data-ttu-id="09bae-142">Visual Basic realiza una gran cantidad de trabajo mediante la conversión de argumentos en tipos de datos compatibles, un proceso denominado *serialización*.</span><span class="sxs-lookup"><span data-stu-id="09bae-142">Visual Basic does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*.</span></span> <span data-ttu-id="09bae-143">Puede controlar explícitamente cómo se calculan las referencias de los argumentos mediante el <xref:System.Runtime.InteropServices.MarshalAsAttribute> atributo definido en el <xref:System.Runtime.InteropServices> espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="09bae-143">You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="09bae-144">Las versiones anteriores de Visual Basic permitían declarar parámetros `As Any` , lo que significa que se pueden usar datos de cualquier tipo de datos.</span><span class="sxs-lookup"><span data-stu-id="09bae-144">Previous versions of Visual Basic allowed you to declare parameters `As Any`, meaning that data of any data type could be used.</span></span> <span data-ttu-id="09bae-145">Visual Basic requiere que se use un tipo de datos específico para todas las `Declare` instrucciones.</span><span class="sxs-lookup"><span data-stu-id="09bae-145">Visual Basic requires that you use a specific data type for all `Declare` statements.</span></span>  
  
#### <a name="windows-api-constants"></a><span data-ttu-id="09bae-146">Constantes de la API de Windows</span><span class="sxs-lookup"><span data-stu-id="09bae-146">Windows API Constants</span></span>  

 <span data-ttu-id="09bae-147">Algunos argumentos son combinaciones de constantes.</span><span class="sxs-lookup"><span data-stu-id="09bae-147">Some arguments are combinations of constants.</span></span> <span data-ttu-id="09bae-148">Por ejemplo, la `MessageBox` API mostrada en este tutorial acepta un argumento de entero denominado `Typ` que controla cómo se muestra el cuadro de mensaje.</span><span class="sxs-lookup"><span data-stu-id="09bae-148">For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed.</span></span> <span data-ttu-id="09bae-149">Puede determinar el valor numérico de estas constantes mediante el examen de las `#define` instrucciones del archivo WinUser. h.</span><span class="sxs-lookup"><span data-stu-id="09bae-149">You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h.</span></span> <span data-ttu-id="09bae-150">Los valores numéricos se suelen mostrar en formato hexadecimal, por lo que es posible que desee usar una calculadora para agregarlos y convertirlos a decimal.</span><span class="sxs-lookup"><span data-stu-id="09bae-150">The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal.</span></span> <span data-ttu-id="09bae-151">Por ejemplo, si desea combinar las constantes del estilo de exclamación `MB_ICONEXCLAMATION` 0x00000030 y el estilo yes/no `MB_YESNO` 0x00000004, puede Agregar los números y obtener un resultado de 0x00000034 o 52 decimal.</span><span class="sxs-lookup"><span data-stu-id="09bae-151">For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal.</span></span> <span data-ttu-id="09bae-152">Aunque puede usar el resultado decimal directamente, es mejor declarar estos valores como constantes en la aplicación y combinarlos mediante el `Or` operador.</span><span class="sxs-lookup"><span data-stu-id="09bae-152">Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator.</span></span>  
  
##### <a name="to-declare-constants-for-windows-api-calls"></a><span data-ttu-id="09bae-153">Para declarar constantes para las llamadas a la API de Windows</span><span class="sxs-lookup"><span data-stu-id="09bae-153">To declare constants for Windows API calls</span></span>  
  
1. <span data-ttu-id="09bae-154">Consulte la documentación de la función de Windows a la que está llamando.</span><span class="sxs-lookup"><span data-stu-id="09bae-154">Consult the documentation for the Windows function you are calling.</span></span> <span data-ttu-id="09bae-155">Determine el nombre de las constantes que utiliza y el nombre del archivo. h que contiene los valores numéricos de estas constantes.</span><span class="sxs-lookup"><span data-stu-id="09bae-155">Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.</span></span>  
  
2. <span data-ttu-id="09bae-156">Use un editor de texto, como el Bloc de notas, para ver el contenido del archivo de encabezado (. h) y buscar los valores asociados a las constantes que está usando.</span><span class="sxs-lookup"><span data-stu-id="09bae-156">Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using.</span></span> <span data-ttu-id="09bae-157">Por ejemplo, la `MessageBox` API usa la constante `MB_ICONQUESTION` para mostrar un signo de interrogación en el cuadro de mensaje.</span><span class="sxs-lookup"><span data-stu-id="09bae-157">For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box.</span></span> <span data-ttu-id="09bae-158">La definición de `MB_ICONQUESTION` está en WinUser. h y aparece de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="09bae-158">The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:</span></span>  
  
     `#define MB_ICONQUESTION             0x00000020L`  
  
3. <span data-ttu-id="09bae-159">Agregue instrucciones equivalentes `Const` a la clase o módulo para que estas constantes estén disponibles para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="09bae-159">Add equivalent `Const` statements to your class or module to make these constants available to your application.</span></span> <span data-ttu-id="09bae-160">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="09bae-160">For example:</span></span>  
  
     [!code-vb[VbVbalrInterop#11](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#11)]  
  
###### <a name="to-call-the-dll-procedure"></a><span data-ttu-id="09bae-161">Para llamar al procedimiento DLL</span><span class="sxs-lookup"><span data-stu-id="09bae-161">To call the DLL procedure</span></span>  
  
1. <span data-ttu-id="09bae-162">Agregue un botón denominado `Button1` al formulario de inicio para el proyecto y, a continuación, haga doble clic en él para ver su código.</span><span class="sxs-lookup"><span data-stu-id="09bae-162">Add a button named `Button1` to the startup form for your project, and then double-click it to view its code.</span></span> <span data-ttu-id="09bae-163">Se muestra el controlador de eventos para el botón.</span><span class="sxs-lookup"><span data-stu-id="09bae-163">The event handler for the button is displayed.</span></span>  
  
2. <span data-ttu-id="09bae-164">Agregue código al `Click` controlador de eventos para el botón que agregó, para llamar al procedimiento y proporcione los argumentos adecuados:</span><span class="sxs-lookup"><span data-stu-id="09bae-164">Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:</span></span>  
  
     [!code-vb[VbVbalrInterop#12](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#12)]  
  
3. <span data-ttu-id="09bae-165">Ejecute el proyecto presionando F5.</span><span class="sxs-lookup"><span data-stu-id="09bae-165">Run the project by pressing F5.</span></span> <span data-ttu-id="09bae-166">El cuadro de mensaje se muestra con los botones **sí** y **sin** respuesta.</span><span class="sxs-lookup"><span data-stu-id="09bae-166">The message box is displayed with both **Yes** and **No** response buttons.</span></span> <span data-ttu-id="09bae-167">Haga clic en cualquiera de ellas.</span><span class="sxs-lookup"><span data-stu-id="09bae-167">Click either one.</span></span>  
  
#### <a name="data-marshaling"></a><span data-ttu-id="09bae-168">Serialización de datos</span><span class="sxs-lookup"><span data-stu-id="09bae-168">Data Marshaling</span></span>  

 <span data-ttu-id="09bae-169">Visual Basic convierte automáticamente los tipos de datos de los parámetros y los valores devueltos para las llamadas a la API de Windows, pero puede usar el `MarshalAs` atributo para especificar explícitamente los tipos de datos no administrados que una API espera.</span><span class="sxs-lookup"><span data-stu-id="09bae-169">Visual Basic automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects.</span></span> <span data-ttu-id="09bae-170">Para obtener más información sobre el cálculo de referencias de interoperabilidad, vea [serialización de interoperabilidad](../../../framework/interop/interop-marshaling.md).</span><span class="sxs-lookup"><span data-stu-id="09bae-170">For more information about interop marshaling, see [Interop Marshaling](../../../framework/interop/interop-marshaling.md).</span></span>  
  
##### <a name="to-use-declare-and-marshalas-in-an-api-call"></a><span data-ttu-id="09bae-171">Para usar declare y MarshalAs en una llamada API</span><span class="sxs-lookup"><span data-stu-id="09bae-171">To use Declare and MarshalAs in an API call</span></span>  
  
1. <span data-ttu-id="09bae-172">Determine el nombre de la función a la que desea llamar, además de sus argumentos, tipos de datos y valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="09bae-172">Determine the name of the function you want to call, plus its arguments, data types, and return value.</span></span>  
  
2. <span data-ttu-id="09bae-173">Para simplificar el acceso al `MarshalAs` atributo, agregue una `Imports` instrucción a la parte superior del código de la clase o módulo, como en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="09bae-173">To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:</span></span>  
  
     [!code-vb[VbVbalrInterop#13](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#13)]  
  
3. <span data-ttu-id="09bae-174">Agregue un prototipo de función para la función importada a la clase o módulo que está usando y aplique el `MarshalAs` atributo a los parámetros o el valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="09bae-174">Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value.</span></span> <span data-ttu-id="09bae-175">En el ejemplo siguiente, se calculan las referencias de una llamada API que espera que el tipo `void*` sea `AsAny` :</span><span class="sxs-lookup"><span data-stu-id="09bae-175">In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:</span></span>  
  
     [!code-vb[VbVbalrInterop#14](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#14)]  
  
## <a name="api-calls-using-dllimport"></a><span data-ttu-id="09bae-176">Llamadas API con DllImport</span><span class="sxs-lookup"><span data-stu-id="09bae-176">API Calls Using DllImport</span></span>  

 <span data-ttu-id="09bae-177">El `DllImport` atributo proporciona una segunda manera de llamar a funciones en archivos dll sin bibliotecas de tipos.</span><span class="sxs-lookup"><span data-stu-id="09bae-177">The `DllImport` attribute provides a second way to call functions in DLLs without type libraries.</span></span> <span data-ttu-id="09bae-178">`DllImport` es aproximadamente equivalente a utilizar una `Declare` instrucción pero proporciona más control sobre cómo se llama a las funciones.</span><span class="sxs-lookup"><span data-stu-id="09bae-178">`DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called.</span></span>  
  
 <span data-ttu-id="09bae-179">Puede usar `DllImport` con la mayoría de las llamadas a la API de Windows siempre y cuando la llamada haga referencia a un método compartido (a veces denominado *static*).</span><span class="sxs-lookup"><span data-stu-id="09bae-179">You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method.</span></span> <span data-ttu-id="09bae-180">No se pueden usar métodos que requieran una instancia de una clase.</span><span class="sxs-lookup"><span data-stu-id="09bae-180">You cannot use methods that require an instance of a class.</span></span> <span data-ttu-id="09bae-181">A diferencia `Declare` de las instrucciones, `DllImport` las llamadas no pueden usar el `MarshalAs` atributo.</span><span class="sxs-lookup"><span data-stu-id="09bae-181">Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute.</span></span>  
  
### <a name="to-call-a-windows-api-using-the-dllimport-attribute"></a><span data-ttu-id="09bae-182">Para llamar a una API de Windows mediante el atributo DllImport</span><span class="sxs-lookup"><span data-stu-id="09bae-182">To call a Windows API using the DllImport attribute</span></span>  
  
1. <span data-ttu-id="09bae-183">Abra un nuevo proyecto de aplicación para Windows; para ello, haga clic en **nuevo** en el menú **archivo** y, a continuación, haga clic en **proyecto**.</span><span class="sxs-lookup"><span data-stu-id="09bae-183">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="09bae-184">Aparecerá el cuadro de diálogo **Nuevo proyecto** .</span><span class="sxs-lookup"><span data-stu-id="09bae-184">The **New Project** dialog box appears.</span></span>  
  
2. <span data-ttu-id="09bae-185">Seleccione **aplicación de Windows** en la lista de plantillas de proyecto de Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="09bae-185">Select **Windows Application** from the list of Visual Basic project templates.</span></span> <span data-ttu-id="09bae-186">Se muestra el nuevo proyecto.</span><span class="sxs-lookup"><span data-stu-id="09bae-186">The new project is displayed.</span></span>  
  
3. <span data-ttu-id="09bae-187">Agregue un botón denominado `Button2` al formulario de inicio.</span><span class="sxs-lookup"><span data-stu-id="09bae-187">Add a button named `Button2` to the startup form.</span></span>  
  
4. <span data-ttu-id="09bae-188">Haga doble clic `Button2` para abrir la vista de código del formulario.</span><span class="sxs-lookup"><span data-stu-id="09bae-188">Double-click `Button2` to open the code view for the form.</span></span>  
  
5. <span data-ttu-id="09bae-189">Para simplificar el acceso a `DllImport` , agregue una `Imports` instrucción a la parte superior del código para la clase de formulario de Inicio:</span><span class="sxs-lookup"><span data-stu-id="09bae-189">To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:</span></span>  
  
     [!code-vb[VbVbalrInterop#13](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#13)]  
  
6. <span data-ttu-id="09bae-190">Declare una función vacía antes de la `End Class` instrucción del formulario y asigne un nombre a la función `MoveFile` .</span><span class="sxs-lookup"><span data-stu-id="09bae-190">Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`.</span></span>  
  
7. <span data-ttu-id="09bae-191">Aplique los `Public` `Shared` modificadores y a la declaración de función y establezca los parámetros para en `MoveFile` función de los argumentos que usa la función de la API de Windows:</span><span class="sxs-lookup"><span data-stu-id="09bae-191">Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:</span></span>  
  
     [!code-vb[VbVbalrInterop#16](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#16)]  
  
     <span data-ttu-id="09bae-192">La función puede tener cualquier nombre de procedimiento válido; el `DllImport` atributo especifica el nombre del archivo dll.</span><span class="sxs-lookup"><span data-stu-id="09bae-192">Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL.</span></span> <span data-ttu-id="09bae-193">También controla el cálculo de referencias de interoperabilidad para los parámetros y los valores devueltos, por lo que puede elegir los tipos de datos de Visual Studio que son similares a los tipos de datos que usa la API.</span><span class="sxs-lookup"><span data-stu-id="09bae-193">It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.</span></span>  
  
8. <span data-ttu-id="09bae-194">Aplique el `DllImport` atributo a la función vacía.</span><span class="sxs-lookup"><span data-stu-id="09bae-194">Apply the `DllImport` attribute to the empty function.</span></span> <span data-ttu-id="09bae-195">El primer parámetro es el nombre y la ubicación del archivo DLL que contiene la función a la que se está llamando.</span><span class="sxs-lookup"><span data-stu-id="09bae-195">The first parameter is the name and location of the DLL containing the function you are calling.</span></span> <span data-ttu-id="09bae-196">No es necesario especificar la ruta de acceso de los archivos que se encuentran en los directorios del sistema de Windows.</span><span class="sxs-lookup"><span data-stu-id="09bae-196">You do not need to specify the path for files located in the Windows system directories.</span></span> <span data-ttu-id="09bae-197">El segundo parámetro es un argumento con nombre que especifica el nombre de la función en la API de Windows.</span><span class="sxs-lookup"><span data-stu-id="09bae-197">The second parameter is a named argument that specifies the name of the function in the Windows API.</span></span> <span data-ttu-id="09bae-198">En este ejemplo, el `DllImport` atributo obliga a que `MoveFile` se reenvíen las llamadas a `MoveFileW` en KERNEL32.DLL.</span><span class="sxs-lookup"><span data-stu-id="09bae-198">In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL.</span></span> <span data-ttu-id="09bae-199">El `MoveFileW` método copia un archivo de la ruta de acceso `src` a la ruta de acceso `dst` .</span><span class="sxs-lookup"><span data-stu-id="09bae-199">The `MoveFileW` method copies a file from the path `src` to the path `dst`.</span></span>  
  
     [!code-vb[VbVbalrInterop#17](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#17)]  
  
9. <span data-ttu-id="09bae-200">Agregue código al `Button2_Click` controlador de eventos para llamar a la función:</span><span class="sxs-lookup"><span data-stu-id="09bae-200">Add code to the `Button2_Click` event handler to call the function:</span></span>  
  
     [!code-vb[VbVbalrInterop#18](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#18)]  
  
10. <span data-ttu-id="09bae-201">Cree un archivo denominado Test.txt y colóquelo en el directorio C:\Tmp del disco duro.</span><span class="sxs-lookup"><span data-stu-id="09bae-201">Create a file named Test.txt and place it in the C:\Tmp directory on your hard drive.</span></span> <span data-ttu-id="09bae-202">Cree el directorio tmp si es necesario.</span><span class="sxs-lookup"><span data-stu-id="09bae-202">Create the Tmp directory if necessary.</span></span>  
  
11. <span data-ttu-id="09bae-203">Presione F5 para iniciar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="09bae-203">Press F5 to start the application.</span></span> <span data-ttu-id="09bae-204">Aparece el formulario principal.</span><span class="sxs-lookup"><span data-stu-id="09bae-204">The main form appears.</span></span>  
  
12. <span data-ttu-id="09bae-205">Haga clic en **BUTTON2**.</span><span class="sxs-lookup"><span data-stu-id="09bae-205">Click **Button2**.</span></span> <span data-ttu-id="09bae-206">Se muestra el mensaje "el archivo se ha despasado correctamente" si se puede cambiar el archivo.</span><span class="sxs-lookup"><span data-stu-id="09bae-206">The message "The file was moved successfully" is displayed if the file can be moved.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="09bae-207">Vea también</span><span class="sxs-lookup"><span data-stu-id="09bae-207">See also</span></span>

- <xref:System.Runtime.InteropServices.DllImportAttribute>
- <xref:System.Runtime.InteropServices.MarshalAsAttribute>
- [<span data-ttu-id="09bae-208">Declare Statement</span><span class="sxs-lookup"><span data-stu-id="09bae-208">Declare Statement</span></span>](../../language-reference/statements/declare-statement.md)
- [<span data-ttu-id="09bae-209">Auto</span><span class="sxs-lookup"><span data-stu-id="09bae-209">Auto</span></span>](../../language-reference/modifiers/auto.md)
- [<span data-ttu-id="09bae-210">Alias</span><span class="sxs-lookup"><span data-stu-id="09bae-210">Alias</span></span>](../../language-reference/statements/alias-clause.md)
- [<span data-ttu-id="09bae-211">Interoperabilidad COM</span><span class="sxs-lookup"><span data-stu-id="09bae-211">COM Interop</span></span>](index.md)
- [<span data-ttu-id="09bae-212">Crear prototipos en código administrado</span><span class="sxs-lookup"><span data-stu-id="09bae-212">Creating Prototypes in Managed Code</span></span>](../../../framework/interop/creating-prototypes-in-managed-code.md)
- [<span data-ttu-id="09bae-213">Calcular las referencias de un delegado como un método de devolución de llamada</span><span class="sxs-lookup"><span data-stu-id="09bae-213">Marshaling a Delegate as a Callback Method</span></span>](../../../framework/interop/marshaling-a-delegate-as-a-callback-method.md)
