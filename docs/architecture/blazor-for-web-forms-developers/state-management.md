---
title: Administración de estado
description: Obtenga información sobre los distintos enfoques para administrar el estado en los formularios Web Forms de ASP.NET y el increíble.
author: csharpfritz
ms.author: jefritz
ms.date: 05/15/2020
ms.openlocfilehash: 2ca811f886c6a245ac16c2bd66a68ff16e5bfc44
ms.sourcegitcommit: 0100be20fcf23f61dab672deced70059ed71bb2e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/17/2020
ms.locfileid: "88267729"
---
# <a name="state-management"></a><span data-ttu-id="1dc11-103">Administración de estado</span><span class="sxs-lookup"><span data-stu-id="1dc11-103">State management</span></span>

<span data-ttu-id="1dc11-104">La administración de Estados es un concepto clave de las aplicaciones de formularios Web Forms, que facilitan el estado de vista, el estado de la sesión, el estado de la aplicación y las características de postback.</span><span class="sxs-lookup"><span data-stu-id="1dc11-104">State management is a key concept of Web Forms applications, facilitated through View State, Session State, Application State, and Postback features.</span></span> <span data-ttu-id="1dc11-105">Estas características con estado de Framework ayudaron a ocultar la administración de Estados necesaria para una aplicación y permitir a los desarrolladores de aplicaciones centrarse en la entrega de su funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="1dc11-105">These stateful features of the framework helped to hide the state management required for an application and allow application developers to focus on delivering their functionality.</span></span> <span data-ttu-id="1dc11-106">Con ASP.NET Core y extraordinaria, algunas de estas características se han reubicado y algunas se han quitado por completo.</span><span class="sxs-lookup"><span data-stu-id="1dc11-106">With ASP.NET Core and Blazor, some of these features have been relocated and some have been removed altogether.</span></span> <span data-ttu-id="1dc11-107">En este capítulo se describe cómo mantener el estado y ofrecer la misma funcionalidad con las nuevas características de extraordinarias.</span><span class="sxs-lookup"><span data-stu-id="1dc11-107">This chapter reviews how to maintain state and deliver the same functionality with the new features in Blazor.</span></span>

## <a name="request-state-management-with-viewstate"></a><span data-ttu-id="1dc11-108">Solicitar la administración de Estados con ViewState</span><span class="sxs-lookup"><span data-stu-id="1dc11-108">Request state management with ViewState</span></span>

<span data-ttu-id="1dc11-109">Al hablar sobre la administración de Estados en una aplicación de formularios Web Forms, muchos desarrolladores se compensarán inmediatamente de ViewState.</span><span class="sxs-lookup"><span data-stu-id="1dc11-109">When discussing state management in Web Forms application, many developers will immediately think of ViewState.</span></span> <span data-ttu-id="1dc11-110">En los formularios Web Forms, ViewState administra el estado del contenido entre las solicitudes HTTP mediante el envío de un bloque de texto codificado grande hacia atrás y hacia delante al explorador.</span><span class="sxs-lookup"><span data-stu-id="1dc11-110">In Web Forms, ViewState manages the state of the content between HTTP requests by sending a large encoded block of text back and forth to the browser.</span></span> <span data-ttu-id="1dc11-111">El campo ViewState podría saturarse con el contenido de una página que contiene muchos elementos, lo que puede llegar a tener un tamaño de varios megabytes.</span><span class="sxs-lookup"><span data-stu-id="1dc11-111">The ViewState field could be overwhelmed with content from a page containing many elements, potentially expanding to several megabytes in size.</span></span>

<span data-ttu-id="1dc11-112">Con un servidor más impresionante, la aplicación mantiene una conexión continua con el servidor.</span><span class="sxs-lookup"><span data-stu-id="1dc11-112">With Blazor Server, the app maintains an ongoing connection with the server.</span></span> <span data-ttu-id="1dc11-113">El estado de la aplicación, denominado *circuito*, se mantiene en la memoria del servidor mientras la conexión se considera activa.</span><span class="sxs-lookup"><span data-stu-id="1dc11-113">The app's state, called a *circuit*, is held in server memory while the connection is considered active.</span></span> <span data-ttu-id="1dc11-114">El estado solo se eliminará cuando el usuario navegue fuera de la aplicación o de una página determinada de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1dc11-114">State will only be disposed when the user navigates away from the app or a particular page in the app.</span></span> <span data-ttu-id="1dc11-115">Todos los miembros de los componentes activos están disponibles entre las interacciones con el servidor.</span><span class="sxs-lookup"><span data-stu-id="1dc11-115">All members of the active components are available between interactions with the server.</span></span>

<span data-ttu-id="1dc11-116">Hay varias ventajas de esta característica:</span><span class="sxs-lookup"><span data-stu-id="1dc11-116">There are several advantages of this feature:</span></span>

- <span data-ttu-id="1dc11-117">El estado del componente está disponible fácilmente y no se vuelve a generar entre las interacciones.</span><span class="sxs-lookup"><span data-stu-id="1dc11-117">Component state is readily available and not rebuilt between interactions.</span></span>
- <span data-ttu-id="1dc11-118">El estado no se transmite al explorador.</span><span class="sxs-lookup"><span data-stu-id="1dc11-118">State isn't transmitted to the browser.</span></span>

<span data-ttu-id="1dc11-119">Sin embargo, hay algunas desventajas de la persistencia del estado del componente en memoria que debe tener en cuenta:</span><span class="sxs-lookup"><span data-stu-id="1dc11-119">However, there are some disadvantages to in-memory component state persistence to be aware of:</span></span>

- <span data-ttu-id="1dc11-120">Si el servidor se reinicia entre las solicitudes, el estado se pierde.</span><span class="sxs-lookup"><span data-stu-id="1dc11-120">If the server restarts between request, state is lost.</span></span>
- <span data-ttu-id="1dc11-121">La solución de equilibrio de carga del servidor Web de la aplicación debe incluir sesiones permanentes para asegurarse de que todas las solicitudes del mismo explorador vuelvan al mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="1dc11-121">Your application web server load-balancing solution must include sticky sessions to ensure that all requests from the same browser return to the same server.</span></span> <span data-ttu-id="1dc11-122">Si una solicitud va a un servidor diferente, se perderá el estado.</span><span class="sxs-lookup"><span data-stu-id="1dc11-122">If a request goes to a different server, state will be lost.</span></span>
- <span data-ttu-id="1dc11-123">La persistencia del estado del componente en el servidor puede provocar la presión de memoria en el servidor Web.</span><span class="sxs-lookup"><span data-stu-id="1dc11-123">Persistence of component state on the server can lead to memory pressure on the web server.</span></span>

<span data-ttu-id="1dc11-124">Por los motivos anteriores, no confíe solo en el estado del componente para que resida en memoria en el servidor.</span><span class="sxs-lookup"><span data-stu-id="1dc11-124">For the preceding reasons, don't rely on just the state of the component to reside in-memory on the server.</span></span> <span data-ttu-id="1dc11-125">La aplicación también debe incluir algún almacén de datos de respaldo para los datos entre las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="1dc11-125">Your application should also include some backing data store for data between requests.</span></span> <span data-ttu-id="1dc11-126">Algunos ejemplos sencillos de esta estrategia son:</span><span class="sxs-lookup"><span data-stu-id="1dc11-126">Some simple examples of this strategy:</span></span>

- <span data-ttu-id="1dc11-127">En una aplicación de carro de la compra, conserve el contenido de los nuevos elementos agregados al carro en un registro de base de datos.</span><span class="sxs-lookup"><span data-stu-id="1dc11-127">In a shopping cart application, persist the content of new items added to the cart in a database record.</span></span> <span data-ttu-id="1dc11-128">Si se pierde el estado en el servidor, puede reconstituirlo a partir de los registros de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="1dc11-128">If the state on the server is lost, you can reconstitute it from the database records.</span></span>
- <span data-ttu-id="1dc11-129">En un formulario web de varias partes, los usuarios esperarán que la aplicación Recuerde valores entre cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="1dc11-129">In a multi-part web form, your users will expect your application to remember values between each request.</span></span> <span data-ttu-id="1dc11-130">Escriba los datos entre cada una de las entradas del usuario en un almacén de datos para que se puedan capturar y ensamblar en la estructura de respuesta de formulario final cuando se complete el formulario de varias partes.</span><span class="sxs-lookup"><span data-stu-id="1dc11-130">Write the data between each of your user's posts to a data store so that they can be fetched and assembled into the final form response structure when the multi-part form is completed.</span></span>

<span data-ttu-id="1dc11-131">Para obtener más información sobre cómo administrar el estado en las aplicaciones de extraordinarias, consulte [ASP.net Core la administración de Estados de increíbles](/aspnet/core/blazor/state-management).</span><span class="sxs-lookup"><span data-stu-id="1dc11-131">For additional details on managing state in Blazor apps, see [ASP.NET Core Blazor state management](/aspnet/core/blazor/state-management).</span></span>

## <a name="maintain-state-with-session"></a><span data-ttu-id="1dc11-132">Mantener el estado con la sesión</span><span class="sxs-lookup"><span data-stu-id="1dc11-132">Maintain state with Session</span></span>

<span data-ttu-id="1dc11-133">Los desarrolladores de formularios Web Forms pueden mantener información sobre el usuario que actualmente actúa con el <xref:Microsoft.AspNetCore.Http.ISession?displayProperty=nameWithType> objeto de diccionario.</span><span class="sxs-lookup"><span data-stu-id="1dc11-133">Web Forms developers could maintain information about the currently acting user with the <xref:Microsoft.AspNetCore.Http.ISession?displayProperty=nameWithType> dictionary object.</span></span> <span data-ttu-id="1dc11-134">Es bastante fácil agregar un objeto con una clave de cadena a la `Session` , y dicho objeto estará disponible en otro momento durante las interacciones del usuario con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1dc11-134">It's easy enough to add an object with a string key to the `Session`, and that object would be available at a later time during the user's interactions with the application.</span></span> <span data-ttu-id="1dc11-135">En un intento de eliminar la administración de la interacción con HTTP, el `Session` objeto hace que sea fácil mantener el estado.</span><span class="sxs-lookup"><span data-stu-id="1dc11-135">In an attempt to eliminate managing interacting with HTTP, the `Session` object made it easy to maintain state.</span></span>

<span data-ttu-id="1dc11-136">La firma del objeto .NET Framework `Session` no es igual que la ASP.net Core `Session` objeto.</span><span class="sxs-lookup"><span data-stu-id="1dc11-136">The signature of the .NET Framework `Session` object isn't the same as the ASP.NET Core `Session` object.</span></span> <span data-ttu-id="1dc11-137">Tenga en cuenta [la documentación de la nueva sesión de ASP.net Core](/dotnet/api/microsoft.aspnetcore.http.isession) antes de decidir si migrar y usar la nueva característica de estado de sesión.</span><span class="sxs-lookup"><span data-stu-id="1dc11-137">Consider [the documentation for the new ASP.NET Core Session](/dotnet/api/microsoft.aspnetcore.http.isession) before deciding to migrate and use the new session state feature.</span></span>

<span data-ttu-id="1dc11-138">La sesión está disponible en ASP.NET Core y en un servidor más rápido, pero no se recomienda su uso en favor del almacenamiento de datos en un repositorio de datos de forma adecuada.</span><span class="sxs-lookup"><span data-stu-id="1dc11-138">Session is available in ASP.NET Core and Blazor Server, but is discouraged from use in favor of storing data in a data repository appropriately.</span></span> <span data-ttu-id="1dc11-139">El estado de sesión tampoco es funcional si los visitantes rechazan el uso de cookies HTTP en la aplicación debido a problemas de privacidad.</span><span class="sxs-lookup"><span data-stu-id="1dc11-139">Session state is also not functional if visitors decline the use HTTP cookies in your application due to privacy concerns.</span></span>

<span data-ttu-id="1dc11-140">La configuración de ASP.NET Core y el estado de sesión está disponible en el [artículo administración de la sesión y el estado en ASP.net Core](/aspnet/core/fundamentals/app-state#session-state).</span><span class="sxs-lookup"><span data-stu-id="1dc11-140">Configuration for ASP.NET Core and Session state is available in the [Session and state management in ASP.NET Core article](/aspnet/core/fundamentals/app-state#session-state).</span></span>

## <a name="application-state"></a><span data-ttu-id="1dc11-141">Estado de la aplicación</span><span class="sxs-lookup"><span data-stu-id="1dc11-141">Application state</span></span>

<span data-ttu-id="1dc11-142">El `Application` objeto en el marco de trabajo de formularios Web Forms proporciona un repositorio masivo de solicitudes cruzadas para interactuar con la configuración y el estado del ámbito de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1dc11-142">The `Application` object in the Web Forms framework provides a massive, cross-request repository for interacting with application-scope configuration and state.</span></span> <span data-ttu-id="1dc11-143">El estado de la aplicación era un lugar ideal para almacenar varias propiedades de configuración de la aplicación a las que se haría referencia en todas las solicitudes, independientemente del usuario que realiza la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1dc11-143">Application state was an ideal place to store various application configuration properties that would be referenced by all requests, regardless of the user making the request.</span></span> <span data-ttu-id="1dc11-144">El problema con el `Application` objeto era que los datos no se conservaban entre varios servidores.</span><span class="sxs-lookup"><span data-stu-id="1dc11-144">The problem with the `Application` object was that data didn't persist across multiple servers.</span></span> <span data-ttu-id="1dc11-145">El estado del objeto de aplicación se perdió entre reinicios.</span><span class="sxs-lookup"><span data-stu-id="1dc11-145">The state of the application object was lost between restarts.</span></span>

<span data-ttu-id="1dc11-146">Al igual que con `Session` , se recomienda que los datos se muevan a una memoria auxiliar persistente a la que puedan tener acceso varias instancias de servidor.</span><span class="sxs-lookup"><span data-stu-id="1dc11-146">As with `Session`, it's recommended that data move to a persistent backing store that could be accessed by multiple server instances.</span></span> <span data-ttu-id="1dc11-147">Si hay datos volátiles a los que desea poder tener acceso a través de solicitudes y usuarios, puede almacenarlos fácilmente en un servicio singleton que se puede insertar en componentes que requieran esta información o interacción.</span><span class="sxs-lookup"><span data-stu-id="1dc11-147">If there is volatile data that you would like to be able to access across requests and users, you could easily store it in a singleton service that can be injected into components that require this information or interaction.</span></span>

<span data-ttu-id="1dc11-148">La construcción de un objeto para mantener el estado de la aplicación y su consumo podría ser similar a la siguiente implementación:</span><span class="sxs-lookup"><span data-stu-id="1dc11-148">The construction of an object to maintain application state and its consumption could resemble the following implementation:</span></span>

```csharp
public class MyApplicationState
{
    public int VisitorCounter { get; private set; } = 0;

    public void IncrementCounter() => VisitorCounter += 1;
}
```

```csharp
app.AddSingleton<MyApplicationState>();
```

```razor
@inject MyApplicationState AppState

<label>Total Visitors: @AppState.VisitorCounter</label>
```

<span data-ttu-id="1dc11-149">El `MyApplicationState` objeto se crea solo una vez en el servidor, y el valor `VisitorCounter` se captura y se genera en la etiqueta del componente.</span><span class="sxs-lookup"><span data-stu-id="1dc11-149">The `MyApplicationState` object is created only once on the server, and the value `VisitorCounter` is fetched and output in the component's label.</span></span> <span data-ttu-id="1dc11-150">El `VisitorCounter` valor se debe conservar y recuperar de un almacén de datos de respaldo para la durabilidad y la escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="1dc11-150">The `VisitorCounter` value should be persisted and retrieved from a backing data store for durability and scalability.</span></span>

## <a name="in-the-browser"></a><span data-ttu-id="1dc11-151">En el explorador</span><span class="sxs-lookup"><span data-stu-id="1dc11-151">In the browser</span></span>

<span data-ttu-id="1dc11-152">Los datos de la aplicación también se pueden almacenar en el lado cliente en el dispositivo del usuario para que esté disponible más adelante.</span><span class="sxs-lookup"><span data-stu-id="1dc11-152">Application data can also be stored client-side on the user's device so that is available later.</span></span> <span data-ttu-id="1dc11-153">Hay dos características del explorador que permiten la persistencia de los datos en diferentes ámbitos del explorador del usuario:</span><span class="sxs-lookup"><span data-stu-id="1dc11-153">There are two browser features that allow for persistence of data in different scopes of the user's browser:</span></span>

- <span data-ttu-id="1dc11-154">`localStorage` -ámbito en el explorador completo del usuario.</span><span class="sxs-lookup"><span data-stu-id="1dc11-154">`localStorage` - scoped to the user's entire browser.</span></span> <span data-ttu-id="1dc11-155">Si se vuelve a cargar la página, el explorador se cierra y se vuelve a abrir, o bien se abre otra pestaña con la misma dirección URL, el `localStorage` Explorador lo proporciona</span><span class="sxs-lookup"><span data-stu-id="1dc11-155">If the page is reloaded, the browser is closed and reopened, or another tab is opened with the same URL then the same `localStorage` is provided by the browser</span></span>
- <span data-ttu-id="1dc11-156">`sessionStorage` -ámbito de la pestaña del explorador actual del usuario. Si se vuelve a cargar la pestaña, el estado persiste.</span><span class="sxs-lookup"><span data-stu-id="1dc11-156">`sessionStorage` - scoped to the user's current browser tab. If the tab is reloaded, the state persists.</span></span> <span data-ttu-id="1dc11-157">Sin embargo, si el usuario abre otra pestaña en la aplicación o cierra y vuelve a abrir el explorador, se pierde el estado.</span><span class="sxs-lookup"><span data-stu-id="1dc11-157">However, if the user opens another tab to your application or closes and reopens the browser the state is lost.</span></span>

<span data-ttu-id="1dc11-158">Puede escribir código JavaScript personalizado para interactuar con estas características, o hay una serie de paquetes de NuGet que puede usar para proporcionar esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="1dc11-158">You can write some custom JavaScript code to interact with these features, or there are a number of NuGet packages that you can use that provide this functionality.</span></span> <span data-ttu-id="1dc11-159">Uno de estos paquetes es [Microsoft. AspNetCore. ProtectedBrowserStorage](https://www.nuget.org/packages/Microsoft.AspNetCore.ProtectedBrowserStorage).</span><span class="sxs-lookup"><span data-stu-id="1dc11-159">One such package is [Microsoft.AspNetCore.ProtectedBrowserStorage](https://www.nuget.org/packages/Microsoft.AspNetCore.ProtectedBrowserStorage).</span></span>

<span data-ttu-id="1dc11-160">Para obtener instrucciones sobre el uso de este paquete para interactuar con `localStorage` y `sessionStorage` , consulte el artículo sobre la [Administración de Estados de increíbles](/aspnet/core/blazor/state-management#protected-browser-storage-experimental-package) .</span><span class="sxs-lookup"><span data-stu-id="1dc11-160">For instructions on utilizing this package to interact with `localStorage` and `sessionStorage`, see the [Blazor State Management](/aspnet/core/blazor/state-management#protected-browser-storage-experimental-package) article.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="1dc11-161">[Anterior](pages-routing-layouts.md)
>[Siguiente](forms-validation.md)</span><span class="sxs-lookup"><span data-stu-id="1dc11-161">[Previous](pages-routing-layouts.md)
[Next](forms-validation.md)</span></span>
